     1                                  USE32
     2                                  
     3                                  SECTION .start32
     4                                  
     5                                  %include "inc/processor-flags.h" 
     1                              <1> %define X86_CR0_PE      0x00000001 ; /* Protectede mode enable*/
     2                              <1> %define X86_CR0_MP      0x00000002 ; /* Monitor coProcessor*/
     3                              <1> %define X86_CR0_EM      0x00000004 ; /* Emulation*/
     4                              <1> %define X86_CR0_TS      0x00000008 ; /* Task Switched*/
     5                              <1> %define X86_CR0_ET      0x00000010 ; /* Extension Type*/
     6                              <1> %define X86_CR0_NE      0x00000020 ; /* Numeric Error*/
     7                              <1> %define X86_CR0_WP      0x00010000 ; /* Write Protect*/
     8                              <1> %define X86_CR0_AM      0x00040000 ; /* Alignment Mask*/
     9                              <1> %define X86_CR0_NW      0x20000000 ; /* Not Write-through*/
    10                              <1> %define X86_CR0_CD      0x40000000 ; /* Cache Disable*/
    11                              <1> %define X86_CR0_PG      0x80000000 ; /* PaGine*/
    12                              <1> 
    13                              <1> ;------------DTP y TP(Descriptor de Tablas de Páginas y Tabla de Páginas) flags--------------------------
    14                              <1> PAG_PCD_YES  equ 1       ; cachable                          
    15                              <1> PAG_PCD_NO   equ 0       ; no cachable
    16                              <1> PAG_PWT_YES  equ 1       ; 1 se escribe en cache y ram       
    17                              <1> PAG_PWT_NO   equ 0       ; 0 
    18                              <1> PAG_P_YES    equ 1       ; 1 presente
    19                              <1> PAG_P_NO     equ 0       ; 0 no presente
    20                              <1> PAG_RW_W     equ 1       ; 1 lectura y escritura
    21                              <1> PAG_RW_R     equ 0       ; 0 solo lectura
    22                              <1> PAG_US_SUP   equ 0       ; 0 supervisor
    23                              <1> PAG_US_US    equ 1       ; 1 usuario  
    24                              <1> PAG_D        equ 0       ; modificacion en la pagina
    25                              <1> PAG_PAT      equ 0       ; PAT                   
    26                              <1> PAG_G_YES    equ 0       ; Global                 
    27                              <1> PAG_A        equ 0       ; accedida
    28                              <1> PAG_PS_4K    equ 0       ; tamaño de pagina de 4KB
    29                              <1> 
     6                                  
     7                                  ; Selectores de segmento
     8                                  EXTERN CS_SEL_00
     9                                  EXTERN DS_SEL_32_prim
    10                                  EXTERN TSS_SEL
    11                                  ; Stack 32 bits
    12                                  EXTERN __STACK_END_32_VMA
    13                                  __STACK_KERNEL_END_VMA
    13          ******************       warning: label alone on a line without a colon might be in error [-w+orphan-labels]
    14                                  EXTERN __STACK_SIZE_32
    15                                  ; Etiquetas externas
    16                                  EXTERN kernel32_init
    17                                  EXTERN __fast_memcpy
    18                                  EXTERN __fast_memcpy_rom
    19                                  EXTERN init_pic
    20                                  EXTERN _idtr_32
    21                                  EXTERN _gdtr_32
    22                                  EXTERN init_timer
    23                                  EXTERN init_teclado
    24                                  EXTERN set_cr3_rom
    25                                  EXTERN ejecutar_tarea_1
    26                                  EXTERN ejecutar_tarea_2
    27                                  EXTERN ejecutar_tarea_3
    28                                  EXTERN ejecutar_tarea_4
    29                                  EXTERN set_page_rom
    30                                  EXTERN init_tss
    31                                  ; Direcciones LMA
    32                                  EXTERN __KERNEL_32_LMA
    33                                  EXTERN __TECLADO_ISR_LMA
    34                                  EXTERN __FUNCTIONS_LMA
    35                                  EXTERN __SYS_TABLES_LMA
    36                                  EXTERN __DATOS_SYS32_LMA
    37                                  EXTERN __TAREA1_BSS_LMA
    38                                  EXTERN __TAREA1_DATA_LMA
    39                                  EXTERN __TAREA1_TEXT_LMA
    40                                  EXTERN __TAREA1_RODATA_LMA
    41                                  EXTERN __TAREA2_BSS_LMA
    42                                  EXTERN __TAREA2_DATA_LMA
    43                                  EXTERN __TAREA2_TEXT_LMA
    44                                  EXTERN __TAREA2_RODATA_LMA
    45                                  EXTERN __TAREA3_BSS_LMA
    46                                  EXTERN __TAREA3_DATA_LMA
    47                                  EXTERN __TAREA3_TEXT_LMA
    48                                  EXTERN __TAREA3_RODATA_LMA
    49                                  EXTERN __TAREA4_BSS_LMA
    50                                  EXTERN __TAREA4_DATA_LMA
    51                                  EXTERN __TAREA4_TEXT_LMA
    52                                  EXTERN __TAREA4_RODATA_LMA
    53                                  ; Direcciones VMA
    54                                  EXTERN __DIGITS_TABLE_VMA
    55                                  EXTERN __TAREA1_BSS_VMA
    56                                  EXTERN __TAREA1_DATA_VMA
    57                                  EXTERN __TAREA1_TEXT_VMA
    58                                  EXTERN __TAREA1_RODATA_VMA
    59                                  EXTERN __TAREA2_BSS_VMA
    60                                  EXTERN __TAREA2_DATA_VMA
    61                                  EXTERN __TAREA2_TEXT_VMA
    62                                  EXTERN __TAREA2_RODATA_VMA
    63                                  EXTERN __TAREA3_BSS_VMA
    64                                  EXTERN __TAREA3_DATA_VMA
    65                                  EXTERN __TAREA3_TEXT_VMA
    66                                  EXTERN __TAREA3_RODATA_VMA
    67                                  EXTERN __TAREA4_BSS_VMA
    68                                  EXTERN __TAREA4_DATA_VMA
    69                                  EXTERN __TAREA4_TEXT_VMA
    70                                  EXTERN __TAREA4_RODATA_VMA
    71                                  EXTERN __STACK_KERNEL_VMA
    72                                  EXTERN __TAREA1_STACK_START_VMA
    73                                  EXTERN __TAREA2_STACK_START_VMA
    74                                  EXTERN __TAREA3_STACK_START_VMA
    75                                  EXTERN __TAREA4_STACK_START_VMA
    76                                  EXTERN __TAREA1_STACK_END_VMA
    77                                  EXTERN __TAREA2_STACK_END_VMA
    78                                  EXTERN __TAREA3_STACK_END_VMA
    79                                  EXTERN __TAREA4_STACK_END_VMA
    80                                  EXTERN __STACK_KERNEL_TAREA1_END_VMA
    81                                  EXTERN __STACK_KERNEL_TAREA2_END_VMA
    82                                  EXTERN __STACK_KERNEL_TAREA3_END_VMA
    83                                  EXTERN __STACK_KERNEL_TAREA4_END_VMA
    84                                  EXTERN __INIT_32_VMA
    85                                  EXTERN __KERNEL_32_VMA
    86                                  EXTERN __FUNCTIONS_VMA
    87                                  EXTERN __TECLADO_ISR_VMA
    88                                  EXTERN __SYS_TABLES_VMA
    89                                  EXTERN __DATOS_SYS32_VMA
    90                                  EXTERN __TAREA_1_VMA
    91                                  EXTERN __PAGE_TABLES_VMA
    92                                  EXTERN __VGA_VMA
    93                                  EXTERN __TAREA1_STACK_START_VMA
    94                                  EXTERN __INIT_16_VMA
    95                                  EXTERN __PAG_DINAMICA_INIT_VMA
    96                                  EXTERN __TSS4_VMA
    97                                  EXTERN __TSS3_VMA
    98                                  EXTERN __TSS2_VMA
    99                                  EXTERN __TSS1_VMA
   100                                  EXTERN __TSS_BASICA
   101                                  ; Direcciones físicas
   102                                  EXTERN __SYS_TABLES_PHY        
   103                                  EXTERN __PAGE_TABLES_PHY       
   104                                  EXTERN __FUNCTIONS_PHY         
   105                                  EXTERN __VGA_PHY               
   106                                  EXTERN __TECLADO_ISR_PHY       
   107                                  EXTERN __DATOS_SYS32_PHY       
   108                                  EXTERN __DIGITS_TABLE_PHY      
   109                                  EXTERN __KERNEL_32_PHY         
   110                                  EXTERN __TAREA1_TEXT_PHY       
   111                                  EXTERN __TAREA1_BSS_PHY        
   112                                  EXTERN __TAREA1_DATA_PHY       
   113                                  EXTERN __TAREA1_RODATA_PHY
   114                                  EXTERN __TAREA2_TEXT_PHY  
   115                                  EXTERN __TAREA2_BSS_PHY   
   116                                  EXTERN __TAREA2_DATA_PHY  
   117                                  EXTERN __TAREA2_RODATA_PHY
   118                                  EXTERN __TAREA3_TEXT_PHY  
   119                                  EXTERN __TAREA3_BSS_PHY   
   120                                  EXTERN __TAREA3_DATA_PHY  
   121                                  EXTERN __TAREA3_RODATA_PHY
   122                                  EXTERN __TAREA4_TEXT_PHY  
   123                                  EXTERN __TAREA4_BSS_PHY   
   124                                  EXTERN __TAREA4_DATA_PHY  
   125                                  EXTERN __TAREA4_RODATA_PHY
   126                                  EXTERN __STACK_KERNEL_PHY    
   127                                  EXTERN __TAREA1_STACK_START_PHY
   128                                  EXTERN __TAREA2_STACK_START_PHY
   129                                  EXTERN __TAREA3_STACK_START_PHY
   130                                  EXTERN __TAREA4_STACK_START_PHY
   131                                  EXTERN __INIT_ROM_PHY          
   132                                  EXTERN __RESET_PHY             
   133                                  EXTERN __STACK_KERNEL_END_PHY
   134                                  EXTERN __PAG_DINAMICA_INIT_PHY
   135                                  EXTERN __CR3_KERNEL_PHY
   136                                  EXTERN __CR3_TAREA_1_PHY
   137                                  EXTERN __CR3_TAREA_2_PHY
   138                                  EXTERN __CR3_TAREA_3_PHY
   139                                  EXTERN __CR3_TAREA_4_PHY
   140                                  ; Tamaños de códigos
   141                                  EXTERN __codigo_kernel32_size
   142                                  EXTERN __functions_size
   143                                  EXTERN __handlers_32_size
   144                                  EXTERN __sys_tables_size
   145                                  EXTERN __data_size
   146                                  EXTERN __tarea_01_size
   147                                  EXTERN __tarea_1_bss_size
   148                                  EXTERN __tarea_1_data_size
   149                                  EXTERN __tarea_1_rodata_size
   150                                  EXTERN __tarea_02_size
   151                                  EXTERN __tarea_2_bss_size
   152                                  EXTERN __tarea_2_data_size
   153                                  EXTERN __tarea_2_rodata_size
   154                                  EXTERN __tarea_03_size
   155                                  EXTERN __tarea_3_bss_size
   156                                  EXTERN __tarea_3_data_size
   157                                  EXTERN __tarea_3_rodata_size
   158                                  EXTERN __tarea_04_size
   159                                  EXTERN __tarea_4_bss_size
   160                                  EXTERN __tarea_4_data_size
   161                                  EXTERN __tarea_4_rodata_size
   162                                  ; Etiquetas globales
   163                                  GLOBAL start32_launcher
   164                                  
   165                                  start32_launcher:
   166                                    ;xchg    bx, bx ; Breakpoint. Estoy en 32 bits
   167                                    ; -> Inicializar los selectores de datos
   168 00000000 66B8[0000]                mov     ax, DS_SEL_32_prim ; Selector de la GDT de datos de 32 bits FLAT. Ahora puedo acceder a todos los datos de toda la memoria.
   169 00000004 8ED8                      mov     ds, ax
   170 00000006 8EC0                      mov     es, ax
   171 00000008 8EE8                      mov     gs, ax
   172 0000000A 8EE0                      mov     fs, ax
   173                                    ; -> Inicializar la pila en 32 bits
   174 0000000C 8ED0                      mov     ss, ax
   175 0000000E BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY
   176 00000013 31C0                      xor     eax, eax
   177                                    ; -> Limpio la pila
   178 00000015 B9[00000000]              mov     ecx, __STACK_SIZE_32 ; Cargo el tamaño del stack en el registro counter.
   179                                  .stack_init:
   180 0000001A 50                        push    eax ; Pusheo ceros en el stack.
   181 0000001B E2FD                      loop    .stack_init
   182 0000001D BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY ; Lo apunto al final
   183                                  
   184                                    ; -> Desempaquetamiento de la ROM (copia de las funciones a RAM)
   185 00000022 55                        push    ebp
   186 00000023 89E5                      mov     ebp, esp ; Genero el STACK FRAME
   187                                    ; -> Paso argumentos y llamo memcopy 
   188 00000025 68[00000000]              push    __functions_size
   189 0000002A 68[00000000]              push    __FUNCTIONS_PHY
   190 0000002F 68[00000000]              push    __FUNCTIONS_LMA
   191 00000034 E8(00000000)              call    __fast_memcpy_rom
   192 00000039 C9                        leave
   193 0000003A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   194 0000003D 0F85CA0B0000              jne     .guard
   195                                    ; -> Desempaquetamiento de la ROM (copia del kernel a RAM)
   196 00000043 55                        push    ebp
   197 00000044 89E5                      mov     ebp, esp 
   198 00000046 68[00000000]              push    __codigo_kernel32_size
   199 0000004B 68[00000000]              push    __KERNEL_32_PHY
   200 00000050 68[00000000]              push    __KERNEL_32_LMA
   201 00000055 E8(00000000)              call    __fast_memcpy
   202 0000005A C9                        leave
   203 0000005B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   204 0000005E 0F85A90B0000              jne     .guard
   205                                    ; -> Desempaquetamiento de la ROM (copia de los handlers Teclado + ISR a RAM)
   206 00000064 55                        push    ebp
   207 00000065 89E5                      mov     ebp, esp 
   208 00000067 68[00000000]              push    __handlers_32_size
   209 0000006C 68[00000000]              push    __TECLADO_ISR_PHY
   210 00000071 68[00000000]              push    __TECLADO_ISR_LMA
   211 00000076 E8(00000000)              call    __fast_memcpy
   212 0000007B C9                        leave
   213 0000007C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   214 0000007F 0F85880B0000              jne     .guard
   215                                    ; -> Desempaquetamiento de la ROM (copia de datos de ROM a RAM)
   216 00000085 55                        push    ebp
   217 00000086 89E5                      mov     ebp, esp 
   218 00000088 68[00000000]              push    __data_size
   219 0000008D 68[00000000]              push    __DATOS_SYS32_PHY
   220 00000092 68[00000000]              push    __DATOS_SYS32_LMA
   221 00000097 E8(00000000)              call    __fast_memcpy
   222 0000009C C9                        leave
   223 0000009D 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   224 000000A0 0F85670B0000              jne     .guard
   225                                    ; -> Desempaquetamiento de la ROM (copia de las tablas de sistema (GDT e IDT) a RAM)
   226 000000A6 55                        push    ebp
   227 000000A7 89E5                      mov     ebp, esp 
   228 000000A9 68[00000000]              push    __sys_tables_size
   229 000000AE 68[00000000]              push    __SYS_TABLES_PHY
   230 000000B3 68[00000000]              push    __SYS_TABLES_LMA
   231 000000B8 E8(00000000)              call    __fast_memcpy
   232 000000BD C9                        leave
   233 000000BE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   234 000000C1 0F85460B0000              jne     .guard
   235                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_1 a RAM)
   236 000000C7 55                        push    ebp
   237 000000C8 89E5                      mov     ebp, esp 
   238 000000CA 68[00000000]              push    __tarea_01_size
   239 000000CF 68[00000000]              push    __TAREA1_TEXT_PHY
   240 000000D4 68[00000000]              push    __TAREA1_TEXT_LMA
   241 000000D9 E8(00000000)              call    __fast_memcpy
   242 000000DE C9                        leave
   243 000000DF 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   244 000000E2 0F85250B0000              jne     .guard
   245                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _1 a RAM)
   246 000000E8 55                        push    ebp
   247 000000E9 89E5                      mov     ebp, esp 
   248 000000EB 68[00000000]              push    __tarea_1_bss_size
   249 000000F0 68[00000000]              push    __TAREA1_BSS_PHY
   250 000000F5 68[00000000]              push    __TAREA1_BSS_LMA
   251 000000FA E8(00000000)              call    __fast_memcpy
   252 000000FF C9                        leave
   253 00000100 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   254 00000103 0F85040B0000              jne     .guard
   255                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _1 a RAM)
   256 00000109 55                        push    ebp
   257 0000010A 89E5                      mov     ebp, esp 
   258 0000010C 68[00000000]              push    __tarea_1_data_size
   259 00000111 68[00000000]              push    __TAREA1_DATA_PHY
   260 00000116 68[00000000]              push    __TAREA1_DATA_LMA
   261 0000011B E8(00000000)              call    __fast_memcpy
   262 00000120 C9                        leave
   263 00000121 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   264 00000124 0F85E30A0000              jne     .guard
   265                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _1 a RAM)
   266 0000012A 55                        push    ebp
   267 0000012B 89E5                      mov     ebp, esp 
   268 0000012D 68[00000000]              push    __tarea_1_rodata_size
   269 00000132 68[00000000]              push    __TAREA1_RODATA_PHY
   270 00000137 68[00000000]              push    __TAREA1_RODATA_LMA
   271 0000013C E8(00000000)              call    __fast_memcpy
   272 00000141 C9                        leave
   273 00000142 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   274 00000145 0F85C20A0000              jne     .guard
   275                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_2 a RAM)
   276 0000014B 55                        push    ebp
   277 0000014C 89E5                      mov     ebp, esp 
   278 0000014E 68[00000000]              push    __tarea_02_size
   279 00000153 68[00000000]              push    __TAREA2_TEXT_PHY
   280 00000158 68[00000000]              push    __TAREA2_TEXT_LMA
   281 0000015D E8(00000000)              call    __fast_memcpy
   282 00000162 C9                        leave
   283 00000163 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   284 00000166 0F85A10A0000              jne     .guard
   285                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _2 a RAM)
   286 0000016C 55                        push    ebp
   287 0000016D 89E5                      mov     ebp, esp 
   288 0000016F 68[00000000]              push    __tarea_2_bss_size
   289 00000174 68[00000000]              push    __TAREA2_BSS_PHY
   290 00000179 68[00000000]              push    __TAREA2_BSS_LMA
   291 0000017E E8(00000000)              call    __fast_memcpy
   292 00000183 C9                        leave
   293 00000184 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   294 00000187 0F85800A0000              jne     .guard
   295                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _2 a RAM)
   296 0000018D 55                        push    ebp
   297 0000018E 89E5                      mov     ebp, esp 
   298 00000190 68[00000000]              push    __tarea_2_data_size
   299 00000195 68[00000000]              push    __TAREA2_DATA_PHY
   300 0000019A 68[00000000]              push    __TAREA2_DATA_LMA
   301 0000019F E8(00000000)              call    __fast_memcpy
   302 000001A4 C9                        leave
   303 000001A5 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   304 000001A8 0F855F0A0000              jne     .guard
   305                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _2 a RAM)
   306 000001AE 55                        push    ebp
   307 000001AF 89E5                      mov     ebp, esp 
   308 000001B1 68[00000000]              push    __tarea_2_rodata_size
   309 000001B6 68[00000000]              push    __TAREA2_RODATA_PHY
   310 000001BB 68[00000000]              push    __TAREA2_RODATA_LMA
   311 000001C0 E8(00000000)              call    __fast_memcpy
   312 000001C5 C9                        leave
   313 000001C6 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   314 000001C9 0F853E0A0000              jne     .guard
   315                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_3 a RAM)
   316 000001CF 55                        push    ebp
   317 000001D0 89E5                      mov     ebp, esp 
   318 000001D2 68[00000000]              push    __tarea_03_size
   319 000001D7 68[00000000]              push    __TAREA3_TEXT_PHY
   320 000001DC 68[00000000]              push    __TAREA3_TEXT_LMA
   321 000001E1 E8(00000000)              call    __fast_memcpy
   322 000001E6 C9                        leave
   323 000001E7 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   324 000001EA 0F851D0A0000              jne     .guard
   325                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _3 a RAM)
   326 000001F0 55                        push    ebp
   327 000001F1 89E5                      mov     ebp, esp 
   328 000001F3 68[00000000]              push    __tarea_3_bss_size
   329 000001F8 68[00000000]              push    __TAREA3_BSS_PHY
   330 000001FD 68[00000000]              push    __TAREA3_BSS_LMA
   331 00000202 E8(00000000)              call    __fast_memcpy
   332 00000207 C9                        leave
   333 00000208 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   334 0000020B 0F85FC090000              jne     .guard
   335                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_3 a RAM)
   336 00000211 55                        push    ebp
   337 00000212 89E5                      mov     ebp, esp 
   338 00000214 68[00000000]              push    __tarea_3_data_size
   339 00000219 68[00000000]              push    __TAREA3_DATA_PHY
   340 0000021E 68[00000000]              push    __TAREA3_DATA_LMA
   341 00000223 E8(00000000)              call    __fast_memcpy
   342 00000228 C9                        leave
   343 00000229 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   344 0000022C 0F85DB090000              jne     .guard
   345                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _3 a RAM)
   346 00000232 55                        push    ebp
   347 00000233 89E5                      mov     ebp, esp 
   348 00000235 68[00000000]              push    __tarea_3_rodata_size
   349 0000023A 68[00000000]              push    __TAREA3_RODATA_PHY
   350 0000023F 68[00000000]              push    __TAREA3_RODATA_LMA
   351 00000244 E8(00000000)              call    __fast_memcpy
   352 00000249 C9                        leave
   353 0000024A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   354 0000024D 0F85BA090000              jne     .guard
   355                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_4 a RAM)
   356 00000253 55                        push    ebp
   357 00000254 89E5                      mov     ebp, esp 
   358 00000256 68[00000000]              push    __tarea_04_size
   359 0000025B 68[00000000]              push    __TAREA4_TEXT_PHY
   360 00000260 68[00000000]              push    __TAREA4_TEXT_LMA
   361 00000265 E8(00000000)              call    __fast_memcpy
   362 0000026A C9                        leave
   363 0000026B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   364 0000026E 0F8599090000              jne     .guard
   365                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA_4 a RAM)
   366 00000274 55                        push    ebp
   367 00000275 89E5                      mov     ebp, esp 
   368 00000277 68[00000000]              push    __tarea_4_bss_size
   369 0000027C 68[00000000]              push    __TAREA4_BSS_PHY
   370 00000281 68[00000000]              push    __TAREA4_BSS_LMA
   371 00000286 E8(00000000)              call    __fast_memcpy
   372 0000028B C9                        leave
   373 0000028C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   374 0000028F 0F8578090000              jne     .guard
   375                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_4 a RAM)
   376 00000295 55                        push    ebp
   377 00000296 89E5                      mov     ebp, esp 
   378 00000298 68[00000000]              push    __tarea_4_data_size
   379 0000029D 68[00000000]              push    __TAREA4_DATA_PHY
   380 000002A2 68[00000000]              push    __TAREA4_DATA_LMA
   381 000002A7 E8(00000000)              call    __fast_memcpy
   382 000002AC C9                        leave
   383 000002AD 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   384 000002B0 0F8557090000              jne     .guard
   385                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA_4 a RAM)
   386 000002B6 55                        push    ebp
   387 000002B7 89E5                      mov     ebp, esp 
   388 000002B9 68[00000000]              push    __tarea_4_rodata_size
   389 000002BE 68[00000000]              push    __TAREA4_RODATA_PHY
   390 000002C3 68[00000000]              push    __TAREA4_RODATA_LMA
   391 000002C8 E8(00000000)              call    __fast_memcpy
   392 000002CD C9                        leave
   393 000002CE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   394 000002D1 0F8536090000              jne     .guard
   395                                  
   396                                    ;-> Cargo la IDT y la GDT ya copiada en RAM
   397 000002D7 0F0115[00000000]          lgdt [_gdtr_32]
   398 000002DE 0F011D[00000000]          lidt [_idtr_32]  
   399                                  
   400                                    ; -> Init PIC , IRQ y config. Timer y teclado
   401 000002E5 E8(00000000)              call init_teclado       ; Inicializo controlador de teclado
   402 000002EA E8(00000000)              call init_timer         ; Configuro Timer tick para 100ms
   403 000002EF E8(00000000)              call init_pic           ; Inicializo los PICs e interrupciones de Timer y Teclado
   404                                  
   405                                    ;----------------------------------------------
   406                                    ;-----------------PAGINACIÓN-------------------
   407                                    ;----------------------------------------------
   408                                  
   409                                    ; -> Inicializo CR3 con la dirección base del DPT correspondiente al Kernel.
   410 000002F4 55                        push    ebp
   411 000002F5 89E5                      mov     ebp, esp
   412 000002F7 6A01                      push    PAG_PWT_YES
   413 000002F9 6A01                      push    PAG_PCD_YES
   414 000002FB 68[00000000]              push    dword __CR3_KERNEL_PHY
   415 00000300 E8(00000000)              call    set_cr3_rom
   416 00000305 0F22D8                    mov     cr3, eax
   417 00000308 C9                        leave
   418                                  
   419                                    ;--------------------------------------------
   420                                    ;-----------Mapeo del Kernel-----------------
   421                                    ;--------------------------------------------
   422                                    ;------------CR3_KERNEL                       = Base del DTP del Kernel
   423                                    ;------------CR3_KERNEL + 0x1000              = Tamaño del DTP
   424                                    ;-----------(CR3 KERNEL + 0x1000)+0x1000*DPTE = Bases de las TP
   425                                  
   426                                    ; HANDLERS, VGA, SYS_TABLES, KERNEL_32, DIGITS_TABLE, DATA_SYS, STACK_SYS, INIT_32 (este código), __TSS_BASICA, TSS_1, TSS_2, TSS_3
   427                                  
   428                                    ;------__TECLADO_ISR_PHY-----------
   429                                    ; ->Cargo DPTE y PTE
   430 00000309 55                        push    ebp
   431 0000030A 89E5                      mov     ebp, esp
   432 0000030C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   433 0000030E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   434 00000310 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   435 00000312 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   436 00000314 68[00000000]              push    __TECLADO_ISR_PHY
   437 00000319 68[00000000]              push    __TECLADO_ISR_VMA 
   438 0000031E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   439 00000323 E8(00000000)              call    set_page_rom
   440 00000328 C9                        leave
   441                                  
   442                                  ;------__VGA_PHY-----------
   443                                  ; ->Cargo DPTE y PTE
   444 00000329 55                        push    ebp
   445 0000032A 89E5                      mov     ebp, esp 
   446 0000032C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   447 0000032E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   448 00000330 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   449 00000332 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   450 00000334 68[00000000]              push    __VGA_PHY
   451 00000339 68[00000000]              push    __VGA_VMA 
   452 0000033E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   453 00000343 E8(00000000)              call    set_page_rom
   454 00000348 C9                        leave
   455                                  
   456                                  ;------__SYS_TABLES_PHY-----------
   457                                    ; ->Cargo DPTE y PTE
   458 00000349 55                        push    ebp
   459 0000034A 89E5                      mov     ebp, esp 
   460 0000034C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   461 0000034E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   462 00000350 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   463 00000352 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   464 00000354 68[00000000]              push    __SYS_TABLES_PHY
   465 00000359 68[00000000]              push    __SYS_TABLES_VMA 
   466 0000035E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   467 00000363 E8(00000000)              call    set_page_rom
   468 00000368 C9                        leave
   469                                  
   470                                  ;------__KERNEL_32_PHY-----------
   471                                    ; ->Cargo DPTE y PTE
   472 00000369 55                        push    ebp
   473 0000036A 89E5                      mov     ebp, esp 
   474 0000036C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   475 0000036E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   476 00000370 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   477 00000372 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   478 00000374 68[00000000]              push    __KERNEL_32_PHY
   479 00000379 68[00000000]              push    __KERNEL_32_VMA 
   480 0000037E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   481 00000383 E8(00000000)              call    set_page_rom
   482 00000388 C9                        leave
   483                                  
   484                                  
   485                                  ;------__FUNCTIONS_PHY-----------
   486                                    ; ->Cargo DPTE y PTE
   487 00000389 55                        push    ebp
   488 0000038A 89E5                      mov     ebp, esp 
   489 0000038C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   490 0000038E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   491 00000390 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   492 00000392 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   493 00000394 68[00000000]              push    __FUNCTIONS_PHY
   494 00000399 68[00000000]              push    __FUNCTIONS_VMA 
   495 0000039E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   496 000003A3 E8(00000000)              call    set_page_rom
   497 000003A8 C9                        leave
   498                                  
   499                                  ;------__DIGITS_TABLE_PHY-----------
   500                                    ; ->Cargo DPTE y PTE
   501 000003A9 55                        push    ebp
   502 000003AA 89E5                      mov     ebp, esp 
   503 000003AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   504 000003AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   505 000003B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   506 000003B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   507 000003B4 68[00000000]              push    __DIGITS_TABLE_PHY
   508 000003B9 68[00000000]              push    __DIGITS_TABLE_VMA 
   509 000003BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   510 000003C3 E8(00000000)              call    set_page_rom
   511 000003C8 C9                        leave
   512                                  
   513                                  ;------__DATOS_SYS32_PHY-----------
   514                                    ; ->Cargo DPTE y PTE
   515 000003C9 55                        push    ebp
   516 000003CA 89E5                      mov     ebp, esp 
   517 000003CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   518 000003CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   519 000003D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   520 000003D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   521 000003D4 68[00000000]              push    __DATOS_SYS32_PHY
   522 000003D9 68[00000000]              push    __DATOS_SYS32_VMA 
   523 000003DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   524 000003E3 E8(00000000)              call    set_page_rom
   525 000003E8 C9                        leave
   526                                  
   527                                  
   528                                  ;------__STACK_KERNEL_VMA-----------
   529                                    ; ->Cargo DPTE y PTE
   530 000003E9 55                        push    ebp
   531 000003EA 89E5                      mov     ebp, esp 
   532 000003EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   533 000003EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   534 000003F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   535 000003F2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   536 000003F4 68[00000000]              push    __STACK_KERNEL_PHY
   537 000003F9 68[00000000]              push    __STACK_KERNEL_VMA 
   538 000003FE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   539 00000403 E8(00000000)              call    set_page_rom
   540 00000408 C9                        leave
   541                                  
   542                                  
   543                                  ;------__INIT_32_VMA-----------
   544                                    ; ->Cargo DPTE y PTE
   545 00000409 55                        push    ebp
   546 0000040A 89E5                      mov     ebp, esp 
   547 0000040C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   548 0000040E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   549 00000410 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   550 00000412 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   551 00000414 68[00000000]              push    __INIT_32_VMA     ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   552 00000419 68[00000000]              push    __INIT_32_VMA 
   553 0000041E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   554 00000423 E8(00000000)              call    set_page_rom
   555 00000428 C9                        leave
   556                                  
   557                                  ;------__TSS_BASICA-----------
   558                                    ; ->Cargo DPTE y PTE
   559 00000429 55                        push    ebp
   560 0000042A 89E5                      mov     ebp, esp 
   561 0000042C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   562 0000042E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   563 00000430 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   564 00000432 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   565 00000434 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   566 00000439 68[00000000]              push    __TSS_BASICA 
   567 0000043E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   568 00000443 E8(00000000)              call    set_page_rom
   569 00000448 C9                        leave
   570                                  
   571                                  ;------TSS_1-----------
   572                                    ; ->Cargo DPTE y PTE
   573 00000449 55                        push    ebp
   574 0000044A 89E5                      mov     ebp, esp 
   575 0000044C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   576 0000044E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   577 00000450 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   578 00000452 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   579 00000454 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   580 00000459 68[00000000]              push    __TSS1_VMA 
   581 0000045E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   582 00000463 E8(00000000)              call    set_page_rom
   583 00000468 C9                        leave
   584                                  
   585                                  ;------__TSS_2-----------
   586                                    ; ->Cargo DPTE y PTE
   587 00000469 55                        push    ebp
   588 0000046A 89E5                      mov     ebp, esp 
   589 0000046C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   590 0000046E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   591 00000470 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   592 00000472 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   593 00000474 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
   594 00000479 68[00000000]              push    __TSS2_VMA 
   595 0000047E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   596 00000483 E8(00000000)              call    set_page_rom
   597 00000488 C9                        leave
   598                                  
   599                                    ;------__TSS_3-----------
   600                                    ; ->Cargo DPTE y PTE
   601 00000489 55                        push    ebp
   602 0000048A 89E5                      mov     ebp, esp 
   603 0000048C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   604 0000048E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   605 00000490 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   606 00000492 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   607 00000494 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
   608 00000499 68[00000000]              push    __TSS3_VMA 
   609 0000049E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   610 000004A3 E8(00000000)              call    set_page_rom
   611 000004A8 C9                        leave
   612                                  
   613                                    ;------__TSS_4-----------
   614                                    ; ->Cargo DPTE y PTE
   615 000004A9 55                        push    ebp
   616 000004AA 89E5                      mov     ebp, esp 
   617 000004AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   618 000004AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   619 000004B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   620 000004B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   621 000004B4 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
   622 000004B9 68[00000000]              push    __TSS4_VMA 
   623 000004BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   624 000004C3 E8(00000000)              call    set_page_rom
   625 000004C8 C9                        leave
   626                                  
   627                                  
   628                                  
   629                                    ;--------------------------------------------
   630                                    ;-----------Mapeo de la Tarea 1 -------------
   631                                    ;--------------------------------------------
   632                                    ;------------__CR3_TAREA_1_PHY                            = Base del DTP de la Tarea 1
   633                                    ;------------__CR3_TAREA_1_PHY + 0x1000                   = Tamaño del DTP
   634                                    ;-----------(CR3 __CR3_TAREA_1_PHY + 0x1000)+0x1000*DPTE  = Bases de las TP
   635                                  
   636                                    ;------__TECLADO_ISR_PHY-----------
   637                                    ; ->Cargo DPTE y PTE
   638 000004C9 55                        push    ebp
   639 000004CA 89E5                      mov     ebp, esp 
   640 000004CC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   641 000004CE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   642 000004D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   643 000004D2 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   644 000004D4 68[00000000]              push    __TECLADO_ISR_PHY     
   645 000004D9 68[00000000]              push    __TECLADO_ISR_VMA 
   646 000004DE 68[00000000]              push    __CR3_TAREA_1_PHY   ; Base del DPT de la Tarea 1 
   647 000004E3 E8(00000000)              call    set_page_rom
   648 000004E8 C9                        leave
   649                                    ;------__VGA_PHY-----------
   650                                    ; ->Cargo DPTE y PTE
   651 000004E9 55                        push    ebp
   652 000004EA 89E5                      mov     ebp, esp 
   653 000004EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   654 000004EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   655 000004F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   656 000004F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   657 000004F4 68[00000000]              push    __VGA_PHY     
   658 000004F9 68[00000000]              push    __VGA_VMA 
   659 000004FE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   660 00000503 E8(00000000)              call    set_page_rom
   661 00000508 C9                        leave
   662                                  
   663                                    ;------__FUNCTIONS_PHY-----------
   664                                    ; ->Cargo DPTE y PTE
   665 00000509 55                        push    ebp
   666 0000050A 89E5                      mov     ebp, esp 
   667 0000050C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   668 0000050E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   669 00000510 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   670 00000512 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   671 00000514 68[00000000]              push    __FUNCTIONS_PHY     
   672 00000519 68[00000000]              push    __FUNCTIONS_VMA 
   673 0000051E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   674 00000523 E8(00000000)              call    set_page_rom
   675 00000528 C9                        leave
   676                                  
   677                                    ;------__DATOS_SYS32_PHY-----------
   678                                    ; ->Cargo DPTE y PTE
   679 00000529 55                        push    ebp
   680 0000052A 89E5                      mov     ebp, esp 
   681 0000052C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   682 0000052E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   683 00000530 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   684 00000532 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   685 00000534 68[00000000]              push    __DATOS_SYS32_PHY     
   686 00000539 68[00000000]              push    __DATOS_SYS32_VMA 
   687 0000053E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   688 00000543 E8(00000000)              call    set_page_rom
   689 00000548 C9                        leave
   690                                  
   691                                    ;------__DIGITS_TABLE_PHY-----------
   692                                    ; ->Cargo DPTE y PTE
   693 00000549 55                        push    ebp
   694 0000054A 89E5                      mov     ebp, esp 
   695 0000054C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   696 0000054E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   697 00000550 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   698 00000552 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   699 00000554 68[00000000]              push    __DIGITS_TABLE_PHY     
   700 00000559 68[00000000]              push    __DIGITS_TABLE_VMA 
   701 0000055E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   702 00000563 E8(00000000)              call    set_page_rom
   703 00000568 C9                        leave
   704                                  
   705                                    ;------__SYS_TABLES_PHY-----------
   706                                    ; ->Cargo DPTE y PTE
   707 00000569 55                        push    ebp
   708 0000056A 89E5                      mov     ebp, esp 
   709 0000056C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   710 0000056E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   711 00000570 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   712 00000572 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   713 00000574 68[00000000]              push    __SYS_TABLES_PHY     
   714 00000579 68[00000000]              push    __SYS_TABLES_VMA 
   715 0000057E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   716 00000583 E8(00000000)              call    set_page_rom
   717 00000588 C9                        leave
   718                                  
   719                                    ;------__TAREA1_TEXT_PHY-----------
   720                                    ; ->Cargo DPTE y PTE
   721 00000589 55                        push    ebp
   722 0000058A 89E5                      mov     ebp, esp 
   723 0000058C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   724 0000058E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   725 00000590 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   726 00000592 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   727 00000594 68[00000000]              push    __TAREA1_TEXT_PHY     
   728 00000599 68[00000000]              push    __TAREA1_TEXT_VMA 
   729 0000059E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   730 000005A3 E8(00000000)              call    set_page_rom
   731 000005A8 C9                        leave
   732                                  
   733                                    ;------__TAREA1_BSS_PHY-----------
   734                                    ; ->Cargo DPTE y PTE
   735 000005A9 55                        push    ebp
   736 000005AA 89E5                      mov     ebp, esp 
   737 000005AC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   738 000005AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   739 000005B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   740 000005B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   741 000005B4 68[00000000]              push    __TAREA1_BSS_PHY     
   742 000005B9 68[00000000]              push    __TAREA1_BSS_VMA 
   743 000005BE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   744 000005C3 E8(00000000)              call    set_page_rom
   745 000005C8 C9                        leave
   746                                  
   747                                    ;------__TAREA1_DATA_PHY-----------
   748                                    ; ->Cargo DPTE y PTE
   749 000005C9 55                        push    ebp
   750 000005CA 89E5                      mov     ebp, esp 
   751 000005CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   752 000005CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   753 000005D0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   754 000005D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   755 000005D4 68[00000000]              push    __TAREA1_DATA_PHY     
   756 000005D9 68[00000000]              push    __TAREA1_DATA_VMA 
   757 000005DE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   758 000005E3 E8(00000000)              call    set_page_rom
   759 000005E8 C9                        leave
   760                                    
   761                                    ;------__TAREA1_STACK_START_PHY-----------
   762                                    ; ->Cargo DPTE y PTE
   763 000005E9 55                        push    ebp
   764 000005EA 89E5                      mov     ebp, esp 
   765 000005EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   766 000005EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   767 000005F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   768 000005F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   769 000005F4 68[00000000]              push    __TAREA1_STACK_START_PHY     
   770 000005F9 68[00000000]              push    __TAREA1_STACK_START_VMA 
   771 000005FE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   772 00000603 E8(00000000)              call    set_page_rom
   773 00000608 C9                        leave
   774                                  
   775                                    ;------__STACK_KERNEL_PHY-----------
   776                                    ; ->Cargo DPTE y PTE
   777 00000609 55                        push    ebp
   778 0000060A 89E5                      mov     ebp, esp 
   779 0000060C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
   780 0000060E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
   781 00000610 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   782 00000612 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
   783 00000614 68[00000000]              push    __STACK_KERNEL_PHY     
   784 00000619 68[00000000]              push    __STACK_KERNEL_VMA 
   785 0000061E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   786 00000623 E8(00000000)              call    set_page_rom
   787 00000628 C9                        leave
   788                                  
   789                                    ;------__TSS_1-----------
   790                                    ; ->Cargo DPTE y PTE
   791 00000629 55                        push    ebp
   792 0000062A 89E5                      mov     ebp, esp 
   793 0000062C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   794 0000062E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   795 00000630 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   796 00000632 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   797 00000634 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   798 00000639 68[00000000]              push    __TSS1_VMA 
   799 0000063E 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   800 00000643 E8(00000000)              call    set_page_rom
   801 00000648 C9                        leave
   802                                    ;------____TSS_BASICA-----------
   803                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
   804                                    ; las pilas de nivel 0.
   805                                    ; ->Cargo DPTE y PTE
   806 00000649 55                        push    ebp
   807 0000064A 89E5                      mov     ebp, esp 
   808 0000064C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   809 0000064E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   810 00000650 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   811 00000652 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   812 00000654 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   813 00000659 68[00000000]              push    __TSS_BASICA 
   814 0000065E 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   815 00000663 E8(00000000)              call    set_page_rom
   816 00000668 C9                        leave
   817                                  
   818                                    ;--------------------------------------------
   819                                    ;-----------Mapeo de la Tarea 2 -------------
   820                                    ;--------------------------------------------
   821                                    ;------------__CR3_TAREA_2_PHY                            = Base del DTP de la Tarea 2
   822                                    ;------------__CR3_TAREA_2_PHY + 0x1000                   = Tamaño del DTP
   823                                    ;-----------(__CR3_TAREA_2_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
   824                                  
   825                                    ;------__TECLADO_ISR_PHY-----------
   826                                    ; ->Cargo DPTE y PTE
   827 00000669 55                        push    ebp
   828 0000066A 89E5                      mov     ebp, esp 
   829 0000066C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   830 0000066E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   831 00000670 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   832 00000672 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   833 00000674 68[00000000]              push    __TECLADO_ISR_PHY     
   834 00000679 68[00000000]              push    __TECLADO_ISR_VMA 
   835 0000067E 68[00000000]              push    __CR3_TAREA_2_PHY   ; Base del DPT de la Tarea 1 
   836 00000683 E8(00000000)              call    set_page_rom
   837 00000688 C9                        leave
   838                                    ;------__VGA_PHY-----------
   839                                    ; ->Cargo DPTE y PTE
   840 00000689 55                        push    ebp
   841 0000068A 89E5                      mov     ebp, esp 
   842 0000068C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   843 0000068E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   844 00000690 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   845 00000692 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   846 00000694 68[00000000]              push    __VGA_PHY     
   847 00000699 68[00000000]              push    __VGA_VMA 
   848 0000069E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   849 000006A3 E8(00000000)              call    set_page_rom
   850 000006A8 C9                        leave
   851                                  
   852                                    ;------__FUNCTIONS_PHY-----------
   853                                    ; ->Cargo DPTE y PTE
   854 000006A9 55                        push    ebp
   855 000006AA 89E5                      mov     ebp, esp 
   856 000006AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   857 000006AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   858 000006B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   859 000006B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   860 000006B4 68[00000000]              push    __FUNCTIONS_PHY     
   861 000006B9 68[00000000]              push    __FUNCTIONS_VMA 
   862 000006BE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   863 000006C3 E8(00000000)              call    set_page_rom
   864 000006C8 C9                        leave
   865                                  
   866                                    ;------__DATOS_SYS32_PHY-----------
   867                                    ; ->Cargo DPTE y PTE
   868 000006C9 55                        push    ebp
   869 000006CA 89E5                      mov     ebp, esp 
   870 000006CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   871 000006CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   872 000006D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   873 000006D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   874 000006D4 68[00000000]              push    __DATOS_SYS32_PHY     
   875 000006D9 68[00000000]              push    __DATOS_SYS32_VMA 
   876 000006DE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   877 000006E3 E8(00000000)              call    set_page_rom
   878 000006E8 C9                        leave
   879                                  
   880                                    ;------__DIGITS_TABLE_PHY-----------
   881                                    ; ->Cargo DPTE y PTE
   882 000006E9 55                        push    ebp
   883 000006EA 89E5                      mov     ebp, esp 
   884 000006EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   885 000006EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   886 000006F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   887 000006F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   888 000006F4 68[00000000]              push    __DIGITS_TABLE_PHY     
   889 000006F9 68[00000000]              push    __DIGITS_TABLE_VMA 
   890 000006FE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   891 00000703 E8(00000000)              call    set_page_rom
   892 00000708 C9                        leave
   893                                  
   894                                    ;------__SYS_TABLES_PHY-----------
   895                                    ; ->Cargo DPTE y PTE
   896 00000709 55                        push    ebp
   897 0000070A 89E5                      mov     ebp, esp 
   898 0000070C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   899 0000070E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   900 00000710 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   901 00000712 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   902 00000714 68[00000000]              push    __SYS_TABLES_PHY     
   903 00000719 68[00000000]              push    __SYS_TABLES_VMA 
   904 0000071E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   905 00000723 E8(00000000)              call    set_page_rom
   906 00000728 C9                        leave
   907                                  
   908                                    ;------__TAREA2_TEXT_PHY-----------
   909                                    ; ->Cargo DPTE y PTE
   910 00000729 55                        push    ebp
   911 0000072A 89E5                      mov     ebp, esp 
   912 0000072C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   913 0000072E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   914 00000730 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   915 00000732 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   916 00000734 68[00000000]              push    __TAREA2_TEXT_PHY     
   917 00000739 68[00000000]              push    __TAREA2_TEXT_VMA 
   918 0000073E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   919 00000743 E8(00000000)              call    set_page_rom
   920 00000748 C9                        leave
   921                                  
   922                                    ;------__TAREA2_BSS_PHY-----------
   923                                    ; ->Cargo DPTE y PTE
   924 00000749 55                        push    ebp
   925 0000074A 89E5                      mov     ebp, esp 
   926 0000074C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   927 0000074E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   928 00000750 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   929 00000752 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   930 00000754 68[00000000]              push    __TAREA2_BSS_PHY     
   931 00000759 68[00000000]              push    __TAREA2_BSS_VMA 
   932 0000075E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   933 00000763 E8(00000000)              call    set_page_rom
   934 00000768 C9                        leave
   935                                  
   936                                    ;------__TAREA2_DATA_PHY-----------
   937                                    ; ->Cargo DPTE y PTE
   938 00000769 55                        push    ebp
   939 0000076A 89E5                      mov     ebp, esp 
   940 0000076C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   941 0000076E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   942 00000770 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   943 00000772 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   944 00000774 68[00000000]              push    __TAREA2_DATA_PHY     
   945 00000779 68[00000000]              push    __TAREA2_DATA_VMA 
   946 0000077E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   947 00000783 E8(00000000)              call    set_page_rom
   948 00000788 C9                        leave
   949                                    
   950                                    ;------__TAREA1_STACK_START_PHY-----------
   951                                    ; ->Cargo DPTE y PTE
   952 00000789 55                        push    ebp
   953 0000078A 89E5                      mov     ebp, esp 
   954 0000078C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   955 0000078E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   956 00000790 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   957 00000792 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   958 00000794 68[00000000]              push    __TAREA2_STACK_START_PHY     
   959 00000799 68[00000000]              push    __TAREA2_STACK_START_VMA 
   960 0000079E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   961 000007A3 E8(00000000)              call    set_page_rom
   962 000007A8 C9                        leave
   963                                  
   964                                    ;------__STACK_KERNEL_PHY-----------
   965                                    ; ->Cargo DPTE y PTE
   966 000007A9 55                        push    ebp
   967 000007AA 89E5                      mov     ebp, esp 
   968 000007AC 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
   969 000007AE 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
   970 000007B0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   971 000007B2 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
   972 000007B4 68[00000000]              push    __STACK_KERNEL_PHY     
   973 000007B9 68[00000000]              push    __STACK_KERNEL_VMA 
   974 000007BE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   975 000007C3 E8(00000000)              call    set_page_rom
   976 000007C8 C9                        leave
   977                                  
   978                                    ;------TSS_2-----------
   979                                    ; ->Cargo DPTE y PTE
   980 000007C9 55                        push    ebp
   981 000007CA 89E5                      mov     ebp, esp 
   982 000007CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   983 000007CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   984 000007D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   985 000007D2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   986 000007D4 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
   987 000007D9 68[00000000]              push    __TSS2_VMA 
   988 000007DE 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
   989 000007E3 E8(00000000)              call    set_page_rom
   990 000007E8 C9                        leave
   991                                    ;------____TSS_BASICA-----------
   992                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
   993                                    ; las pilas de nivel 0.
   994                                    ; ->Cargo DPTE y PTE
   995 000007E9 55                        push    ebp
   996 000007EA 89E5                      mov     ebp, esp 
   997 000007EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   998 000007EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   999 000007F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1000 000007F2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1001 000007F4 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1002 000007F9 68[00000000]              push    __TSS_BASICA 
  1003 000007FE 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1004 00000803 E8(00000000)              call    set_page_rom
  1005 00000808 C9                        leave
  1006                                  
  1007                                  
  1008                                    ;--------------------------------------------
  1009                                    ;-----------Mapeo de la Tarea 3 -------------
  1010                                    ;--------------------------------------------
  1011                                    ;------------__CR3_TAREA_3_PHY                            = Base del DTP de la Tarea 3
  1012                                    ;------------__CR3_TAREA_3_PHY + 0x1000                   = Tamaño del DTP
  1013                                    ;-----------(__CR3_TAREA_3_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1014                                  
  1015                                    ;------__TECLADO_ISR_PHY-----------
  1016                                    ; ->Cargo DPTE y PTE
  1017 00000809 55                        push    ebp
  1018 0000080A 89E5                      mov     ebp, esp 
  1019 0000080C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1020 0000080E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1021 00000810 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1022 00000812 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
  1023 00000814 68[00000000]              push    __TECLADO_ISR_PHY     
  1024 00000819 68[00000000]              push    __TECLADO_ISR_VMA 
  1025 0000081E 68[00000000]              push    __CR3_TAREA_3_PHY   ; Base del DPT de la Tarea 3 
  1026 00000823 E8(00000000)              call    set_page_rom
  1027 00000828 C9                        leave
  1028                                    ;------__VGA_PHY-----------
  1029                                    ; ->Cargo DPTE y PTE
  1030 00000829 55                        push    ebp
  1031 0000082A 89E5                      mov     ebp, esp 
  1032 0000082C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1033 0000082E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1034 00000830 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1035 00000832 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1036 00000834 68[00000000]              push    __VGA_PHY     
  1037 00000839 68[00000000]              push    __VGA_VMA 
  1038 0000083E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1039 00000843 E8(00000000)              call    set_page_rom
  1040 00000848 C9                        leave
  1041                                  
  1042                                    ;------__FUNCTIONS_PHY-----------
  1043                                    ; ->Cargo DPTE y PTE
  1044 00000849 55                        push    ebp
  1045 0000084A 89E5                      mov     ebp, esp 
  1046 0000084C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1047 0000084E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1048 00000850 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1049 00000852 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1050 00000854 68[00000000]              push    __FUNCTIONS_PHY     
  1051 00000859 68[00000000]              push    __FUNCTIONS_VMA 
  1052 0000085E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1053 00000863 E8(00000000)              call    set_page_rom
  1054 00000868 C9                        leave
  1055                                  
  1056                                    ;------__DATOS_SYS32_PHY-----------
  1057                                    ; ->Cargo DPTE y PTE
  1058 00000869 55                        push    ebp
  1059 0000086A 89E5                      mov     ebp, esp 
  1060 0000086C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1061 0000086E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1062 00000870 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1063 00000872 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1064 00000874 68[00000000]              push    __DATOS_SYS32_PHY     
  1065 00000879 68[00000000]              push    __DATOS_SYS32_VMA 
  1066 0000087E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1067 00000883 E8(00000000)              call    set_page_rom
  1068 00000888 C9                        leave
  1069                                  
  1070                                    ;------__DIGITS_TABLE_PHY-----------
  1071                                    ; ->Cargo DPTE y PTE
  1072 00000889 55                        push    ebp
  1073 0000088A 89E5                      mov     ebp, esp 
  1074 0000088C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1075 0000088E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1076 00000890 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1077 00000892 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1078 00000894 68[00000000]              push    __DIGITS_TABLE_PHY     
  1079 00000899 68[00000000]              push    __DIGITS_TABLE_VMA 
  1080 0000089E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1081 000008A3 E8(00000000)              call    set_page_rom
  1082 000008A8 C9                        leave
  1083                                  
  1084                                    ;------__SYS_TABLES_PHY-----------
  1085                                    ; ->Cargo DPTE y PTE
  1086 000008A9 55                        push    ebp
  1087 000008AA 89E5                      mov     ebp, esp 
  1088 000008AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1089 000008AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1090 000008B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1091 000008B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1092 000008B4 68[00000000]              push    __SYS_TABLES_PHY     
  1093 000008B9 68[00000000]              push    __SYS_TABLES_VMA 
  1094 000008BE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1095 000008C3 E8(00000000)              call    set_page_rom
  1096 000008C8 C9                        leave
  1097                                  
  1098                                    ;------__TAREA3_TEXT_PHY-----------
  1099                                    ; ->Cargo DPTE y PTE
  1100 000008C9 55                        push    ebp
  1101 000008CA 89E5                      mov     ebp, esp 
  1102 000008CC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1103 000008CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1104 000008D0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1105 000008D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1106 000008D4 68[00000000]              push    __TAREA3_TEXT_PHY     
  1107 000008D9 68[00000000]              push    __TAREA3_TEXT_VMA 
  1108 000008DE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1109 000008E3 E8(00000000)              call    set_page_rom
  1110 000008E8 C9                        leave
  1111                                  
  1112                                    ;------__TAREA3_BSS_PHY-----------
  1113                                    ; ->Cargo DPTE y PTE
  1114 000008E9 55                        push    ebp
  1115 000008EA 89E5                      mov     ebp, esp 
  1116 000008EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1117 000008EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1118 000008F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1119 000008F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1120 000008F4 68[00000000]              push    __TAREA3_BSS_PHY     
  1121 000008F9 68[00000000]              push    __TAREA3_BSS_VMA 
  1122 000008FE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1123 00000903 E8(00000000)              call    set_page_rom
  1124 00000908 C9                        leave
  1125                                  
  1126                                    ;------__TAREA3_DATA_PHY-----------
  1127                                    ; ->Cargo DPTE y PTE
  1128 00000909 55                        push    ebp
  1129 0000090A 89E5                      mov     ebp, esp 
  1130 0000090C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1131 0000090E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1132 00000910 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1133 00000912 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1134 00000914 68[00000000]              push    __TAREA3_DATA_PHY     
  1135 00000919 68[00000000]              push    __TAREA3_DATA_VMA 
  1136 0000091E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1137 00000923 E8(00000000)              call    set_page_rom
  1138 00000928 C9                        leave
  1139                                    
  1140                                    ;------__TAREA1_STACK_START_PHY-----------
  1141                                    ; ->Cargo DPTE y PTE
  1142 00000929 55                        push    ebp
  1143 0000092A 89E5                      mov     ebp, esp 
  1144 0000092C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1145 0000092E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1146 00000930 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1147 00000932 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1148 00000934 68[00000000]              push    __TAREA3_STACK_START_PHY     
  1149 00000939 68[00000000]              push    __TAREA3_STACK_START_VMA 
  1150 0000093E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1151 00000943 E8(00000000)              call    set_page_rom
  1152 00000948 C9                        leave
  1153                                  
  1154                                    ;------__STACK_KERNEL_PHY-----------
  1155                                    ; ->Cargo DPTE y PTE
  1156 00000949 55                        push    ebp
  1157 0000094A 89E5                      mov     ebp, esp 
  1158 0000094C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1159 0000094E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1160 00000950 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1161 00000952 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1162 00000954 68[00000000]              push    __STACK_KERNEL_PHY     
  1163 00000959 68[00000000]              push    __STACK_KERNEL_VMA 
  1164 0000095E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1165 00000963 E8(00000000)              call    set_page_rom
  1166 00000968 C9                        leave
  1167                                  
  1168                                    ;------TSS_3-----------
  1169                                    ; ->Cargo DPTE y PTE
  1170 00000969 55                        push    ebp
  1171 0000096A 89E5                      mov     ebp, esp 
  1172 0000096C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1173 0000096E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1174 00000970 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1175 00000972 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1176 00000974 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
  1177 00000979 68[00000000]              push    __TSS3_VMA 
  1178 0000097E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT de la Tarea 3 
  1179 00000983 E8(00000000)              call    set_page_rom
  1180 00000988 C9                        leave
  1181                                  
  1182                                    ;------__TSS_BASICA-----------
  1183                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1184                                    ; las pilas de nivel 0.
  1185                                    ; ->Cargo DPTE y PTE
  1186 00000989 55                        push    ebp
  1187 0000098A 89E5                      mov     ebp, esp 
  1188 0000098C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1189 0000098E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1190 00000990 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1191 00000992 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1192 00000994 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1193 00000999 68[00000000]              push    __TSS_BASICA 
  1194 0000099E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT del Kernel 
  1195 000009A3 E8(00000000)              call    set_page_rom
  1196 000009A8 C9                        leave
  1197                                  
  1198                                  
  1199                                  
  1200                                    ;--------------------------------------------
  1201                                    ;-----------Mapeo de la Tarea 4 -------------
  1202                                    ;--------------------------------------------
  1203                                    ;------------__CR3_TAREA_4_PHY                            = Base del DTP de la Tarea 4
  1204                                    ;------------__CR3_TAREA_4_PHY + 0x1000                   = Tamaño del DTP
  1205                                    ;-----------(__CR3_TAREA_4_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1206                                  
  1207                                    ;------__TECLADO_ISR_PHY-----------
  1208                                    ; ->Cargo DPTE y PTE
  1209 000009A9 55                        push    ebp
  1210 000009AA 89E5                      mov     ebp, esp 
  1211 000009AC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1212 000009AE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1213 000009B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1214 000009B2 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
  1215 000009B4 68[00000000]              push    __TECLADO_ISR_PHY     
  1216 000009B9 68[00000000]              push    __TECLADO_ISR_VMA 
  1217 000009BE 68[00000000]              push    __CR3_TAREA_4_PHY   ; Base del DPT de la Tarea 4 
  1218 000009C3 E8(00000000)              call    set_page_rom
  1219 000009C8 C9                        leave
  1220                                    ;------__VGA_PHY-----------
  1221                                    ; ->Cargo DPTE y PTE
  1222 000009C9 55                        push    ebp
  1223 000009CA 89E5                      mov     ebp, esp 
  1224 000009CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1225 000009CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1226 000009D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1227 000009D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1228 000009D4 68[00000000]              push    __VGA_PHY     
  1229 000009D9 68[00000000]              push    __VGA_VMA 
  1230 000009DE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1231 000009E3 E8(00000000)              call    set_page_rom
  1232 000009E8 C9                        leave
  1233                                  
  1234                                    ;------__FUNCTIONS_PHY-----------
  1235                                    ; ->Cargo DPTE y PTE
  1236 000009E9 55                        push    ebp
  1237 000009EA 89E5                      mov     ebp, esp 
  1238 000009EC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1239 000009EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1240 000009F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1241 000009F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1242 000009F4 68[00000000]              push    __FUNCTIONS_PHY     
  1243 000009F9 68[00000000]              push    __FUNCTIONS_VMA 
  1244 000009FE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1245 00000A03 E8(00000000)              call    set_page_rom
  1246 00000A08 C9                        leave
  1247                                  
  1248                                    ;------__DATOS_SYS32_PHY-----------
  1249                                    ; ->Cargo DPTE y PTE
  1250 00000A09 55                        push    ebp
  1251 00000A0A 89E5                      mov     ebp, esp 
  1252 00000A0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1253 00000A0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1254 00000A10 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1255 00000A12 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1256 00000A14 68[00000000]              push    __DATOS_SYS32_PHY     
  1257 00000A19 68[00000000]              push    __DATOS_SYS32_VMA 
  1258 00000A1E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1259 00000A23 E8(00000000)              call    set_page_rom
  1260 00000A28 C9                        leave
  1261                                  
  1262                                    ;------__DIGITS_TABLE_PHY-----------
  1263                                    ; ->Cargo DPTE y PTE
  1264 00000A29 55                        push    ebp
  1265 00000A2A 89E5                      mov     ebp, esp 
  1266 00000A2C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1267 00000A2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1268 00000A30 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1269 00000A32 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1270 00000A34 68[00000000]              push    __DIGITS_TABLE_PHY     
  1271 00000A39 68[00000000]              push    __DIGITS_TABLE_VMA 
  1272 00000A3E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1273 00000A43 E8(00000000)              call    set_page_rom
  1274 00000A48 C9                        leave
  1275                                  
  1276                                    ;------__SYS_TABLES_PHY-----------
  1277                                    ; ->Cargo DPTE y PTE
  1278 00000A49 55                        push    ebp
  1279 00000A4A 89E5                      mov     ebp, esp 
  1280 00000A4C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1281 00000A4E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1282 00000A50 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1283 00000A52 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1284 00000A54 68[00000000]              push    __SYS_TABLES_PHY     
  1285 00000A59 68[00000000]              push    __SYS_TABLES_VMA 
  1286 00000A5E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1287 00000A63 E8(00000000)              call    set_page_rom
  1288 00000A68 C9                        leave
  1289                                  
  1290                                    ;------__TAREA4_TEXT_PHY-----------
  1291                                    ; ->Cargo DPTE y PTE
  1292 00000A69 55                        push    ebp
  1293 00000A6A 89E5                      mov     ebp, esp 
  1294 00000A6C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1295 00000A6E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1296 00000A70 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1297 00000A72 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1298 00000A74 68[00000000]              push    __TAREA4_TEXT_PHY     
  1299 00000A79 68[00000000]              push    __TAREA4_TEXT_VMA 
  1300 00000A7E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1301 00000A83 E8(00000000)              call    set_page_rom
  1302 00000A88 C9                        leave
  1303                                  
  1304                                    ;------__TAREA4_BSS_PHY-----------
  1305                                    ; ->Cargo DPTE y PTE
  1306 00000A89 55                        push    ebp
  1307 00000A8A 89E5                      mov     ebp, esp 
  1308 00000A8C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1309 00000A8E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1310 00000A90 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1311 00000A92 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1312 00000A94 68[00000000]              push    __TAREA4_BSS_PHY     
  1313 00000A99 68[00000000]              push    __TAREA4_BSS_VMA 
  1314 00000A9E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1315 00000AA3 E8(00000000)              call    set_page_rom
  1316 00000AA8 C9                        leave
  1317                                  
  1318                                    ;------__TAREA4_DATA_PHY-----------
  1319                                    ; ->Cargo DPTE y PTE
  1320 00000AA9 55                        push    ebp
  1321 00000AAA 89E5                      mov     ebp, esp 
  1322 00000AAC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1323 00000AAE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1324 00000AB0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1325 00000AB2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1326 00000AB4 68[00000000]              push    __TAREA4_DATA_PHY     
  1327 00000AB9 68[00000000]              push    __TAREA4_DATA_VMA 
  1328 00000ABE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1329 00000AC3 E8(00000000)              call    set_page_rom
  1330 00000AC8 C9                        leave
  1331                                    
  1332                                    ;------__TAREA4_STACK_START_PHY-----------
  1333                                    ; ->Cargo DPTE y PTE
  1334 00000AC9 55                        push    ebp
  1335 00000ACA 89E5                      mov     ebp, esp 
  1336 00000ACC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1337 00000ACE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1338 00000AD0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1339 00000AD2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1340 00000AD4 68[00000000]              push    __TAREA4_STACK_START_PHY     
  1341 00000AD9 68[00000000]              push    __TAREA4_STACK_START_VMA 
  1342 00000ADE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1343 00000AE3 E8(00000000)              call    set_page_rom
  1344 00000AE8 C9                        leave
  1345                                  
  1346                                    ;------__STACK_KERNEL_PHY-----------
  1347                                    ; ->Cargo DPTE y PTE
  1348 00000AE9 55                        push    ebp
  1349 00000AEA 89E5                      mov     ebp, esp 
  1350 00000AEC 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1351 00000AEE 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1352 00000AF0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1353 00000AF2 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1354 00000AF4 68[00000000]              push    __STACK_KERNEL_PHY     
  1355 00000AF9 68[00000000]              push    __STACK_KERNEL_VMA 
  1356 00000AFE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 3 
  1357 00000B03 E8(00000000)              call    set_page_rom
  1358 00000B08 C9                        leave
  1359                                  
  1360                                    ;------TSS_4-----------
  1361                                    ; ->Cargo DPTE y PTE
  1362 00000B09 55                        push    ebp
  1363 00000B0A 89E5                      mov     ebp, esp 
  1364 00000B0C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1365 00000B0E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1366 00000B10 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1367 00000B12 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1368 00000B14 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
  1369 00000B19 68[00000000]              push    __TSS4_VMA 
  1370 00000B1E 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT de la Tarea 4 
  1371 00000B23 E8(00000000)              call    set_page_rom
  1372 00000B28 C9                        leave
  1373                                    
  1374                                    ;------____TSS_BASICA-----------
  1375                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1376                                    ; las pilas de nivel 0.
  1377                                    ; ->Cargo DPTE y PTE
  1378 00000B29 55                        push    ebp
  1379 00000B2A 89E5                      mov     ebp, esp 
  1380 00000B2C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1381 00000B2E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1382 00000B30 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1383 00000B32 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1384 00000B34 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1385 00000B39 68[00000000]              push    __TSS_BASICA 
  1386 00000B3E 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT del Kernel 
  1387 00000B43 E8(00000000)              call    set_page_rom
  1388 00000B48 C9                        leave
  1389                                  
  1390                                    ;--------------------------------------------
  1391                                    ;-----------FIN PAGINACIÓN-------------------
  1392                                    ;--------------------------------------------
  1393                                  
  1394                                    ; -> Habilito la paginación
  1395 00000B49 0F20C0                    mov   eax, cr0 
  1396 00000B4C 0D00000080                or    eax, X86_CR0_PG
  1397 00000B51 0F22C0                    mov   cr0, eax
  1398                                  
  1399                                    ; ------------- HASTA ACA ANDA, PAGINA BIEN. HUBO QUE CAMBIAR BASES DE LOS CR3 PORQUE SE PISABAN.--------------
  1400                                    ;-----------------------------------------------------------------------------------------------
  1401                                  
  1402                                    ;--------------------------------------------
  1403                                    ;-> Inicializo las TSS de las Tareas
  1404                                    ;--------------------------------------------
  1405                                    ; __TSS_BASICA                    = 0x40000000;
  1406                                    ; __TSS1_VMA                      = 0x40001000;
  1407                                    ; __TSS2_VMA                      = 0x40002000;
  1408                                    ; __TSS3_VMA                      = 0x40003000;
  1409                                    ; __TSS4_VMA                      = 0x40004000;
  1410                                  
  1411                                    ; -------------TSS_1--------------
  1412 00000B54 55                        push    ebp
  1413 00000B55 89E5                      mov     ebp, esp 
  1414 00000B57 68[00000000]              push    __TSS1_VMA                      ; TSS de la tarea
  1415 00000B5C 68[00000000]              push    __CR3_TAREA_1_PHY               ; CR3 de la tarea
  1416 00000B61 68[00000000]              push    __TAREA1_STACK_END_VMA          ; STACK de la tarea
  1417 00000B66 68[00000000]              push    __STACK_KERNEL_TAREA1_END_VMA   ; STACK del Kernel
  1418 00000B6B 68[00000000]              push    ejecutar_tarea_1                ; Dir. de inicio de la tarea
  1419 00000B70 E8(00000000)              call init_tss
  1420 00000B75 C9                        leave
  1421                                  
  1422                                    ; -------------TSS_2--------------
  1423 00000B76 55                        push    ebp
  1424 00000B77 89E5                      mov     ebp, esp 
  1425 00000B79 68[00000000]              push     __TSS2_VMA                      ; TSS de la tarea
  1426 00000B7E 68[00000000]              push     __CR3_TAREA_2_PHY               ; CR3 de la tarea
  1427 00000B83 68[00000000]              push     __TAREA2_STACK_END_VMA          ; STACK de la tarea
  1428 00000B88 68[00000000]              push     __STACK_KERNEL_TAREA2_END_VMA   ; STACK del Kernel
  1429 00000B8D 68[00000000]              push     ejecutar_tarea_2                ; Dir. de inicio de la tarea
  1430 00000B92 E8(00000000)              call init_tss
  1431 00000B97 C9                        leave
  1432                                  
  1433                                    ; -------------TSS_3--------------
  1434 00000B98 55                        push    ebp
  1435 00000B99 89E5                      mov     ebp, esp 
  1436 00000B9B 68[00000000]              push     __TSS3_VMA                      ; TSS de la tarea
  1437 00000BA0 68[00000000]              push     __CR3_TAREA_3_PHY               ; CR3 de la tarea
  1438 00000BA5 68[00000000]              push     __TAREA3_STACK_END_VMA          ; STACK de la tarea
  1439 00000BAA 68[00000000]              push     __STACK_KERNEL_TAREA3_END_VMA   ; STACK del Kernel
  1440 00000BAF 68[00000000]              push     ejecutar_tarea_3                ; Dir. de inicio de la tarea
  1441 00000BB4 E8(00000000)              call init_tss
  1442 00000BB9 C9                        leave
  1443                                  
  1444                                    ; -------------TSS_4--------------
  1445 00000BBA 55                        push    ebp
  1446 00000BBB 89E5                      mov     ebp, esp 
  1447 00000BBD 68[00000000]              push    __TSS4_VMA                      ; TSS de la tarea
  1448 00000BC2 68[00000000]              push    __CR3_TAREA_4_PHY               ; CR3 de la tarea
  1449 00000BC7 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea
  1450 00000BCC 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1451 00000BD1 68[00000000]              push    ejecutar_tarea_4                ; Dir. de inicio de la tarea
  1452 00000BD6 E8(00000000)              call init_tss
  1453 00000BDB C9                        leave
  1454                                  
  1455                                    ; -------------TSS_BASICA para el CPU--------------
  1456 00000BDC 55                        push    ebp
  1457 00000BDD 89E5                      mov     ebp, esp 
  1458 00000BDF 68[00000000]              push    __TSS_BASICA                    ; TSS para el CPU
  1459 00000BE4 68[00000000]              push    __CR3_KERNEL_PHY                ; CR3 del Kernel
  1460 00000BE9 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea que primero corre. (la TAREA 4 - HALT)
  1461 00000BEE 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1462 00000BF3 68[00000000]              push    kernel32_init                   ; Dir. de inicio del Kernel
  1463 00000BF8 E8(00000000)              call    init_tss
  1464 00000BFD C9                        leave
  1465                                  
  1466                                   ;-> Cargo Selector de la TSS_BASICA
  1467 00000BFE 66B8[0000]                mov     ax, TSS_SEL
  1468 00000C02 0F00D8                    ltr     ax
  1469                                  
  1470                                    ; -> Habilito interrupciones
  1471 00000C05 FB                        sti                                   
  1472 00000C06 EA[00000000][0000]        jmp CS_SEL_00:kernel32_init             ; Salto en memoria a la sección del Kernel
  1473                                  
  1474                                  .guard:
  1475 00000C0D F4                        hlt
  1476 00000C0E EBFD                      jmp .guard
  1477                                  
  1478                                  
