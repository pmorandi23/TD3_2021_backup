     1                                  USE32
     2                                  
     3                                  SECTION .start32
     4                                  
     5                                  %include "inc/processor-flags.h" 
     1                              <1> %define X86_CR0_PE      0x00000001 ; /* Protectede mode enable*/
     2                              <1> %define X86_CR0_MP      0x00000002 ; /* Monitor coProcessor*/
     3                              <1> %define X86_CR0_EM      0x00000004 ; /* Emulation*/
     4                              <1> %define X86_CR0_TS      0x00000008 ; /* Task Switched*/
     5                              <1> %define X86_CR0_ET      0x00000010 ; /* Extension Type*/
     6                              <1> %define X86_CR0_NE      0x00000020 ; /* Numeric Error*/
     7                              <1> %define X86_CR0_WP      0x00010000 ; /* Write Protect*/
     8                              <1> %define X86_CR0_AM      0x00040000 ; /* Alignment Mask*/
     9                              <1> %define X86_CR0_NW      0x20000000 ; /* Not Write-through*/
    10                              <1> %define X86_CR0_CD      0x40000000 ; /* Cache Disable*/
    11                              <1> %define X86_CR0_PG      0x80000000 ; /* PaGine*/
    12                              <1> %define flag_TSS_sup    1
    13                              <1> %define flag_TSS_us     0
    14                              <1> 
    15                              <1> ;------------DTP y TP(Descriptor de Tablas de Páginas y Tabla de Páginas) flags--------------------------
    16                              <1> PAG_PCD_YES  equ 1       ; cachable                          
    17                              <1> PAG_PCD_NO   equ 0       ; no cachable
    18                              <1> PAG_PWT_YES  equ 1       ; 1 se escribe en cache y ram       
    19                              <1> PAG_PWT_NO   equ 0       ; 0 
    20                              <1> PAG_P_YES    equ 1       ; 1 presente
    21                              <1> PAG_P_NO     equ 0       ; 0 no presente
    22                              <1> PAG_RW_W     equ 1       ; 1 lectura y escritura
    23                              <1> PAG_RW_R     equ 0       ; 0 solo lectura
    24                              <1> PAG_US_SUP   equ 0       ; 0 supervisor
    25                              <1> PAG_US_US    equ 1       ; 1 usuario  
    26                              <1> PAG_D        equ 0       ; modificacion en la pagina
    27                              <1> PAG_PAT      equ 0       ; PAT                   
    28                              <1> PAG_G_YES    equ 0       ; Global                 
    29                              <1> PAG_A        equ 0       ; accedida
    30                              <1> PAG_PS_4K    equ 0       ; tamaño de pagina de 4KB
    31                              <1> 
     6                                  
     7                                  ; Selectores de segmento
     8                                  EXTERN CS_SEL_00
     9                                  EXTERN DS_SEL_32_prim
    10                                  EXTERN TSS_SEL
    11                                  ; Stack 32 bits
    12                                  EXTERN __STACK_END_32_VMA
    13                                  EXTERN __STACK_KERNEL_END_VMA
    14                                  EXTERN __STACK_SIZE_32
    15                                  ; Etiquetas externas
    16                                  EXTERN kernel32_init
    17                                  EXTERN __fast_memcpy
    18                                  EXTERN __fast_memcpy_rom
    19                                  EXTERN init_pic
    20                                  EXTERN _idtr_32
    21                                  EXTERN _gdtr_32
    22                                  EXTERN init_timer
    23                                  EXTERN init_teclado
    24                                  EXTERN set_cr3_rom
    25                                  EXTERN tarea_1_asm
    26                                  EXTERN tarea_2_asm
    27                                  EXTERN tarea_3_asm
    28                                  EXTERN tarea_4_asm
    29                                  EXTERN ejecutar_tarea_4
    30                                  EXTERN set_page_rom
    31                                  EXTERN init_tss
    32                                  exter
    32          ******************       warning: label alone on a line without a colon might be in error [-w+orphan-labels]
    33                                  ; Direcciones LMA
    34                                  EXTERN __KERNEL_32_LMA
    35                                  EXTERN __TECLADO_ISR_LMA
    36                                  EXTERN __FUNCTIONS_LMA
    37                                  EXTERN __SYS_TABLES_LMA
    38                                  EXTERN __DATOS_SYS32_LMA
    39                                  EXTERN __TAREA1_BSS_LMA
    40                                  EXTERN __TAREA1_DATA_LMA
    41                                  EXTERN __TAREA1_TEXT_LMA
    42                                  EXTERN __TAREA1_RODATA_LMA
    43                                  EXTERN __TAREA2_BSS_LMA
    44                                  EXTERN __TAREA2_DATA_LMA
    45                                  EXTERN __TAREA2_TEXT_LMA
    46                                  EXTERN __TAREA2_RODATA_LMA
    47                                  EXTERN __TAREA3_BSS_LMA
    48                                  EXTERN __TAREA3_DATA_LMA
    49                                  EXTERN __TAREA3_TEXT_LMA
    50                                  EXTERN __TAREA3_RODATA_LMA
    51                                  EXTERN __TAREA4_BSS_LMA
    52                                  EXTERN __TAREA4_DATA_LMA
    53                                  EXTERN __TAREA4_TEXT_LMA
    54                                  EXTERN __TAREA4_RODATA_LMA
    55                                  ; Direcciones VMA
    56                                  EXTERN __DIGITS_TABLE_VMA
    57                                  EXTERN __TAREA1_BSS_VMA
    58                                  EXTERN __TAREA1_DATA_VMA
    59                                  EXTERN __TAREA1_TEXT_VMA
    60                                  EXTERN __TAREA1_RODATA_VMA
    61                                  EXTERN __TAREA2_BSS_VMA
    62                                  EXTERN __TAREA2_DATA_VMA
    63                                  EXTERN __TAREA2_TEXT_VMA
    64                                  EXTERN __TAREA2_RODATA_VMA
    65                                  EXTERN __TAREA3_BSS_VMA
    66                                  EXTERN __TAREA3_DATA_VMA
    67                                  EXTERN __TAREA3_TEXT_VMA
    68                                  EXTERN __TAREA3_RODATA_VMA
    69                                  EXTERN __TAREA4_BSS_VMA
    70                                  EXTERN __TAREA4_DATA_VMA
    71                                  EXTERN __TAREA4_TEXT_VMA
    72                                  EXTERN __TAREA4_RODATA_VMA
    73                                  EXTERN __STACK_KERNEL_VMA
    74                                  EXTERN __TAREA1_STACK_START_VMA
    75                                  EXTERN __TAREA2_STACK_START_VMA
    76                                  EXTERN __TAREA3_STACK_START_VMA
    77                                  EXTERN __TAREA4_STACK_START_VMA
    78                                  EXTERN __TAREA1_STACK_END_VMA
    79                                  EXTERN __TAREA2_STACK_END_VMA
    80                                  EXTERN __TAREA3_STACK_END_VMA
    81                                  EXTERN __TAREA4_STACK_END_VMA
    82                                  EXTERN __STACK_KERNEL_TAREA1_END_VMA
    83                                  EXTERN __STACK_KERNEL_TAREA2_END_VMA
    84                                  EXTERN __STACK_KERNEL_TAREA3_END_VMA
    85                                  EXTERN __STACK_KERNEL_TAREA4_END_VMA
    86                                  EXTERN __INIT_32_VMA
    87                                  EXTERN __KERNEL_32_VMA
    88                                  EXTERN __FUNCTIONS_VMA
    89                                  EXTERN __TECLADO_ISR_VMA
    90                                  EXTERN __SYS_TABLES_VMA
    91                                  EXTERN __DATOS_SYS32_VMA
    92                                  EXTERN __TAREA_1_VMA
    93                                  EXTERN __PAGE_TABLES_VMA
    94                                  EXTERN __VGA_VMA
    95                                  EXTERN __TAREA1_STACK_START_VMA
    96                                  EXTERN __INIT_16_VMA
    97                                  EXTERN __PAG_DINAMICA_INIT_VMA
    98                                  EXTERN __TSS4_VMA
    99                                  EXTERN __TSS3_VMA
   100                                  EXTERN __TSS2_VMA
   101                                  EXTERN __TSS1_VMA
   102                                  EXTERN __TSS_BASICA
   103                                  EXTERN __STACK_KERNEL_TAREA1_VMA
   104                                  EXTERN __STACK_KERNEL_TAREA2_VMA
   105                                  EXTERN __STACK_KERNEL_TAREA3_VMA
   106                                  EXTERN __STACK_KERNEL_TAREA4_VMA
   107                                  ; Direcciones físicas
   108                                  EXTERN __SYS_TABLES_PHY        
   109                                  EXTERN __PAGE_TABLES_PHY       
   110                                  EXTERN __FUNCTIONS_PHY         
   111                                  EXTERN __VGA_PHY               
   112                                  EXTERN __TECLADO_ISR_PHY       
   113                                  EXTERN __DATOS_SYS32_PHY       
   114                                  EXTERN __DIGITS_TABLE_PHY      
   115                                  EXTERN __KERNEL_32_PHY         
   116                                  EXTERN __TAREA1_TEXT_PHY       
   117                                  EXTERN __TAREA1_BSS_PHY        
   118                                  EXTERN __TAREA1_DATA_PHY       
   119                                  EXTERN __TAREA1_RODATA_PHY
   120                                  EXTERN __TAREA2_TEXT_PHY  
   121                                  EXTERN __TAREA2_BSS_PHY   
   122                                  EXTERN __TAREA2_DATA_PHY  
   123                                  EXTERN __TAREA2_RODATA_PHY
   124                                  EXTERN __TAREA3_TEXT_PHY  
   125                                  EXTERN __TAREA3_BSS_PHY   
   126                                  EXTERN __TAREA3_DATA_PHY  
   127                                  EXTERN __TAREA3_RODATA_PHY
   128                                  EXTERN __TAREA4_TEXT_PHY  
   129                                  EXTERN __TAREA4_BSS_PHY   
   130                                  EXTERN __TAREA4_DATA_PHY  
   131                                  EXTERN __TAREA4_RODATA_PHY
   132                                  EXTERN __STACK_KERNEL_PHY    
   133                                  EXTERN __TAREA1_STACK_START_PHY
   134                                  EXTERN __TAREA2_STACK_START_PHY
   135                                  EXTERN __TAREA3_STACK_START_PHY
   136                                  EXTERN __TAREA4_STACK_START_PHY
   137                                  EXTERN __INIT_ROM_PHY          
   138                                  EXTERN __RESET_PHY             
   139                                  EXTERN __STACK_KERNEL_END_PHY
   140                                  EXTERN __PAG_DINAMICA_INIT_PHY
   141                                  EXTERN __CR3_KERNEL_PHY
   142                                  EXTERN __CR3_TAREA_1_PHY
   143                                  EXTERN __CR3_TAREA_2_PHY
   144                                  EXTERN __CR3_TAREA_3_PHY
   145                                  EXTERN __CR3_TAREA_4_PHY
   146                                  EXTERN __STACK_KERNEL_TAREA1_PHY
   147                                  EXTERN __STACK_KERNEL_TAREA2_PHY
   148                                  EXTERN __STACK_KERNEL_TAREA3_PHY
   149                                  EXTERN __STACK_KERNEL_TAREA4_PHY
   150                                  
   151                                  ; Tamaños de códigos
   152                                  EXTERN __codigo_kernel32_size
   153                                  EXTERN __functions_size
   154                                  EXTERN __handlers_32_size
   155                                  EXTERN __sys_tables_size
   156                                  EXTERN __data_size
   157                                  EXTERN __tarea_01_size
   158                                  EXTERN __tarea_1_bss_size
   159                                  EXTERN __tarea_1_data_size
   160                                  EXTERN __tarea_1_rodata_size
   161                                  EXTERN __tarea_02_size
   162                                  EXTERN __tarea_2_bss_size
   163                                  EXTERN __tarea_2_data_size
   164                                  EXTERN __tarea_2_rodata_size
   165                                  EXTERN __tarea_03_size
   166                                  EXTERN __tarea_3_bss_size
   167                                  EXTERN __tarea_3_data_size
   168                                  EXTERN __tarea_3_rodata_size
   169                                  EXTERN __tarea_04_size
   170                                  EXTERN __tarea_4_bss_size
   171                                  EXTERN __tarea_4_data_size
   172                                  EXTERN __tarea_4_rodata_size
   173                                  ; Etiquetas globales
   174                                  GLOBAL start32_launcher
   175                                  
   176                                  start32_launcher:
   177                                    ;xchg    bx, bx ; Breakpoint. Estoy en 32 bits
   178                                    ; -> Inicializar los selectores de datos
   179 00000000 66B8[0000]                mov     ax, DS_SEL_32_prim ; Selector de la GDT de datos de 32 bits FLAT. Ahora puedo acceder a todos los datos de toda la memoria.
   180 00000004 8ED8                      mov     ds, ax
   181 00000006 8EC0                      mov     es, ax
   182 00000008 8EE8                      mov     gs, ax
   183 0000000A 8EE0                      mov     fs, ax
   184                                    ; -> Inicializar la pila en 32 bits
   185 0000000C 8ED0                      mov     ss, ax
   186 0000000E BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY
   187 00000013 31C0                      xor     eax, eax
   188                                    ; -> Limpio la pila
   189 00000015 B9[00000000]              mov     ecx, __STACK_SIZE_32 ; Cargo el tamaño del stack en el registro counter.
   190                                  .stack_init:
   191 0000001A 50                        push    eax ; Pusheo ceros en el stack.
   192 0000001B E2FD                      loop    .stack_init
   193 0000001D BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY ; Lo apunto al final
   194                                  
   195                                    ; -> Desempaquetamiento de la ROM (copia de las funciones a RAM)
   196 00000022 55                        push    ebp
   197 00000023 89E5                      mov     ebp, esp ; Genero el STACK FRAME
   198                                    ; -> Paso argumentos y llamo memcopy 
   199 00000025 68[00000000]              push    __functions_size
   200 0000002A 68[00000000]              push    __FUNCTIONS_PHY
   201 0000002F 68[00000000]              push    __FUNCTIONS_LMA
   202 00000034 E8(00000000)              call    __fast_memcpy_rom
   203 00000039 C9                        leave
   204 0000003A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   205 0000003D 0F85140D0000              jne     .guard
   206                                  
   207                                    ; -> Desempaquetamiento de la ROM (copia del kernel a RAM)
   208 00000043 55                        push    ebp
   209 00000044 89E5                      mov     ebp, esp 
   210 00000046 68[00000000]              push    __codigo_kernel32_size
   211 0000004B 68[00000000]              push    __KERNEL_32_PHY
   212 00000050 68[00000000]              push    __KERNEL_32_LMA
   213 00000055 E8(00000000)              call    __fast_memcpy
   214 0000005A C9                        leave
   215 0000005B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   216 0000005E 0F85F30C0000              jne     .guard
   217                                    ; -> Desempaquetamiento de la ROM (copia de los handlers Teclado + ISR a RAM)
   218 00000064 55                        push    ebp
   219 00000065 89E5                      mov     ebp, esp 
   220 00000067 68[00000000]              push    __handlers_32_size
   221 0000006C 68[00000000]              push    __TECLADO_ISR_PHY
   222 00000071 68[00000000]              push    __TECLADO_ISR_LMA
   223 00000076 E8(00000000)              call    __fast_memcpy
   224 0000007B C9                        leave
   225 0000007C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   226 0000007F 0F85D20C0000              jne     .guard
   227                                    ; -> Desempaquetamiento de la ROM (copia de datos de ROM a RAM)
   228 00000085 55                        push    ebp
   229 00000086 89E5                      mov     ebp, esp 
   230 00000088 68[00000000]              push    __data_size
   231 0000008D 68[00000000]              push    __DATOS_SYS32_PHY
   232 00000092 68[00000000]              push    __DATOS_SYS32_LMA
   233 00000097 E8(00000000)              call    __fast_memcpy
   234 0000009C C9                        leave
   235 0000009D 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   236 000000A0 0F85B10C0000              jne     .guard
   237                                    ; -> Desempaquetamiento de la ROM (copia de las tablas de sistema (GDT e IDT) a RAM)
   238 000000A6 55                        push    ebp
   239 000000A7 89E5                      mov     ebp, esp 
   240 000000A9 68[00000000]              push    __sys_tables_size
   241 000000AE 68[00000000]              push    __SYS_TABLES_PHY
   242 000000B3 68[00000000]              push    __SYS_TABLES_LMA
   243 000000B8 E8(00000000)              call    __fast_memcpy
   244 000000BD C9                        leave
   245 000000BE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   246 000000C1 0F85900C0000              jne     .guard
   247                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_1 a RAM)
   248 000000C7 55                        push    ebp
   249 000000C8 89E5                      mov     ebp, esp 
   250 000000CA 68[00000000]              push    __tarea_01_size
   251 000000CF 68[00000000]              push    __TAREA1_TEXT_PHY
   252 000000D4 68[00000000]              push    __TAREA1_TEXT_LMA
   253 000000D9 E8(00000000)              call    __fast_memcpy
   254 000000DE C9                        leave
   255 000000DF 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   256 000000E2 0F856F0C0000              jne     .guard
   257                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _1 a RAM)
   258 000000E8 55                        push    ebp
   259 000000E9 89E5                      mov     ebp, esp 
   260 000000EB 68[00000000]              push    __tarea_1_bss_size
   261 000000F0 68[00000000]              push    __TAREA1_BSS_PHY
   262 000000F5 68[00000000]              push    __TAREA1_BSS_LMA
   263 000000FA E8(00000000)              call    __fast_memcpy
   264 000000FF C9                        leave
   265 00000100 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   266 00000103 0F854E0C0000              jne     .guard
   267                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _1 a RAM)
   268 00000109 55                        push    ebp
   269 0000010A 89E5                      mov     ebp, esp 
   270 0000010C 68[00000000]              push    __tarea_1_data_size
   271 00000111 68[00000000]              push    __TAREA1_DATA_PHY
   272 00000116 68[00000000]              push    __TAREA1_DATA_LMA
   273 0000011B E8(00000000)              call    __fast_memcpy
   274 00000120 C9                        leave
   275 00000121 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   276 00000124 0F852D0C0000              jne     .guard
   277                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _1 a RAM)
   278 0000012A 55                        push    ebp
   279 0000012B 89E5                      mov     ebp, esp 
   280 0000012D 68[00000000]              push    __tarea_1_rodata_size
   281 00000132 68[00000000]              push    __TAREA1_RODATA_PHY
   282 00000137 68[00000000]              push    __TAREA1_RODATA_LMA
   283 0000013C E8(00000000)              call    __fast_memcpy
   284 00000141 C9                        leave
   285 00000142 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   286 00000145 0F850C0C0000              jne     .guard
   287                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_2 a RAM)
   288 0000014B 55                        push    ebp
   289 0000014C 89E5                      mov     ebp, esp 
   290 0000014E 68[00000000]              push    __tarea_02_size
   291 00000153 68[00000000]              push    __TAREA2_TEXT_PHY
   292 00000158 68[00000000]              push    __TAREA2_TEXT_LMA
   293 0000015D E8(00000000)              call    __fast_memcpy
   294 00000162 C9                        leave
   295 00000163 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   296 00000166 0F85EB0B0000              jne     .guard
   297                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _2 a RAM)
   298 0000016C 55                        push    ebp
   299 0000016D 89E5                      mov     ebp, esp 
   300 0000016F 68[00000000]              push    __tarea_2_bss_size
   301 00000174 68[00000000]              push    __TAREA2_BSS_PHY
   302 00000179 68[00000000]              push    __TAREA2_BSS_LMA
   303 0000017E E8(00000000)              call    __fast_memcpy
   304 00000183 C9                        leave
   305 00000184 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   306 00000187 0F85CA0B0000              jne     .guard
   307                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _2 a RAM)
   308 0000018D 55                        push    ebp
   309 0000018E 89E5                      mov     ebp, esp 
   310 00000190 68[00000000]              push    __tarea_2_data_size
   311 00000195 68[00000000]              push    __TAREA2_DATA_PHY
   312 0000019A 68[00000000]              push    __TAREA2_DATA_LMA
   313 0000019F E8(00000000)              call    __fast_memcpy
   314 000001A4 C9                        leave
   315 000001A5 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   316 000001A8 0F85A90B0000              jne     .guard
   317                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _2 a RAM)
   318 000001AE 55                        push    ebp
   319 000001AF 89E5                      mov     ebp, esp 
   320 000001B1 68[00000000]              push    __tarea_2_rodata_size
   321 000001B6 68[00000000]              push    __TAREA2_RODATA_PHY
   322 000001BB 68[00000000]              push    __TAREA2_RODATA_LMA
   323 000001C0 E8(00000000)              call    __fast_memcpy
   324 000001C5 C9                        leave
   325 000001C6 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   326 000001C9 0F85880B0000              jne     .guard
   327                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_3 a RAM)
   328 000001CF 55                        push    ebp
   329 000001D0 89E5                      mov     ebp, esp 
   330 000001D2 68[00000000]              push    __tarea_03_size
   331 000001D7 68[00000000]              push    __TAREA3_TEXT_PHY
   332 000001DC 68[00000000]              push    __TAREA3_TEXT_LMA
   333 000001E1 E8(00000000)              call    __fast_memcpy
   334 000001E6 C9                        leave
   335 000001E7 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   336 000001EA 0F85670B0000              jne     .guard
   337                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _3 a RAM)
   338 000001F0 55                        push    ebp
   339 000001F1 89E5                      mov     ebp, esp 
   340 000001F3 68[00000000]              push    __tarea_3_bss_size
   341 000001F8 68[00000000]              push    __TAREA3_BSS_PHY
   342 000001FD 68[00000000]              push    __TAREA3_BSS_LMA
   343 00000202 E8(00000000)              call    __fast_memcpy
   344 00000207 C9                        leave
   345 00000208 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   346 0000020B 0F85460B0000              jne     .guard
   347                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_3 a RAM)
   348 00000211 55                        push    ebp
   349 00000212 89E5                      mov     ebp, esp 
   350 00000214 68[00000000]              push    __tarea_3_data_size
   351 00000219 68[00000000]              push    __TAREA3_DATA_PHY
   352 0000021E 68[00000000]              push    __TAREA3_DATA_LMA
   353 00000223 E8(00000000)              call    __fast_memcpy
   354 00000228 C9                        leave
   355 00000229 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   356 0000022C 0F85250B0000              jne     .guard
   357                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _3 a RAM)
   358 00000232 55                        push    ebp
   359 00000233 89E5                      mov     ebp, esp 
   360 00000235 68[00000000]              push    __tarea_3_rodata_size
   361 0000023A 68[00000000]              push    __TAREA3_RODATA_PHY
   362 0000023F 68[00000000]              push    __TAREA3_RODATA_LMA
   363 00000244 E8(00000000)              call    __fast_memcpy
   364 00000249 C9                        leave
   365 0000024A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   366 0000024D 0F85040B0000              jne     .guard
   367                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_4 a RAM)
   368 00000253 55                        push    ebp
   369 00000254 89E5                      mov     ebp, esp 
   370 00000256 68[00000000]              push    __tarea_04_size
   371 0000025B 68[00000000]              push    __TAREA4_TEXT_PHY
   372 00000260 68[00000000]              push    __TAREA4_TEXT_LMA
   373 00000265 E8(00000000)              call    __fast_memcpy
   374 0000026A C9                        leave
   375 0000026B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   376 0000026E 0F85E30A0000              jne     .guard
   377                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA_4 a RAM)
   378 00000274 55                        push    ebp
   379 00000275 89E5                      mov     ebp, esp 
   380 00000277 68[00000000]              push    __tarea_4_bss_size
   381 0000027C 68[00000000]              push    __TAREA4_BSS_PHY
   382 00000281 68[00000000]              push    __TAREA4_BSS_LMA
   383 00000286 E8(00000000)              call    __fast_memcpy
   384 0000028B C9                        leave
   385 0000028C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   386 0000028F 0F85C20A0000              jne     .guard
   387                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_4 a RAM)
   388 00000295 55                        push    ebp
   389 00000296 89E5                      mov     ebp, esp 
   390 00000298 68[00000000]              push    __tarea_4_data_size
   391 0000029D 68[00000000]              push    __TAREA4_DATA_PHY
   392 000002A2 68[00000000]              push    __TAREA4_DATA_LMA
   393 000002A7 E8(00000000)              call    __fast_memcpy
   394 000002AC C9                        leave
   395 000002AD 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   396 000002B0 0F85A10A0000              jne     .guard
   397                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA_4 a RAM)
   398 000002B6 55                        push    ebp
   399 000002B7 89E5                      mov     ebp, esp 
   400 000002B9 68[00000000]              push    __tarea_4_rodata_size
   401 000002BE 68[00000000]              push    __TAREA4_RODATA_PHY
   402 000002C3 68[00000000]              push    __TAREA4_RODATA_LMA
   403 000002C8 E8(00000000)              call    __fast_memcpy
   404 000002CD C9                        leave
   405 000002CE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   406 000002D1 0F85800A0000              jne     .guard
   407                                  
   408                                    ;-> Cargo la IDT y la GDT ya copiada en RAM
   409 000002D7 0F0115[00000000]          lgdt [_gdtr_32]
   410 000002DE 0F011D[00000000]          lidt [_idtr_32]  
   411                                  
   412                                    ; -> Init PIC , IRQ y config. Timer y teclado
   413 000002E5 E8(00000000)              call init_teclado       ; Inicializo controlador de teclado
   414 000002EA E8(00000000)              call init_timer         ; Configuro Timer tick para 100ms
   415 000002EF E8(00000000)              call init_pic           ; Inicializo los PICs e interrupciones de Timer y Teclado
   416                                  
   417                                    ;----------------------------------------------
   418                                    ;-----------------PAGINACIÓN-------------------
   419                                    ;----------------------------------------------
   420                                  
   421                                    ; -> Inicializo CR3 con la dirección base del DPT correspondiente al Kernel.
   422 000002F4 55                        push    ebp
   423 000002F5 89E5                      mov     ebp, esp
   424 000002F7 6A01                      push    PAG_PWT_YES
   425 000002F9 6A01                      push    PAG_PCD_YES
   426 000002FB 68[00000000]              push    dword __CR3_KERNEL_PHY
   427 00000300 E8(00000000)              call    set_cr3_rom
   428 00000305 0F22D8                    mov     cr3, eax
   429 00000308 C9                        leave
   430                                  
   431                                    ;--------------------------------------------
   432                                    ;-----------Mapeo del Kernel-----------------
   433                                    ;--------------------------------------------
   434                                    ;------------CR3_KERNEL                       = Base del DTP del Kernel
   435                                    ;------------CR3_KERNEL + 0x1000              = Tamaño del DTP
   436                                    ;-----------(CR3 KERNEL + 0x1000)+0x1000*DPTE = Bases de las TP
   437                                  
   438                                    ; HANDLERS, VGA, SYS_TABLES, KERNEL_32, DIGITS_TABLE, DATA_SYS, STACK_SYS, INIT_32 (este código), __TSS_BASICA, TSS_1, TSS_2, TSS_3
   439                                  
   440                                    ;------__TECLADO_ISR_PHY-----------
   441                                    ; ->Cargo DPTE y PTE
   442 00000309 55                        push    ebp
   443 0000030A 89E5                      mov     ebp, esp
   444 0000030C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   445 0000030E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   446 00000310 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   447 00000312 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   448 00000314 68[00000000]              push    __TECLADO_ISR_PHY
   449 00000319 68[00000000]              push    __TECLADO_ISR_VMA 
   450 0000031E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   451 00000323 E8(00000000)              call    set_page_rom
   452 00000328 C9                        leave
   453                                  
   454                                  ;------__VGA_PHY-----------
   455                                  ; ->Cargo DPTE y PTE
   456 00000329 55                        push    ebp
   457 0000032A 89E5                      mov     ebp, esp 
   458 0000032C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   459 0000032E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   460 00000330 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   461 00000332 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   462 00000334 68[00000000]              push    __VGA_PHY
   463 00000339 68[00000000]              push    __VGA_VMA 
   464 0000033E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   465 00000343 E8(00000000)              call    set_page_rom
   466 00000348 C9                        leave
   467                                  
   468                                  ;------__SYS_TABLES_PHY-----------
   469                                    ; ->Cargo DPTE y PTE
   470 00000349 55                        push    ebp
   471 0000034A 89E5                      mov     ebp, esp 
   472 0000034C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   473 0000034E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   474 00000350 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   475 00000352 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   476 00000354 68[00000000]              push    __SYS_TABLES_PHY
   477 00000359 68[00000000]              push    __SYS_TABLES_VMA 
   478 0000035E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   479 00000363 E8(00000000)              call    set_page_rom
   480 00000368 C9                        leave
   481                                  
   482                                  ;------__KERNEL_32_PHY-----------
   483                                    ; ->Cargo DPTE y PTE
   484 00000369 55                        push    ebp
   485 0000036A 89E5                      mov     ebp, esp 
   486 0000036C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   487 0000036E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   488 00000370 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   489 00000372 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   490 00000374 68[00000000]              push    __KERNEL_32_PHY
   491 00000379 68[00000000]              push    __KERNEL_32_VMA 
   492 0000037E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   493 00000383 E8(00000000)              call    set_page_rom
   494 00000388 C9                        leave
   495                                  
   496                                  
   497                                  ;------1era pag de__FUNCTIONS_PHY-----------
   498                                    ; ->Cargo DPTE y PTE
   499 00000389 55                        push    ebp
   500 0000038A 89E5                      mov     ebp, esp 
   501 0000038C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   502 0000038E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   503 00000390 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   504 00000392 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   505 00000394 68[00000000]              push    __FUNCTIONS_PHY
   506 00000399 68[00000000]              push    __FUNCTIONS_VMA 
   507 0000039E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   508 000003A3 E8(00000000)              call    set_page_rom
   509 000003A8 C9                        leave
   510                                  
   511                                  
   512                                  ;------2da pag de__FUNCTIONS_PHY-----------
   513                                    ; ->Cargo DPTE y PTE
   514 000003A9 55                        push    ebp
   515 000003AA 89E5                      mov     ebp, esp 
   516 000003AC 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   517 000003AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   518 000003B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   519 000003B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   520 000003B4 68[00100000]              push    __FUNCTIONS_PHY + 0x1000
   521 000003B9 68[00100000]              push    __FUNCTIONS_VMA + 0x1000 
   522 000003BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   523 000003C3 E8(00000000)              call    set_page_rom
   524 000003C8 C9                        leave
   525                                  
   526                                  
   527                                  ;------__DIGITS_TABLE_PHY-----------
   528                                    ; ->Cargo DPTE y PTE
   529 000003C9 55                        push    ebp
   530 000003CA 89E5                      mov     ebp, esp 
   531 000003CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   532 000003CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   533 000003D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   534 000003D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   535 000003D4 68[00000000]              push    __DIGITS_TABLE_PHY
   536 000003D9 68[00000000]              push    __DIGITS_TABLE_VMA 
   537 000003DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   538 000003E3 E8(00000000)              call    set_page_rom
   539 000003E8 C9                        leave
   540                                  
   541                                  ;------__DATOS_SYS32_PHY-----------
   542                                    ; ->Cargo DPTE y PTE
   543 000003E9 55                        push    ebp
   544 000003EA 89E5                      mov     ebp, esp 
   545 000003EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   546 000003EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   547 000003F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   548 000003F2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   549 000003F4 68[00000000]              push    __DATOS_SYS32_PHY
   550 000003F9 68[00000000]              push    __DATOS_SYS32_VMA 
   551 000003FE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   552 00000403 E8(00000000)              call    set_page_rom
   553 00000408 C9                        leave
   554                                  
   555                                  
   556                                  ;------__STACK_KERNEL_VMA-----------
   557                                    ; ->Cargo DPTE y PTE
   558 00000409 55                        push    ebp
   559 0000040A 89E5                      mov     ebp, esp 
   560 0000040C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   561 0000040E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   562 00000410 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   563 00000412 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   564 00000414 68[00000000]              push    __STACK_KERNEL_PHY
   565 00000419 68[00000000]              push    __STACK_KERNEL_VMA 
   566 0000041E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   567 00000423 E8(00000000)              call    set_page_rom
   568 00000428 C9                        leave
   569                                  
   570                                  
   571                                  ;------__INIT_32_VMA-----------
   572                                    ; ->Cargo DPTE y PTE
   573 00000429 55                        push    ebp
   574 0000042A 89E5                      mov     ebp, esp 
   575 0000042C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   576 0000042E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   577 00000430 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   578 00000432 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   579 00000434 68[00000000]              push    __INIT_32_VMA     ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   580 00000439 68[00000000]              push    __INIT_32_VMA 
   581 0000043E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   582 00000443 E8(00000000)              call    set_page_rom
   583 00000448 C9                        leave
   584                                  
   585                                    ;------__INIT_32_VMA-----------
   586                                    ; ->Cargo DPTE y PTE
   587 00000449 55                        push    ebp
   588 0000044A 89E5                      mov     ebp, esp 
   589 0000044C 6A00                      push    PAG_RW_R                  ; Permisos R/W para el PTE
   590 0000044E 6A01                      push    PAG_RW_W                  ; Permisos R/W para el DPTE
   591 00000450 6A00                      push    PAG_US_SUP                ; Permisos de Supervisor/Usuario para el PTE
   592 00000452 6A00                      push    PAG_US_SUP                ; Permisos de Supervisor/Usuario para el DPTE
   593 00000454 68[00100000]              push    __INIT_32_VMA + 0x1000    ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   594 00000459 68[00100000]              push    __INIT_32_VMA + 0x1000 
   595 0000045E 68[00000000]              push    __CR3_KERNEL_PHY          ; Base del DPT del Kernel 
   596 00000463 E8(00000000)              call    set_page_rom
   597 00000468 C9                        leave
   598                                  
   599                                  ;------__TSS_BASICA-----------
   600                                    ; ->Cargo DPTE y PTE
   601 00000469 55                        push    ebp
   602 0000046A 89E5                      mov     ebp, esp 
   603 0000046C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   604 0000046E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   605 00000470 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   606 00000472 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   607 00000474 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   608 00000479 68[00000000]              push    __TSS_BASICA 
   609 0000047E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   610 00000483 E8(00000000)              call    set_page_rom
   611 00000488 C9                        leave
   612                                  
   613                                  ;------TSS_1-----------
   614                                    ; ->Cargo DPTE y PTE
   615 00000489 55                        push    ebp
   616 0000048A 89E5                      mov     ebp, esp 
   617 0000048C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   618 0000048E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   619 00000490 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   620 00000492 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   621 00000494 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   622 00000499 68[00000000]              push    __TSS1_VMA 
   623 0000049E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   624 000004A3 E8(00000000)              call    set_page_rom
   625 000004A8 C9                        leave
   626                                  
   627                                  ;------__TSS_2-----------
   628                                    ; ->Cargo DPTE y PTE
   629 000004A9 55                        push    ebp
   630 000004AA 89E5                      mov     ebp, esp 
   631 000004AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   632 000004AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   633 000004B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   634 000004B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   635 000004B4 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
   636 000004B9 68[00000000]              push    __TSS2_VMA 
   637 000004BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   638 000004C3 E8(00000000)              call    set_page_rom
   639 000004C8 C9                        leave
   640                                  
   641                                    ;------__TSS_3-----------
   642                                    ; ->Cargo DPTE y PTE
   643 000004C9 55                        push    ebp
   644 000004CA 89E5                      mov     ebp, esp 
   645 000004CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   646 000004CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   647 000004D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   648 000004D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   649 000004D4 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
   650 000004D9 68[00000000]              push    __TSS3_VMA 
   651 000004DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   652 000004E3 E8(00000000)              call    set_page_rom
   653 000004E8 C9                        leave
   654                                  
   655                                    ;------__TSS_4-----------
   656                                    ; ->Cargo DPTE y PTE
   657 000004E9 55                        push    ebp
   658 000004EA 89E5                      mov     ebp, esp 
   659 000004EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   660 000004EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   661 000004F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   662 000004F2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   663 000004F4 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
   664 000004F9 68[00000000]              push    __TSS4_VMA 
   665 000004FE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   666 00000503 E8(00000000)              call    set_page_rom
   667 00000508 C9                        leave
   668                                  
   669                                  
   670                                  
   671                                    ;--------------------------------------------
   672                                    ;-----------Mapeo de la Tarea 1 -------------
   673                                    ;--------------------------------------------
   674                                    ;------------__CR3_TAREA_1_PHY                            = Base del DTP de la Tarea 1
   675                                    ;------------__CR3_TAREA_1_PHY + 0x1000                   = Tamaño del DTP
   676                                    ;-----------(CR3 __CR3_TAREA_1_PHY + 0x1000)+0x1000*DPTE  = Bases de las TP
   677                                  
   678                                    ;------__TECLADO_ISR_PHY-----------
   679                                    ; ->Cargo DPTE y PTE
   680 00000509 55                        push    ebp
   681 0000050A 89E5                      mov     ebp, esp 
   682 0000050C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   683 0000050E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   684 00000510 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   685 00000512 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   686 00000514 68[00000000]              push    __TECLADO_ISR_PHY     
   687 00000519 68[00000000]              push    __TECLADO_ISR_VMA 
   688 0000051E 68[00000000]              push    __CR3_TAREA_1_PHY   ; Base del DPT de la Tarea 1 
   689 00000523 E8(00000000)              call    set_page_rom
   690 00000528 C9                        leave
   691                                    ;------__VGA_PHY-----------
   692                                    ; ->Cargo DPTE y PTE
   693 00000529 55                        push    ebp
   694 0000052A 89E5                      mov     ebp, esp 
   695 0000052C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   696 0000052E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   697 00000530 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   698 00000532 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   699 00000534 68[00000000]              push    __VGA_PHY     
   700 00000539 68[00000000]              push    __VGA_VMA 
   701 0000053E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   702 00000543 E8(00000000)              call    set_page_rom
   703 00000548 C9                        leave
   704                                  
   705                                    ;------__FUNCTIONS_PHY-----------
   706                                    ; ->Cargo DPTE y PTE
   707 00000549 55                        push    ebp
   708 0000054A 89E5                      mov     ebp, esp 
   709 0000054C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   710 0000054E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   711 00000550 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   712 00000552 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   713 00000554 68[00000000]              push    __FUNCTIONS_PHY     
   714 00000559 68[00000000]              push    __FUNCTIONS_VMA 
   715 0000055E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   716 00000563 E8(00000000)              call    set_page_rom
   717 00000568 C9                        leave
   718                                  
   719                                      ;------2da __FUNCTIONS_PHY-----------
   720                                    ; ->Cargo DPTE y PTE
   721 00000569 55                        push    ebp
   722 0000056A 89E5                      mov     ebp, esp 
   723 0000056C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   724 0000056E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   725 00000570 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   726 00000572 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   727 00000574 68[00100000]              push    __FUNCTIONS_PHY + 0x1000     
   728 00000579 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
   729 0000057E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   730 00000583 E8(00000000)              call    set_page_rom
   731 00000588 C9                        leave
   732                                  
   733                                  
   734                                    ;------__DATOS_SYS32_PHY-----------
   735                                    ; ->Cargo DPTE y PTE
   736 00000589 55                        push    ebp
   737 0000058A 89E5                      mov     ebp, esp 
   738 0000058C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   739 0000058E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   740 00000590 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   741 00000592 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   742 00000594 68[00000000]              push    __DATOS_SYS32_PHY     
   743 00000599 68[00000000]              push    __DATOS_SYS32_VMA 
   744 0000059E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   745 000005A3 E8(00000000)              call    set_page_rom
   746 000005A8 C9                        leave
   747                                  
   748                                    ;------__DIGITS_TABLE_PHY-----------
   749                                    ; ->Cargo DPTE y PTE
   750 000005A9 55                        push    ebp
   751 000005AA 89E5                      mov     ebp, esp 
   752 000005AC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   753 000005AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   754 000005B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   755 000005B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   756 000005B4 68[00000000]              push    __DIGITS_TABLE_PHY     
   757 000005B9 68[00000000]              push    __DIGITS_TABLE_VMA 
   758 000005BE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   759 000005C3 E8(00000000)              call    set_page_rom
   760 000005C8 C9                        leave
   761                                  
   762                                    ;------__SYS_TABLES_PHY-----------
   763                                    ; ->Cargo DPTE y PTE
   764 000005C9 55                        push    ebp
   765 000005CA 89E5                      mov     ebp, esp 
   766 000005CC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   767 000005CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   768 000005D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   769 000005D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   770 000005D4 68[00000000]              push    __SYS_TABLES_PHY     
   771 000005D9 68[00000000]              push    __SYS_TABLES_VMA 
   772 000005DE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   773 000005E3 E8(00000000)              call    set_page_rom
   774 000005E8 C9                        leave
   775                                  
   776                                    ;------__TAREA1_TEXT_PHY-----------
   777                                    ; ->Cargo DPTE y PTE
   778 000005E9 55                        push    ebp
   779 000005EA 89E5                      mov     ebp, esp 
   780 000005EC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   781 000005EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   782 000005F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   783 000005F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   784 000005F4 68[00000000]              push    __TAREA1_TEXT_PHY     
   785 000005F9 68[00000000]              push    __TAREA1_TEXT_VMA 
   786 000005FE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   787 00000603 E8(00000000)              call    set_page_rom
   788 00000608 C9                        leave
   789                                  
   790                                    ;------__TAREA1_BSS_PHY-----------
   791                                    ; ->Cargo DPTE y PTE
   792 00000609 55                        push    ebp
   793 0000060A 89E5                      mov     ebp, esp 
   794 0000060C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   795 0000060E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   796 00000610 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   797 00000612 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   798 00000614 68[00000000]              push    __TAREA1_BSS_PHY     
   799 00000619 68[00000000]              push    __TAREA1_BSS_VMA 
   800 0000061E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   801 00000623 E8(00000000)              call    set_page_rom
   802 00000628 C9                        leave
   803                                  
   804                                    ;------__TAREA1_DATA_PHY-----------
   805                                    ; ->Cargo DPTE y PTE
   806 00000629 55                        push    ebp
   807 0000062A 89E5                      mov     ebp, esp 
   808 0000062C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   809 0000062E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   810 00000630 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   811 00000632 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   812 00000634 68[00000000]              push    __TAREA1_DATA_PHY     
   813 00000639 68[00000000]              push    __TAREA1_DATA_VMA 
   814 0000063E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   815 00000643 E8(00000000)              call    set_page_rom
   816 00000648 C9                        leave
   817                                    
   818                                    ;------__TAREA1_STACK_START_PHY-----------
   819                                    ; ->Cargo DPTE y PTE
   820 00000649 55                        push    ebp
   821 0000064A 89E5                      mov     ebp, esp 
   822 0000064C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   823 0000064E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   824 00000650 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   825 00000652 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   826 00000654 68[00000000]              push    __TAREA1_STACK_START_PHY     
   827 00000659 68[00000000]              push    __TAREA1_STACK_START_VMA 
   828 0000065E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   829 00000663 E8(00000000)              call    set_page_rom
   830 00000668 C9                        leave
   831                                  
   832                                  
   833                                    ;------__STACK_KERNEL_TAREA1_PHY-----------
   834                                    ; ->Cargo DPTE y PTE
   835 00000669 55                        push    ebp
   836 0000066A 89E5                      mov     ebp, esp 
   837 0000066C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   838 0000066E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   839 00000670 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   840 00000672 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   841 00000674 68[00000000]              push    __STACK_KERNEL_TAREA1_PHY     
   842 00000679 68[00000000]              push    __STACK_KERNEL_TAREA1_VMA 
   843 0000067E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   844 00000683 E8(00000000)              call    set_page_rom
   845 00000688 C9                        leave
   846                                  
   847                                  
   848                                    ;------__STACK_KERNEL_PHY-----------
   849                                    ; ->Cargo DPTE y PTE
   850 00000689 55                        push    ebp
   851 0000068A 89E5                      mov     ebp, esp 
   852 0000068C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
   853 0000068E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
   854 00000690 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   855 00000692 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
   856 00000694 68[00000000]              push    __STACK_KERNEL_PHY     
   857 00000699 68[00000000]              push    __STACK_KERNEL_VMA 
   858 0000069E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   859 000006A3 E8(00000000)              call    set_page_rom
   860 000006A8 C9                        leave
   861                                  
   862                                    ;------__TSS_1-----------
   863                                    ; ->Cargo DPTE y PTE
   864 000006A9 55                        push    ebp
   865 000006AA 89E5                      mov     ebp, esp 
   866 000006AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   867 000006AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   868 000006B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   869 000006B2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   870 000006B4 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   871 000006B9 68[00000000]              push    __TSS1_VMA 
   872 000006BE 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   873 000006C3 E8(00000000)              call    set_page_rom
   874 000006C8 C9                        leave
   875                                    ;------____TSS_BASICA-----------
   876                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
   877                                    ; las pilas de nivel 0.
   878                                    ; ->Cargo DPTE y PTE
   879 000006C9 55                        push    ebp
   880 000006CA 89E5                      mov     ebp, esp 
   881 000006CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   882 000006CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   883 000006D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   884 000006D2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   885 000006D4 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   886 000006D9 68[00000000]              push    __TSS_BASICA 
   887 000006DE 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   888 000006E3 E8(00000000)              call    set_page_rom
   889 000006E8 C9                        leave
   890                                  
   891                                    ;--------------------------------------------
   892                                    ;-----------Mapeo de la Tarea 2 -------------
   893                                    ;--------------------------------------------
   894                                    ;------------__CR3_TAREA_2_PHY                            = Base del DTP de la Tarea 2
   895                                    ;------------__CR3_TAREA_2_PHY + 0x1000                   = Tamaño del DTP
   896                                    ;-----------(__CR3_TAREA_2_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
   897                                  
   898                                    ;------__TECLADO_ISR_PHY-----------
   899                                    ; ->Cargo DPTE y PTE
   900 000006E9 55                        push    ebp
   901 000006EA 89E5                      mov     ebp, esp 
   902 000006EC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   903 000006EE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   904 000006F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   905 000006F2 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   906 000006F4 68[00000000]              push    __TECLADO_ISR_PHY     
   907 000006F9 68[00000000]              push    __TECLADO_ISR_VMA 
   908 000006FE 68[00000000]              push    __CR3_TAREA_2_PHY   ; Base del DPT de la Tarea 1 
   909 00000703 E8(00000000)              call    set_page_rom
   910 00000708 C9                        leave
   911                                    ;------__VGA_PHY-----------
   912                                    ; ->Cargo DPTE y PTE
   913 00000709 55                        push    ebp
   914 0000070A 89E5                      mov     ebp, esp 
   915 0000070C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   916 0000070E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   917 00000710 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   918 00000712 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   919 00000714 68[00000000]              push    __VGA_PHY     
   920 00000719 68[00000000]              push    __VGA_VMA 
   921 0000071E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   922 00000723 E8(00000000)              call    set_page_rom
   923 00000728 C9                        leave
   924                                  
   925                                    ;------__FUNCTIONS_PHY-----------
   926                                    ; ->Cargo DPTE y PTE
   927 00000729 55                        push    ebp
   928 0000072A 89E5                      mov     ebp, esp 
   929 0000072C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   930 0000072E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   931 00000730 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   932 00000732 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   933 00000734 68[00000000]              push    __FUNCTIONS_PHY     
   934 00000739 68[00000000]              push    __FUNCTIONS_VMA 
   935 0000073E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   936 00000743 E8(00000000)              call    set_page_rom
   937 00000748 C9                        leave
   938                                  
   939                                      ;------2da __FUNCTIONS_PHY-----------
   940                                    ; ->Cargo DPTE y PTE
   941 00000749 55                        push    ebp
   942 0000074A 89E5                      mov     ebp, esp 
   943 0000074C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   944 0000074E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   945 00000750 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   946 00000752 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   947 00000754 68[00100000]              push    __FUNCTIONS_PHY + 0x1000    
   948 00000759 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
   949 0000075E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   950 00000763 E8(00000000)              call    set_page_rom
   951 00000768 C9                        leave
   952                                  
   953                                    ;------__DATOS_SYS32_PHY-----------
   954                                    ; ->Cargo DPTE y PTE
   955 00000769 55                        push    ebp
   956 0000076A 89E5                      mov     ebp, esp 
   957 0000076C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   958 0000076E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   959 00000770 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   960 00000772 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   961 00000774 68[00000000]              push    __DATOS_SYS32_PHY     
   962 00000779 68[00000000]              push    __DATOS_SYS32_VMA 
   963 0000077E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   964 00000783 E8(00000000)              call    set_page_rom
   965 00000788 C9                        leave
   966                                  
   967                                    ;------__DIGITS_TABLE_PHY-----------
   968                                    ; ->Cargo DPTE y PTE
   969 00000789 55                        push    ebp
   970 0000078A 89E5                      mov     ebp, esp 
   971 0000078C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   972 0000078E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   973 00000790 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   974 00000792 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   975 00000794 68[00000000]              push    __DIGITS_TABLE_PHY     
   976 00000799 68[00000000]              push    __DIGITS_TABLE_VMA 
   977 0000079E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   978 000007A3 E8(00000000)              call    set_page_rom
   979 000007A8 C9                        leave
   980                                  
   981                                    ;------__SYS_TABLES_PHY-----------
   982                                    ; ->Cargo DPTE y PTE
   983 000007A9 55                        push    ebp
   984 000007AA 89E5                      mov     ebp, esp 
   985 000007AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   986 000007AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   987 000007B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   988 000007B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   989 000007B4 68[00000000]              push    __SYS_TABLES_PHY     
   990 000007B9 68[00000000]              push    __SYS_TABLES_VMA 
   991 000007BE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   992 000007C3 E8(00000000)              call    set_page_rom
   993 000007C8 C9                        leave
   994                                  
   995                                    ;------__TAREA2_TEXT_PHY-----------
   996                                    ; ->Cargo DPTE y PTE
   997 000007C9 55                        push    ebp
   998 000007CA 89E5                      mov     ebp, esp 
   999 000007CC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1000 000007CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1001 000007D0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1002 000007D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1003 000007D4 68[00000000]              push    __TAREA2_TEXT_PHY     
  1004 000007D9 68[00000000]              push    __TAREA2_TEXT_VMA 
  1005 000007DE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1006 000007E3 E8(00000000)              call    set_page_rom
  1007 000007E8 C9                        leave
  1008                                  
  1009                                    ;------__TAREA2_BSS_PHY-----------
  1010                                    ; ->Cargo DPTE y PTE
  1011 000007E9 55                        push    ebp
  1012 000007EA 89E5                      mov     ebp, esp 
  1013 000007EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1014 000007EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1015 000007F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1016 000007F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1017 000007F4 68[00000000]              push    __TAREA2_BSS_PHY     
  1018 000007F9 68[00000000]              push    __TAREA2_BSS_VMA 
  1019 000007FE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1020 00000803 E8(00000000)              call    set_page_rom
  1021 00000808 C9                        leave
  1022                                  
  1023                                    ;------__TAREA2_DATA_PHY-----------
  1024                                    ; ->Cargo DPTE y PTE
  1025 00000809 55                        push    ebp
  1026 0000080A 89E5                      mov     ebp, esp 
  1027 0000080C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1028 0000080E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1029 00000810 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1030 00000812 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1031 00000814 68[00000000]              push    __TAREA2_DATA_PHY     
  1032 00000819 68[00000000]              push    __TAREA2_DATA_VMA 
  1033 0000081E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1034 00000823 E8(00000000)              call    set_page_rom
  1035 00000828 C9                        leave
  1036                                    
  1037                                    ;------__TAREA2_STACK_START_PHY-----------
  1038                                    ; ->Cargo DPTE y PTE
  1039 00000829 55                        push    ebp
  1040 0000082A 89E5                      mov     ebp, esp 
  1041 0000082C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1042 0000082E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1043 00000830 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1044 00000832 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1045 00000834 68[00000000]              push    __TAREA2_STACK_START_PHY     
  1046 00000839 68[00000000]              push    __TAREA2_STACK_START_VMA 
  1047 0000083E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1048 00000843 E8(00000000)              call    set_page_rom
  1049 00000848 C9                        leave
  1050                                  
  1051                                    ;------__STACK_KERNEL_TAREA2_PHY-----------
  1052                                    ; ->Cargo DPTE y PTE
  1053 00000849 55                        push    ebp
  1054 0000084A 89E5                      mov     ebp, esp 
  1055 0000084C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1056 0000084E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1057 00000850 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1058 00000852 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1059 00000854 68[00000000]              push    __STACK_KERNEL_TAREA2_PHY     
  1060 00000859 68[00000000]              push    __STACK_KERNEL_TAREA2_VMA 
  1061 0000085E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1062 00000863 E8(00000000)              call    set_page_rom
  1063 00000868 C9                        leave
  1064                                  
  1065                                  
  1066                                    ;------__STACK_KERNEL_PHY-----------
  1067                                    ; ->Cargo DPTE y PTE
  1068 00000869 55                        push    ebp
  1069 0000086A 89E5                      mov     ebp, esp 
  1070 0000086C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1071 0000086E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1072 00000870 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1073 00000872 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1074 00000874 68[00000000]              push    __STACK_KERNEL_PHY     
  1075 00000879 68[00000000]              push    __STACK_KERNEL_VMA 
  1076 0000087E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1077 00000883 E8(00000000)              call    set_page_rom
  1078 00000888 C9                        leave
  1079                                  
  1080                                    ;------TSS_2-----------
  1081                                    ; ->Cargo DPTE y PTE
  1082 00000889 55                        push    ebp
  1083 0000088A 89E5                      mov     ebp, esp 
  1084 0000088C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1085 0000088E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1086 00000890 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1087 00000892 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1088 00000894 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
  1089 00000899 68[00000000]              push    __TSS2_VMA 
  1090 0000089E 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1091 000008A3 E8(00000000)              call    set_page_rom
  1092 000008A8 C9                        leave
  1093                                    ;------____TSS_BASICA-----------
  1094                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1095                                    ; las pilas de nivel 0.
  1096                                    ; ->Cargo DPTE y PTE
  1097 000008A9 55                        push    ebp
  1098 000008AA 89E5                      mov     ebp, esp 
  1099 000008AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1100 000008AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1101 000008B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1102 000008B2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1103 000008B4 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1104 000008B9 68[00000000]              push    __TSS_BASICA 
  1105 000008BE 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1106 000008C3 E8(00000000)              call    set_page_rom
  1107 000008C8 C9                        leave
  1108                                  
  1109                                  
  1110                                    ;--------------------------------------------
  1111                                    ;-----------Mapeo de la Tarea 3 -------------
  1112                                    ;--------------------------------------------
  1113                                    ;------------__CR3_TAREA_3_PHY                            = Base del DTP de la Tarea 3
  1114                                    ;------------__CR3_TAREA_3_PHY + 0x1000                   = Tamaño del DTP
  1115                                    ;-----------(__CR3_TAREA_3_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1116                                  
  1117                                    ;------__TECLADO_ISR_PHY-----------
  1118                                    ; ->Cargo DPTE y PTE
  1119 000008C9 55                        push    ebp
  1120 000008CA 89E5                      mov     ebp, esp 
  1121 000008CC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1122 000008CE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1123 000008D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1124 000008D2 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
  1125 000008D4 68[00000000]              push    __TECLADO_ISR_PHY     
  1126 000008D9 68[00000000]              push    __TECLADO_ISR_VMA 
  1127 000008DE 68[00000000]              push    __CR3_TAREA_3_PHY   ; Base del DPT de la Tarea 3 
  1128 000008E3 E8(00000000)              call    set_page_rom
  1129 000008E8 C9                        leave
  1130                                    ;------__VGA_PHY-----------
  1131                                    ; ->Cargo DPTE y PTE
  1132 000008E9 55                        push    ebp
  1133 000008EA 89E5                      mov     ebp, esp 
  1134 000008EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1135 000008EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1136 000008F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1137 000008F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1138 000008F4 68[00000000]              push    __VGA_PHY     
  1139 000008F9 68[00000000]              push    __VGA_VMA 
  1140 000008FE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1141 00000903 E8(00000000)              call    set_page_rom
  1142 00000908 C9                        leave
  1143                                  
  1144                                    ;------__FUNCTIONS_PHY-----------
  1145                                    ; ->Cargo DPTE y PTE
  1146 00000909 55                        push    ebp
  1147 0000090A 89E5                      mov     ebp, esp 
  1148 0000090C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1149 0000090E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1150 00000910 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1151 00000912 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1152 00000914 68[00000000]              push    __FUNCTIONS_PHY     
  1153 00000919 68[00000000]              push    __FUNCTIONS_VMA 
  1154 0000091E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1155 00000923 E8(00000000)              call    set_page_rom
  1156 00000928 C9                        leave
  1157                                  
  1158                                     ;------2da __FUNCTIONS_PHY-----------
  1159                                    ; ->Cargo DPTE y PTE
  1160 00000929 55                        push    ebp
  1161 0000092A 89E5                      mov     ebp, esp 
  1162 0000092C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1163 0000092E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1164 00000930 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1165 00000932 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1166 00000934 68[00100000]              push    __FUNCTIONS_PHY + 0x1000    
  1167 00000939 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
  1168 0000093E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1169 00000943 E8(00000000)              call    set_page_rom
  1170 00000948 C9                        leave
  1171                                  
  1172                                    ;------__DATOS_SYS32_PHY-----------
  1173                                    ; ->Cargo DPTE y PTE
  1174 00000949 55                        push    ebp
  1175 0000094A 89E5                      mov     ebp, esp 
  1176 0000094C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1177 0000094E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1178 00000950 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1179 00000952 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1180 00000954 68[00000000]              push    __DATOS_SYS32_PHY     
  1181 00000959 68[00000000]              push    __DATOS_SYS32_VMA 
  1182 0000095E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1183 00000963 E8(00000000)              call    set_page_rom
  1184 00000968 C9                        leave
  1185                                  
  1186                                    ;------__DIGITS_TABLE_PHY-----------
  1187                                    ; ->Cargo DPTE y PTE
  1188 00000969 55                        push    ebp
  1189 0000096A 89E5                      mov     ebp, esp 
  1190 0000096C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1191 0000096E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1192 00000970 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
  1193 00000972 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1194 00000974 68[00000000]              push    __DIGITS_TABLE_PHY     
  1195 00000979 68[00000000]              push    __DIGITS_TABLE_VMA 
  1196 0000097E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1197 00000983 E8(00000000)              call    set_page_rom
  1198 00000988 C9                        leave
  1199                                  
  1200                                    ;------__SYS_TABLES_PHY-----------
  1201                                    ; ->Cargo DPTE y PTE
  1202 00000989 55                        push    ebp
  1203 0000098A 89E5                      mov     ebp, esp 
  1204 0000098C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1205 0000098E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1206 00000990 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1207 00000992 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1208 00000994 68[00000000]              push    __SYS_TABLES_PHY     
  1209 00000999 68[00000000]              push    __SYS_TABLES_VMA 
  1210 0000099E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1211 000009A3 E8(00000000)              call    set_page_rom
  1212 000009A8 C9                        leave
  1213                                  
  1214                                    ;------__TAREA3_TEXT_PHY-----------
  1215                                    ; ->Cargo DPTE y PTE
  1216 000009A9 55                        push    ebp
  1217 000009AA 89E5                      mov     ebp, esp 
  1218 000009AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1219 000009AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1220 000009B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1221 000009B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1222 000009B4 68[00000000]              push    __TAREA3_TEXT_PHY     
  1223 000009B9 68[00000000]              push    __TAREA3_TEXT_VMA 
  1224 000009BE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1225 000009C3 E8(00000000)              call    set_page_rom
  1226 000009C8 C9                        leave
  1227                                  
  1228                                    ;------__TAREA3_BSS_PHY-----------
  1229                                    ; ->Cargo DPTE y PTE
  1230 000009C9 55                        push    ebp
  1231 000009CA 89E5                      mov     ebp, esp 
  1232 000009CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1233 000009CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1234 000009D0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1235 000009D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1236 000009D4 68[00000000]              push    __TAREA3_BSS_PHY     
  1237 000009D9 68[00000000]              push    __TAREA3_BSS_VMA 
  1238 000009DE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1239 000009E3 E8(00000000)              call    set_page_rom
  1240 000009E8 C9                        leave
  1241                                  
  1242                                    ;------__TAREA3_DATA_PHY-----------
  1243                                    ; ->Cargo DPTE y PTE
  1244 000009E9 55                        push    ebp
  1245 000009EA 89E5                      mov     ebp, esp 
  1246 000009EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1247 000009EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1248 000009F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1249 000009F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1250 000009F4 68[00000000]              push    __TAREA3_DATA_PHY     
  1251 000009F9 68[00000000]              push    __TAREA3_DATA_VMA 
  1252 000009FE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1253 00000A03 E8(00000000)              call    set_page_rom
  1254 00000A08 C9                        leave
  1255                                    
  1256                                    ;------__TAREA3_STACK_START_PHY-----------
  1257                                    ; ->Cargo DPTE y PTE
  1258 00000A09 55                        push    ebp
  1259 00000A0A 89E5                      mov     ebp, esp 
  1260 00000A0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1261 00000A0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1262 00000A10 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1263 00000A12 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1264 00000A14 68[00000000]              push    __TAREA3_STACK_START_PHY     
  1265 00000A19 68[00000000]              push    __TAREA3_STACK_START_VMA 
  1266 00000A1E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1267 00000A23 E8(00000000)              call    set_page_rom
  1268 00000A28 C9                        leave
  1269                                  
  1270                                  
  1271                                  
  1272                                    ;------__STACK_KERNEL_TAREA3_PHY-----------
  1273                                    ; ->Cargo DPTE y PTE
  1274 00000A29 55                        push    ebp
  1275 00000A2A 89E5                      mov     ebp, esp 
  1276 00000A2C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1277 00000A2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1278 00000A30 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1279 00000A32 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1280 00000A34 68[00000000]              push    __STACK_KERNEL_TAREA3_PHY     
  1281 00000A39 68[00000000]              push    __STACK_KERNEL_TAREA3_VMA 
  1282 00000A3E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 1 
  1283 00000A43 E8(00000000)              call    set_page_rom
  1284 00000A48 C9                        leave
  1285                                  
  1286                                  
  1287                                  
  1288                                    ;------__STACK_KERNEL_PHY-----------
  1289                                    ; ->Cargo DPTE y PTE
  1290 00000A49 55                        push    ebp
  1291 00000A4A 89E5                      mov     ebp, esp 
  1292 00000A4C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1293 00000A4E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1294 00000A50 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1295 00000A52 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1296 00000A54 68[00000000]              push    __STACK_KERNEL_PHY     
  1297 00000A59 68[00000000]              push    __STACK_KERNEL_VMA 
  1298 00000A5E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1299 00000A63 E8(00000000)              call    set_page_rom
  1300 00000A68 C9                        leave
  1301                                  
  1302                                    ;------TSS_3-----------
  1303                                    ; ->Cargo DPTE y PTE
  1304 00000A69 55                        push    ebp
  1305 00000A6A 89E5                      mov     ebp, esp 
  1306 00000A6C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1307 00000A6E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1308 00000A70 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1309 00000A72 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1310 00000A74 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
  1311 00000A79 68[00000000]              push    __TSS3_VMA 
  1312 00000A7E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT de la Tarea 3 
  1313 00000A83 E8(00000000)              call    set_page_rom
  1314 00000A88 C9                        leave
  1315                                  
  1316                                    ;------__TSS_BASICA-----------
  1317                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1318                                    ; las pilas de nivel 0.
  1319                                    ; ->Cargo DPTE y PTE
  1320 00000A89 55                        push    ebp
  1321 00000A8A 89E5                      mov     ebp, esp 
  1322 00000A8C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1323 00000A8E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1324 00000A90 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1325 00000A92 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1326 00000A94 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1327 00000A99 68[00000000]              push    __TSS_BASICA 
  1328 00000A9E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT del Kernel 
  1329 00000AA3 E8(00000000)              call    set_page_rom
  1330 00000AA8 C9                        leave
  1331                                  
  1332                                  
  1333                                  
  1334                                    ;--------------------------------------------
  1335                                    ;-----------Mapeo de la Tarea 4 -------------
  1336                                    ;--------------------------------------------
  1337                                    ;------------__CR3_TAREA_4_PHY                            = Base del DTP de la Tarea 4
  1338                                    ;------------__CR3_TAREA_4_PHY + 0x1000                   = Tamaño del DTP
  1339                                    ;-----------(__CR3_TAREA_4_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1340                                  
  1341                                    ;------__TECLADO_ISR_PHY-----------
  1342                                    ; ->Cargo DPTE y PTE
  1343 00000AA9 55                        push    ebp
  1344 00000AAA 89E5                      mov     ebp, esp 
  1345 00000AAC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1346 00000AAE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1347 00000AB0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1348 00000AB2 6A00                      push    PAG_US_SUP           ; Permisos de Usuario para el DPTE
  1349 00000AB4 68[00000000]              push    __TECLADO_ISR_PHY     
  1350 00000AB9 68[00000000]              push    __TECLADO_ISR_VMA 
  1351 00000ABE 68[00000000]              push    __CR3_TAREA_4_PHY   ; Base del DPT de la Tarea 4 
  1352 00000AC3 E8(00000000)              call    set_page_rom
  1353 00000AC8 C9                        leave
  1354                                    ;------__VGA_PHY-----------
  1355                                    ; ->Cargo DPTE y PTE
  1356 00000AC9 55                        push    ebp
  1357 00000ACA 89E5                      mov     ebp, esp 
  1358 00000ACC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1359 00000ACE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1360 00000AD0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1361 00000AD2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1362 00000AD4 68[00000000]              push    __VGA_PHY     
  1363 00000AD9 68[00000000]              push    __VGA_VMA 
  1364 00000ADE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1365 00000AE3 E8(00000000)              call    set_page_rom
  1366 00000AE8 C9                        leave
  1367                                  
  1368                                    ;------__FUNCTIONS_PHY-----------
  1369                                    ; ->Cargo DPTE y PTE
  1370 00000AE9 55                        push    ebp
  1371 00000AEA 89E5                      mov     ebp, esp 
  1372 00000AEC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1373 00000AEE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1374 00000AF0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1375 00000AF2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1376 00000AF4 68[00000000]              push    __FUNCTIONS_PHY     
  1377 00000AF9 68[00000000]              push    __FUNCTIONS_VMA 
  1378 00000AFE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1379 00000B03 E8(00000000)              call    set_page_rom
  1380 00000B08 C9                        leave
  1381                                  
  1382                                      ;------2da __FUNCTIONS_PHY-----------
  1383                                    ; ->Cargo DPTE y PTE
  1384 00000B09 55                        push    ebp
  1385 00000B0A 89E5                      mov     ebp, esp 
  1386 00000B0C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1387 00000B0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1388 00000B10 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1389 00000B12 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1390 00000B14 68[00100000]              push    __FUNCTIONS_PHY + 0x1000     
  1391 00000B19 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
  1392 00000B1E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1393 00000B23 E8(00000000)              call    set_page_rom
  1394 00000B28 C9                        leave
  1395                                  
  1396                                    ;------__DATOS_SYS32_PHY-----------
  1397                                    ; ->Cargo DPTE y PTE
  1398 00000B29 55                        push    ebp
  1399 00000B2A 89E5                      mov     ebp, esp 
  1400 00000B2C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1401 00000B2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1402 00000B30 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1403 00000B32 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1404 00000B34 68[00000000]              push    __DATOS_SYS32_PHY     
  1405 00000B39 68[00000000]              push    __DATOS_SYS32_VMA 
  1406 00000B3E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1407 00000B43 E8(00000000)              call    set_page_rom
  1408 00000B48 C9                        leave
  1409                                  
  1410                                    ;------__DIGITS_TABLE_PHY-----------
  1411                                    ; ->Cargo DPTE y PTE
  1412 00000B49 55                        push    ebp
  1413 00000B4A 89E5                      mov     ebp, esp 
  1414 00000B4C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1415 00000B4E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1416 00000B50 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
  1417 00000B52 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1418 00000B54 68[00000000]              push    __DIGITS_TABLE_PHY     
  1419 00000B59 68[00000000]              push    __DIGITS_TABLE_VMA 
  1420 00000B5E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1421 00000B63 E8(00000000)              call    set_page_rom
  1422 00000B68 C9                        leave
  1423                                  
  1424                                    ;------__SYS_TABLES_PHY-----------
  1425                                    ; ->Cargo DPTE y PTE
  1426 00000B69 55                        push    ebp
  1427 00000B6A 89E5                      mov     ebp, esp 
  1428 00000B6C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1429 00000B6E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1430 00000B70 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1431 00000B72 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1432 00000B74 68[00000000]              push    __SYS_TABLES_PHY     
  1433 00000B79 68[00000000]              push    __SYS_TABLES_VMA 
  1434 00000B7E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1435 00000B83 E8(00000000)              call    set_page_rom
  1436 00000B88 C9                        leave
  1437                                  
  1438                                    ;------__TAREA4_TEXT_PHY-----------
  1439                                    ; ->Cargo DPTE y PTE
  1440 00000B89 55                        push    ebp
  1441 00000B8A 89E5                      mov     ebp, esp 
  1442 00000B8C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1443 00000B8E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1444 00000B90 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1445 00000B92 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1446 00000B94 68[00000000]              push    __TAREA4_TEXT_PHY     
  1447 00000B99 68[00000000]              push    __TAREA4_TEXT_VMA 
  1448 00000B9E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1449 00000BA3 E8(00000000)              call    set_page_rom
  1450 00000BA8 C9                        leave
  1451                                  
  1452                                    ;------__TAREA4_BSS_PHY-----------
  1453                                    ; ->Cargo DPTE y PTE
  1454 00000BA9 55                        push    ebp
  1455 00000BAA 89E5                      mov     ebp, esp 
  1456 00000BAC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1457 00000BAE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1458 00000BB0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1459 00000BB2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1460 00000BB4 68[00000000]              push    __TAREA4_BSS_PHY     
  1461 00000BB9 68[00000000]              push    __TAREA4_BSS_VMA 
  1462 00000BBE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1463 00000BC3 E8(00000000)              call    set_page_rom
  1464 00000BC8 C9                        leave
  1465                                  
  1466                                    ;------__TAREA4_DATA_PHY-----------
  1467                                    ; ->Cargo DPTE y PTE
  1468 00000BC9 55                        push    ebp
  1469 00000BCA 89E5                      mov     ebp, esp 
  1470 00000BCC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1471 00000BCE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1472 00000BD0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1473 00000BD2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1474 00000BD4 68[00000000]              push    __TAREA4_DATA_PHY     
  1475 00000BD9 68[00000000]              push    __TAREA4_DATA_VMA 
  1476 00000BDE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1477 00000BE3 E8(00000000)              call    set_page_rom
  1478 00000BE8 C9                        leave
  1479                                    
  1480                                    ;------__TAREA4_STACK_START_PHY-----------
  1481                                    ; ->Cargo DPTE y PTE
  1482 00000BE9 55                        push    ebp
  1483 00000BEA 89E5                      mov     ebp, esp 
  1484 00000BEC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1485 00000BEE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1486 00000BF0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1487 00000BF2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1488 00000BF4 68[00000000]              push    __TAREA4_STACK_START_PHY     
  1489 00000BF9 68[00000000]              push    __TAREA4_STACK_START_VMA 
  1490 00000BFE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1491 00000C03 E8(00000000)              call    set_page_rom
  1492 00000C08 C9                        leave
  1493                                  
  1494                                  
  1495                                    ;------__STACK_KERNEL_TAREA4_PHY-----------
  1496                                    ; ->Cargo DPTE y PTE
  1497 00000C09 55                        push    ebp
  1498 00000C0A 89E5                      mov     ebp, esp 
  1499 00000C0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1500 00000C0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1501 00000C10 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1502 00000C12 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1503 00000C14 68[00000000]              push    __STACK_KERNEL_TAREA4_PHY     
  1504 00000C19 68[00000000]              push    __STACK_KERNEL_TAREA4_VMA 
  1505 00000C1E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 1 
  1506 00000C23 E8(00000000)              call    set_page_rom
  1507 00000C28 C9                        leave
  1508                                  
  1509                                  
  1510                                    ;------__STACK_KERNEL_PHY-----------
  1511                                    ; ->Cargo DPTE y PTE
  1512 00000C29 55                        push    ebp
  1513 00000C2A 89E5                      mov     ebp, esp 
  1514 00000C2C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1515 00000C2E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1516 00000C30 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1517 00000C32 6A00                      push    PAG_US_SUP            ; Permisos de Supervisor/Usuario para el DPTE
  1518 00000C34 68[00000000]              push    __STACK_KERNEL_PHY     
  1519 00000C39 68[00000000]              push    __STACK_KERNEL_VMA 
  1520 00000C3E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 3 
  1521 00000C43 E8(00000000)              call    set_page_rom
  1522 00000C48 C9                        leave
  1523                                  
  1524                                    ;------TSS_4-----------
  1525                                    ; ->Cargo DPTE y PTE
  1526 00000C49 55                        push    ebp
  1527 00000C4A 89E5                      mov     ebp, esp 
  1528 00000C4C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1529 00000C4E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1530 00000C50 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1531 00000C52 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el DPTE
  1532 00000C54 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
  1533 00000C59 68[00000000]              push    __TSS4_VMA 
  1534 00000C5E 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT de la Tarea 4 
  1535 00000C63 E8(00000000)              call    set_page_rom
  1536 00000C68 C9                        leave
  1537                                    
  1538                                  
  1539                                    ;------____TSS_BASICA-----------
  1540                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1541                                    ; las pilas de nivel 0.
  1542                                    ; ->Cargo DPTE y PTE
  1543 00000C69 55                        push    ebp
  1544 00000C6A 89E5                      mov     ebp, esp 
  1545 00000C6C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1546 00000C6E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1547 00000C70 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1548 00000C72 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el DPTE
  1549 00000C74 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1550 00000C79 68[00000000]              push    __TSS_BASICA 
  1551 00000C7E 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT del Kernel 
  1552 00000C83 E8(00000000)              call    set_page_rom
  1553 00000C88 C9                        leave
  1554                                  
  1555                                    ;--------------------------------------------
  1556                                    ;-----------FIN PAGINACIÓN-------------------
  1557                                    ;--------------------------------------------
  1558                                  
  1559                                    ; -> Habilito la paginación
  1560 00000C89 0F20C0                    mov   eax, cr0 
  1561 00000C8C 0D00000080                or    eax, X86_CR0_PG
  1562 00000C91 0F22C0                    mov   cr0, eax
  1563                                  
  1564                                    ; ------------- HASTA ACA ANDA, PAGINA BIEN. HUBO QUE CAMBIAR BASES DE LOS CR3 PORQUE SE PISABAN.--------------
  1565                                    ;-----------------------------------------------------------------------------------------------
  1566                                  
  1567                                    ;--------------------------------------------
  1568                                    ;-> Inicializo las TSS de las Tareas
  1569                                    ;--------------------------------------------
  1570                                    ; __TSS_BASICA                    = 0x40000000;
  1571                                    ; __TSS1_VMA                      = 0x40001000;
  1572                                    ; __TSS2_VMA                      = 0x40002000;
  1573                                    ; __TSS3_VMA                      = 0x40003000;
  1574                                    ; __TSS4_VMA                      = 0x40004000;
  1575                                  
  1576                                    ; -------------TSS_1--------------
  1577                                  
  1578 00000C94 55                        push    ebp
  1579 00000C95 89E5                      mov     ebp, esp
  1580 00000C97 6A00                      push    flag_TSS_us
  1581 00000C99 68[00000000]              push    __TSS1_VMA                      ; TSS de la tarea
  1582 00000C9E 68[00000000]              push    __CR3_TAREA_1_PHY               ; CR3 de la tarea
  1583 00000CA3 68[00000000]              push    __TAREA1_STACK_END_VMA          ; STACK de la tarea
  1584 00000CA8 68[00000000]              push    __STACK_KERNEL_TAREA1_END_VMA   ; STACK del Kernel
  1585 00000CAD 68[00000000]              push    tarea_1_asm                ; Dir. de inicio de la tarea
  1586 00000CB2 E8(00000000)              call init_tss
  1587 00000CB7 C9                        leave
  1588                                  
  1589                                  
  1590                                    ; -------------TSS_2--------------
  1591 00000CB8 55                        push    ebp
  1592 00000CB9 89E5                      mov     ebp, esp 
  1593 00000CBB 6A00                      push    flag_TSS_us
  1594 00000CBD 68[00000000]              push     __TSS2_VMA                      ; TSS de la tarea
  1595 00000CC2 68[00000000]              push     __CR3_TAREA_2_PHY               ; CR3 de la tarea
  1596 00000CC7 68[00000000]              push     __TAREA2_STACK_END_VMA          ; STACK de la tarea
  1597 00000CCC 68[00000000]              push     __STACK_KERNEL_TAREA2_END_VMA   ; STACK del Kernel
  1598 00000CD1 68[00000000]              push     tarea_2_asm                ; Dir. de inicio de la tarea
  1599 00000CD6 E8(00000000)              call     init_tss
  1600 00000CDB C9                        leave
  1601                                  
  1602                                    ; -------------TSS_3--------------
  1603 00000CDC 55                        push    ebp
  1604 00000CDD 89E5                      mov     ebp, esp 
  1605 00000CDF 6A00                      push    flag_TSS_us
  1606 00000CE1 68[00000000]              push     __TSS3_VMA                      ; TSS de la tarea
  1607 00000CE6 68[00000000]              push     __CR3_TAREA_3_PHY               ; CR3 de la tarea
  1608 00000CEB 68[00000000]              push     __TAREA3_STACK_END_VMA          ; STACK de la tarea
  1609 00000CF0 68[00000000]              push     __STACK_KERNEL_TAREA3_END_VMA   ; STACK del Kernel
  1610 00000CF5 68[00000000]              push     tarea_3_asm                ; Dir. de inicio de la tarea
  1611 00000CFA E8(00000000)              call     init_tss
  1612 00000CFF C9                        leave
  1613                                  
  1614                                    ; -------------TSS_4--------------
  1615 00000D00 55                        push    ebp
  1616 00000D01 89E5                      mov     ebp, esp 
  1617 00000D03 6A01                      push    flag_TSS_sup
  1618 00000D05 68[00000000]              push    __TSS4_VMA                      ; TSS de la tarea
  1619 00000D0A 68[00000000]              push    __CR3_TAREA_4_PHY               ; CR3 de la tarea
  1620 00000D0F 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea
  1621 00000D14 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1622 00000D19 68[00000000]              push    tarea_4_asm                ; Dir. de inicio de la tarea
  1623 00000D1E E8(00000000)              call    init_tss
  1624 00000D23 C9                        leave
  1625                                  
  1626                                    ; -------------TSS_BASICA para el CPU--------------
  1627 00000D24 55                        push    ebp
  1628 00000D25 89E5                      mov     ebp, esp 
  1629 00000D27 6A01                      push    flag_TSS_sup
  1630 00000D29 68[00000000]              push    __TSS_BASICA                    ; TSS para el CPU
  1631 00000D2E 68[00000000]              push    __CR3_KERNEL_PHY                ; CR3 del Kernel
  1632 00000D33 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea que primero corre. (la TAREA 4 - HALT)
  1633 00000D38 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1634 00000D3D 68[00000000]              push    kernel32_init                   ; Dir. de inicio del Kernel
  1635 00000D42 E8(00000000)              call    init_tss
  1636 00000D47 C9                        leave
  1637                                  
  1638                                    ;xchg bx, bx
  1639                                  
  1640                                   ;-> Cargo Selector de la TSS_BASICA
  1641 00000D48 66B8[0000]                mov     ax, TSS_SEL
  1642 00000D4C 0F00D8                    ltr     ax
  1643                                  
  1644                                    ; -> Habilito interrupciones
  1645 00000D4F FB                        sti                                   
  1646 00000D50 EA[00000000][0000]        jmp CS_SEL_00:kernel32_init             ; Salto en memoria a la sección del Kernel
  1647                                  
  1648                                  .guard:
  1649 00000D57 F4                        hlt
  1650 00000D58 EBFD                      jmp .guard
  1651                                  
  1652                                  
