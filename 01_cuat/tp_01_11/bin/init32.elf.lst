     1                                  USE32
     2                                  
     3                                  SECTION .start32
     4                                  
     5                                  %include "inc/processor-flags.h" 
     1                              <1> %define X86_CR0_PE      0x00000001 ; /* Protectede mode enable*/
     2                              <1> %define X86_CR0_MP      0x00000002 ; /* Monitor coProcessor*/
     3                              <1> %define X86_CR0_EM      0x00000004 ; /* Emulation*/
     4                              <1> %define X86_CR0_TS      0x00000008 ; /* Task Switched*/
     5                              <1> %define X86_CR0_ET      0x00000010 ; /* Extension Type*/
     6                              <1> %define X86_CR0_NE      0x00000020 ; /* Numeric Error*/
     7                              <1> %define X86_CR0_WP      0x00010000 ; /* Write Protect*/
     8                              <1> %define X86_CR0_AM      0x00040000 ; /* Alignment Mask*/
     9                              <1> %define X86_CR0_NW      0x20000000 ; /* Not Write-through*/
    10                              <1> %define X86_CR0_CD      0x40000000 ; /* Cache Disable*/
    11                              <1> %define X86_CR0_PG      0x80000000 ; /* PaGine*/
    12                              <1> %define flag_TSS_sup    1
    13                              <1> %define flag_TSS_us     0
    14                              <1> 
    15                              <1> ;------------DTP y TP(Descriptor de Tablas de Páginas y Tabla de Páginas) flags--------------------------
    16                              <1> PAG_PCD_YES  equ 1       ; cachable                          
    17                              <1> PAG_PCD_NO   equ 0       ; no cachable
    18                              <1> PAG_PWT_YES  equ 1       ; 1 se escribe en cache y ram       
    19                              <1> PAG_PWT_NO   equ 0       ; 0 
    20                              <1> PAG_P_YES    equ 1       ; 1 presente
    21                              <1> PAG_P_NO     equ 0       ; 0 no presente
    22                              <1> PAG_RW_W     equ 1       ; 1 lectura y escritura
    23                              <1> PAG_RW_R     equ 0       ; 0 solo lectura
    24                              <1> PAG_US_SUP   equ 0       ; 0 supervisor
    25                              <1> PAG_US_US    equ 1       ; 1 usuario  
    26                              <1> PAG_D        equ 0       ; modificacion en la pagina
    27                              <1> PAG_PAT      equ 0       ; PAT                   
    28                              <1> PAG_G_YES    equ 0       ; Global                 
    29                              <1> PAG_A        equ 0       ; accedida
    30                              <1> PAG_PS_4K    equ 0       ; tamaño de pagina de 4KB
    31                              <1> 
     6                                  
     7                                  ; Selectores de segmento
     8                                  EXTERN CS_SEL_00
     9                                  EXTERN DS_SEL_32_prim
    10                                  EXTERN TSS_SEL
    11                                  ; Stack 32 bits
    12                                  EXTERN __STACK_END_32_VMA
    13                                  EXTERN __STACK_KERNEL_END_VMA
    14                                  EXTERN __STACK_SIZE_32
    15                                  ; Etiquetas externas
    16                                  EXTERN kernel32_init
    17                                  EXTERN __fast_memcpy
    18                                  EXTERN __fast_memcpy_rom
    19                                  EXTERN init_pic
    20                                  EXTERN _idtr_32
    21                                  EXTERN _gdtr_32
    22                                  EXTERN init_timer
    23                                  EXTERN init_teclado
    24                                  EXTERN set_cr3_rom
    25                                  EXTERN ejecutar_tarea_1
    26                                  EXTERN ejecutar_tarea_2
    27                                  EXTERN ejecutar_tarea_3
    28                                  EXTERN ejecutar_tarea_4
    29                                  EXTERN set_page_rom
    30                                  EXTERN init_tss
    31                                  ; Direcciones LMA
    32                                  EXTERN __KERNEL_32_LMA
    33                                  EXTERN __TECLADO_ISR_LMA
    34                                  EXTERN __FUNCTIONS_LMA
    35                                  EXTERN __SYS_TABLES_LMA
    36                                  EXTERN __DATOS_SYS32_LMA
    37                                  EXTERN __TAREA1_BSS_LMA
    38                                  EXTERN __TAREA1_DATA_LMA
    39                                  EXTERN __TAREA1_TEXT_LMA
    40                                  EXTERN __TAREA1_RODATA_LMA
    41                                  EXTERN __TAREA2_BSS_LMA
    42                                  EXTERN __TAREA2_DATA_LMA
    43                                  EXTERN __TAREA2_TEXT_LMA
    44                                  EXTERN __TAREA2_RODATA_LMA
    45                                  EXTERN __TAREA3_BSS_LMA
    46                                  EXTERN __TAREA3_DATA_LMA
    47                                  EXTERN __TAREA3_TEXT_LMA
    48                                  EXTERN __TAREA3_RODATA_LMA
    49                                  EXTERN __TAREA4_BSS_LMA
    50                                  EXTERN __TAREA4_DATA_LMA
    51                                  EXTERN __TAREA4_TEXT_LMA
    52                                  EXTERN __TAREA4_RODATA_LMA
    53                                  ; Direcciones VMA
    54                                  EXTERN __DIGITS_TABLE_VMA
    55                                  EXTERN __TAREA1_BSS_VMA
    56                                  EXTERN __TAREA1_DATA_VMA
    57                                  EXTERN __TAREA1_TEXT_VMA
    58                                  EXTERN __TAREA1_RODATA_VMA
    59                                  EXTERN __TAREA2_BSS_VMA
    60                                  EXTERN __TAREA2_DATA_VMA
    61                                  EXTERN __TAREA2_TEXT_VMA
    62                                  EXTERN __TAREA2_RODATA_VMA
    63                                  EXTERN __TAREA3_BSS_VMA
    64                                  EXTERN __TAREA3_DATA_VMA
    65                                  EXTERN __TAREA3_TEXT_VMA
    66                                  EXTERN __TAREA3_RODATA_VMA
    67                                  EXTERN __TAREA4_BSS_VMA
    68                                  EXTERN __TAREA4_DATA_VMA
    69                                  EXTERN __TAREA4_TEXT_VMA
    70                                  EXTERN __TAREA4_RODATA_VMA
    71                                  EXTERN __STACK_KERNEL_VMA
    72                                  EXTERN __TAREA1_STACK_START_VMA
    73                                  EXTERN __TAREA2_STACK_START_VMA
    74                                  EXTERN __TAREA3_STACK_START_VMA
    75                                  EXTERN __TAREA4_STACK_START_VMA
    76                                  EXTERN __TAREA1_STACK_END_VMA
    77                                  EXTERN __TAREA2_STACK_END_VMA
    78                                  EXTERN __TAREA3_STACK_END_VMA
    79                                  EXTERN __TAREA4_STACK_END_VMA
    80                                  EXTERN __STACK_KERNEL_TAREA1_END_VMA
    81                                  EXTERN __STACK_KERNEL_TAREA2_END_VMA
    82                                  EXTERN __STACK_KERNEL_TAREA3_END_VMA
    83                                  EXTERN __STACK_KERNEL_TAREA4_END_VMA
    84                                  EXTERN __INIT_32_VMA
    85                                  EXTERN __KERNEL_32_VMA
    86                                  EXTERN __FUNCTIONS_VMA
    87                                  EXTERN __TECLADO_ISR_VMA
    88                                  EXTERN __SYS_TABLES_VMA
    89                                  EXTERN __DATOS_SYS32_VMA
    90                                  EXTERN __TAREA_1_VMA
    91                                  EXTERN __PAGE_TABLES_VMA
    92                                  EXTERN __VGA_VMA
    93                                  EXTERN __TAREA1_STACK_START_VMA
    94                                  EXTERN __INIT_16_VMA
    95                                  EXTERN __PAG_DINAMICA_INIT_VMA
    96                                  EXTERN __TSS4_VMA
    97                                  EXTERN __TSS3_VMA
    98                                  EXTERN __TSS2_VMA
    99                                  EXTERN __TSS1_VMA
   100                                  EXTERN __TSS_BASICA
   101                                  EXTERN __STACK_KERNEL_TAREA1_VMA
   102                                  EXTERN __STACK_KERNEL_TAREA2_VMA
   103                                  EXTERN __STACK_KERNEL_TAREA3_VMA
   104                                  EXTERN __STACK_KERNEL_TAREA4_VMA
   105                                  ; Direcciones físicas
   106                                  EXTERN __SYS_TABLES_PHY        
   107                                  EXTERN __PAGE_TABLES_PHY       
   108                                  EXTERN __FUNCTIONS_PHY         
   109                                  EXTERN __VGA_PHY               
   110                                  EXTERN __TECLADO_ISR_PHY       
   111                                  EXTERN __DATOS_SYS32_PHY       
   112                                  EXTERN __DIGITS_TABLE_PHY      
   113                                  EXTERN __KERNEL_32_PHY         
   114                                  EXTERN __TAREA1_TEXT_PHY       
   115                                  EXTERN __TAREA1_BSS_PHY        
   116                                  EXTERN __TAREA1_DATA_PHY       
   117                                  EXTERN __TAREA1_RODATA_PHY
   118                                  EXTERN __TAREA2_TEXT_PHY  
   119                                  EXTERN __TAREA2_BSS_PHY   
   120                                  EXTERN __TAREA2_DATA_PHY  
   121                                  EXTERN __TAREA2_RODATA_PHY
   122                                  EXTERN __TAREA3_TEXT_PHY  
   123                                  EXTERN __TAREA3_BSS_PHY   
   124                                  EXTERN __TAREA3_DATA_PHY  
   125                                  EXTERN __TAREA3_RODATA_PHY
   126                                  EXTERN __TAREA4_TEXT_PHY  
   127                                  EXTERN __TAREA4_BSS_PHY   
   128                                  EXTERN __TAREA4_DATA_PHY  
   129                                  EXTERN __TAREA4_RODATA_PHY
   130                                  EXTERN __STACK_KERNEL_PHY    
   131                                  EXTERN __TAREA1_STACK_START_PHY
   132                                  EXTERN __TAREA2_STACK_START_PHY
   133                                  EXTERN __TAREA3_STACK_START_PHY
   134                                  EXTERN __TAREA4_STACK_START_PHY
   135                                  EXTERN __INIT_ROM_PHY          
   136                                  EXTERN __RESET_PHY             
   137                                  EXTERN __STACK_KERNEL_END_PHY
   138                                  EXTERN __PAG_DINAMICA_INIT_PHY
   139                                  EXTERN __CR3_KERNEL_PHY
   140                                  EXTERN __CR3_TAREA_1_PHY
   141                                  EXTERN __CR3_TAREA_2_PHY
   142                                  EXTERN __CR3_TAREA_3_PHY
   143                                  EXTERN __CR3_TAREA_4_PHY
   144                                  EXTERN __STACK_KERNEL_TAREA1_PHY
   145                                  EXTERN __STACK_KERNEL_TAREA2_PHY
   146                                  EXTERN __STACK_KERNEL_TAREA3_PHY
   147                                  EXTERN __STACK_KERNEL_TAREA4_PHY
   148                                  
   149                                  ; Tamaños de códigos
   150                                  EXTERN __codigo_kernel32_size
   151                                  EXTERN __functions_size
   152                                  EXTERN __handlers_32_size
   153                                  EXTERN __sys_tables_size
   154                                  EXTERN __data_size
   155                                  EXTERN __tarea_01_size
   156                                  EXTERN __tarea_1_bss_size
   157                                  EXTERN __tarea_1_data_size
   158                                  EXTERN __tarea_1_rodata_size
   159                                  EXTERN __tarea_02_size
   160                                  EXTERN __tarea_2_bss_size
   161                                  EXTERN __tarea_2_data_size
   162                                  EXTERN __tarea_2_rodata_size
   163                                  EXTERN __tarea_03_size
   164                                  EXTERN __tarea_3_bss_size
   165                                  EXTERN __tarea_3_data_size
   166                                  EXTERN __tarea_3_rodata_size
   167                                  EXTERN __tarea_04_size
   168                                  EXTERN __tarea_4_bss_size
   169                                  EXTERN __tarea_4_data_size
   170                                  EXTERN __tarea_4_rodata_size
   171                                  ; Etiquetas globales
   172                                  GLOBAL start32_launcher
   173                                  
   174                                  start32_launcher:
   175                                    ;xchg    bx, bx ; Breakpoint. Estoy en 32 bits
   176                                    ; -> Inicializar los selectores de datos
   177 00000000 66B8[0000]                mov     ax, DS_SEL_32_prim ; Selector de la GDT de datos de 32 bits FLAT. Ahora puedo acceder a todos los datos de toda la memoria.
   178 00000004 8ED8                      mov     ds, ax
   179 00000006 8EC0                      mov     es, ax
   180 00000008 8EE8                      mov     gs, ax
   181 0000000A 8EE0                      mov     fs, ax
   182                                    ; -> Inicializar la pila en 32 bits
   183 0000000C 8ED0                      mov     ss, ax
   184 0000000E BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY
   185 00000013 31C0                      xor     eax, eax
   186                                    ; -> Limpio la pila
   187 00000015 B9[00000000]              mov     ecx, __STACK_SIZE_32 ; Cargo el tamaño del stack en el registro counter.
   188                                  .stack_init:
   189 0000001A 50                        push    eax ; Pusheo ceros en el stack.
   190 0000001B E2FD                      loop    .stack_init
   191 0000001D BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY ; Lo apunto al final
   192                                  
   193                                    ; -> Desempaquetamiento de la ROM (copia de las funciones a RAM)
   194 00000022 55                        push    ebp
   195 00000023 89E5                      mov     ebp, esp ; Genero el STACK FRAME
   196                                    ; -> Paso argumentos y llamo memcopy 
   197 00000025 68[00000000]              push    __functions_size
   198 0000002A 68[00000000]              push    __FUNCTIONS_PHY
   199 0000002F 68[00000000]              push    __FUNCTIONS_LMA
   200 00000034 E8(00000000)              call    __fast_memcpy_rom
   201 00000039 C9                        leave
   202 0000003A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   203 0000003D 0F85740C0000              jne     .guard
   204                                    ; -> Desempaquetamiento de la ROM (copia del kernel a RAM)
   205 00000043 55                        push    ebp
   206 00000044 89E5                      mov     ebp, esp 
   207 00000046 68[00000000]              push    __codigo_kernel32_size
   208 0000004B 68[00000000]              push    __KERNEL_32_PHY
   209 00000050 68[00000000]              push    __KERNEL_32_LMA
   210 00000055 E8(00000000)              call    __fast_memcpy
   211 0000005A C9                        leave
   212 0000005B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   213 0000005E 0F85530C0000              jne     .guard
   214                                    ; -> Desempaquetamiento de la ROM (copia de los handlers Teclado + ISR a RAM)
   215 00000064 55                        push    ebp
   216 00000065 89E5                      mov     ebp, esp 
   217 00000067 68[00000000]              push    __handlers_32_size
   218 0000006C 68[00000000]              push    __TECLADO_ISR_PHY
   219 00000071 68[00000000]              push    __TECLADO_ISR_LMA
   220 00000076 E8(00000000)              call    __fast_memcpy
   221 0000007B C9                        leave
   222 0000007C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   223 0000007F 0F85320C0000              jne     .guard
   224                                    ; -> Desempaquetamiento de la ROM (copia de datos de ROM a RAM)
   225 00000085 55                        push    ebp
   226 00000086 89E5                      mov     ebp, esp 
   227 00000088 68[00000000]              push    __data_size
   228 0000008D 68[00000000]              push    __DATOS_SYS32_PHY
   229 00000092 68[00000000]              push    __DATOS_SYS32_LMA
   230 00000097 E8(00000000)              call    __fast_memcpy
   231 0000009C C9                        leave
   232 0000009D 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   233 000000A0 0F85110C0000              jne     .guard
   234                                    ; -> Desempaquetamiento de la ROM (copia de las tablas de sistema (GDT e IDT) a RAM)
   235 000000A6 55                        push    ebp
   236 000000A7 89E5                      mov     ebp, esp 
   237 000000A9 68[00000000]              push    __sys_tables_size
   238 000000AE 68[00000000]              push    __SYS_TABLES_PHY
   239 000000B3 68[00000000]              push    __SYS_TABLES_LMA
   240 000000B8 E8(00000000)              call    __fast_memcpy
   241 000000BD C9                        leave
   242 000000BE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   243 000000C1 0F85F00B0000              jne     .guard
   244                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_1 a RAM)
   245 000000C7 55                        push    ebp
   246 000000C8 89E5                      mov     ebp, esp 
   247 000000CA 68[00000000]              push    __tarea_01_size
   248 000000CF 68[00000000]              push    __TAREA1_TEXT_PHY
   249 000000D4 68[00000000]              push    __TAREA1_TEXT_LMA
   250 000000D9 E8(00000000)              call    __fast_memcpy
   251 000000DE C9                        leave
   252 000000DF 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   253 000000E2 0F85CF0B0000              jne     .guard
   254                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _1 a RAM)
   255 000000E8 55                        push    ebp
   256 000000E9 89E5                      mov     ebp, esp 
   257 000000EB 68[00000000]              push    __tarea_1_bss_size
   258 000000F0 68[00000000]              push    __TAREA1_BSS_PHY
   259 000000F5 68[00000000]              push    __TAREA1_BSS_LMA
   260 000000FA E8(00000000)              call    __fast_memcpy
   261 000000FF C9                        leave
   262 00000100 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   263 00000103 0F85AE0B0000              jne     .guard
   264                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _1 a RAM)
   265 00000109 55                        push    ebp
   266 0000010A 89E5                      mov     ebp, esp 
   267 0000010C 68[00000000]              push    __tarea_1_data_size
   268 00000111 68[00000000]              push    __TAREA1_DATA_PHY
   269 00000116 68[00000000]              push    __TAREA1_DATA_LMA
   270 0000011B E8(00000000)              call    __fast_memcpy
   271 00000120 C9                        leave
   272 00000121 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   273 00000124 0F858D0B0000              jne     .guard
   274                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _1 a RAM)
   275 0000012A 55                        push    ebp
   276 0000012B 89E5                      mov     ebp, esp 
   277 0000012D 68[00000000]              push    __tarea_1_rodata_size
   278 00000132 68[00000000]              push    __TAREA1_RODATA_PHY
   279 00000137 68[00000000]              push    __TAREA1_RODATA_LMA
   280 0000013C E8(00000000)              call    __fast_memcpy
   281 00000141 C9                        leave
   282 00000142 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   283 00000145 0F856C0B0000              jne     .guard
   284                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_2 a RAM)
   285 0000014B 55                        push    ebp
   286 0000014C 89E5                      mov     ebp, esp 
   287 0000014E 68[00000000]              push    __tarea_02_size
   288 00000153 68[00000000]              push    __TAREA2_TEXT_PHY
   289 00000158 68[00000000]              push    __TAREA2_TEXT_LMA
   290 0000015D E8(00000000)              call    __fast_memcpy
   291 00000162 C9                        leave
   292 00000163 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   293 00000166 0F854B0B0000              jne     .guard
   294                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _2 a RAM)
   295 0000016C 55                        push    ebp
   296 0000016D 89E5                      mov     ebp, esp 
   297 0000016F 68[00000000]              push    __tarea_2_bss_size
   298 00000174 68[00000000]              push    __TAREA2_BSS_PHY
   299 00000179 68[00000000]              push    __TAREA2_BSS_LMA
   300 0000017E E8(00000000)              call    __fast_memcpy
   301 00000183 C9                        leave
   302 00000184 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   303 00000187 0F852A0B0000              jne     .guard
   304                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _2 a RAM)
   305 0000018D 55                        push    ebp
   306 0000018E 89E5                      mov     ebp, esp 
   307 00000190 68[00000000]              push    __tarea_2_data_size
   308 00000195 68[00000000]              push    __TAREA2_DATA_PHY
   309 0000019A 68[00000000]              push    __TAREA2_DATA_LMA
   310 0000019F E8(00000000)              call    __fast_memcpy
   311 000001A4 C9                        leave
   312 000001A5 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   313 000001A8 0F85090B0000              jne     .guard
   314                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _2 a RAM)
   315 000001AE 55                        push    ebp
   316 000001AF 89E5                      mov     ebp, esp 
   317 000001B1 68[00000000]              push    __tarea_2_rodata_size
   318 000001B6 68[00000000]              push    __TAREA2_RODATA_PHY
   319 000001BB 68[00000000]              push    __TAREA2_RODATA_LMA
   320 000001C0 E8(00000000)              call    __fast_memcpy
   321 000001C5 C9                        leave
   322 000001C6 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   323 000001C9 0F85E80A0000              jne     .guard
   324                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_3 a RAM)
   325 000001CF 55                        push    ebp
   326 000001D0 89E5                      mov     ebp, esp 
   327 000001D2 68[00000000]              push    __tarea_03_size
   328 000001D7 68[00000000]              push    __TAREA3_TEXT_PHY
   329 000001DC 68[00000000]              push    __TAREA3_TEXT_LMA
   330 000001E1 E8(00000000)              call    __fast_memcpy
   331 000001E6 C9                        leave
   332 000001E7 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   333 000001EA 0F85C70A0000              jne     .guard
   334                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _3 a RAM)
   335 000001F0 55                        push    ebp
   336 000001F1 89E5                      mov     ebp, esp 
   337 000001F3 68[00000000]              push    __tarea_3_bss_size
   338 000001F8 68[00000000]              push    __TAREA3_BSS_PHY
   339 000001FD 68[00000000]              push    __TAREA3_BSS_LMA
   340 00000202 E8(00000000)              call    __fast_memcpy
   341 00000207 C9                        leave
   342 00000208 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   343 0000020B 0F85A60A0000              jne     .guard
   344                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_3 a RAM)
   345 00000211 55                        push    ebp
   346 00000212 89E5                      mov     ebp, esp 
   347 00000214 68[00000000]              push    __tarea_3_data_size
   348 00000219 68[00000000]              push    __TAREA3_DATA_PHY
   349 0000021E 68[00000000]              push    __TAREA3_DATA_LMA
   350 00000223 E8(00000000)              call    __fast_memcpy
   351 00000228 C9                        leave
   352 00000229 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   353 0000022C 0F85850A0000              jne     .guard
   354                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _3 a RAM)
   355 00000232 55                        push    ebp
   356 00000233 89E5                      mov     ebp, esp 
   357 00000235 68[00000000]              push    __tarea_3_rodata_size
   358 0000023A 68[00000000]              push    __TAREA3_RODATA_PHY
   359 0000023F 68[00000000]              push    __TAREA3_RODATA_LMA
   360 00000244 E8(00000000)              call    __fast_memcpy
   361 00000249 C9                        leave
   362 0000024A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   363 0000024D 0F85640A0000              jne     .guard
   364                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_4 a RAM)
   365 00000253 55                        push    ebp
   366 00000254 89E5                      mov     ebp, esp 
   367 00000256 68[00000000]              push    __tarea_04_size
   368 0000025B 68[00000000]              push    __TAREA4_TEXT_PHY
   369 00000260 68[00000000]              push    __TAREA4_TEXT_LMA
   370 00000265 E8(00000000)              call    __fast_memcpy
   371 0000026A C9                        leave
   372 0000026B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   373 0000026E 0F85430A0000              jne     .guard
   374                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA_4 a RAM)
   375 00000274 55                        push    ebp
   376 00000275 89E5                      mov     ebp, esp 
   377 00000277 68[00000000]              push    __tarea_4_bss_size
   378 0000027C 68[00000000]              push    __TAREA4_BSS_PHY
   379 00000281 68[00000000]              push    __TAREA4_BSS_LMA
   380 00000286 E8(00000000)              call    __fast_memcpy
   381 0000028B C9                        leave
   382 0000028C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   383 0000028F 0F85220A0000              jne     .guard
   384                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_4 a RAM)
   385 00000295 55                        push    ebp
   386 00000296 89E5                      mov     ebp, esp 
   387 00000298 68[00000000]              push    __tarea_4_data_size
   388 0000029D 68[00000000]              push    __TAREA4_DATA_PHY
   389 000002A2 68[00000000]              push    __TAREA4_DATA_LMA
   390 000002A7 E8(00000000)              call    __fast_memcpy
   391 000002AC C9                        leave
   392 000002AD 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   393 000002B0 0F85010A0000              jne     .guard
   394                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA_4 a RAM)
   395 000002B6 55                        push    ebp
   396 000002B7 89E5                      mov     ebp, esp 
   397 000002B9 68[00000000]              push    __tarea_4_rodata_size
   398 000002BE 68[00000000]              push    __TAREA4_RODATA_PHY
   399 000002C3 68[00000000]              push    __TAREA4_RODATA_LMA
   400 000002C8 E8(00000000)              call    __fast_memcpy
   401 000002CD C9                        leave
   402 000002CE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   403 000002D1 0F85E0090000              jne     .guard
   404                                  
   405                                    ;-> Cargo la IDT y la GDT ya copiada en RAM
   406 000002D7 0F0115[00000000]          lgdt [_gdtr_32]
   407 000002DE 0F011D[00000000]          lidt [_idtr_32]  
   408                                  
   409                                    ; -> Init PIC , IRQ y config. Timer y teclado
   410 000002E5 E8(00000000)              call init_teclado       ; Inicializo controlador de teclado
   411 000002EA E8(00000000)              call init_timer         ; Configuro Timer tick para 100ms
   412 000002EF E8(00000000)              call init_pic           ; Inicializo los PICs e interrupciones de Timer y Teclado
   413                                  
   414                                    ;----------------------------------------------
   415                                    ;-----------------PAGINACIÓN-------------------
   416                                    ;----------------------------------------------
   417                                  
   418                                    ; -> Inicializo CR3 con la dirección base del DPT correspondiente al Kernel.
   419 000002F4 55                        push    ebp
   420 000002F5 89E5                      mov     ebp, esp
   421 000002F7 6A01                      push    PAG_PWT_YES
   422 000002F9 6A01                      push    PAG_PCD_YES
   423 000002FB 68[00000000]              push    dword __CR3_KERNEL_PHY
   424 00000300 E8(00000000)              call    set_cr3_rom
   425 00000305 0F22D8                    mov     cr3, eax
   426 00000308 C9                        leave
   427                                  
   428                                    ;--------------------------------------------
   429                                    ;-----------Mapeo del Kernel-----------------
   430                                    ;--------------------------------------------
   431                                    ;------------CR3_KERNEL                       = Base del DTP del Kernel
   432                                    ;------------CR3_KERNEL + 0x1000              = Tamaño del DTP
   433                                    ;-----------(CR3 KERNEL + 0x1000)+0x1000*DPTE = Bases de las TP
   434                                  
   435                                    ; HANDLERS, VGA, SYS_TABLES, KERNEL_32, DIGITS_TABLE, DATA_SYS, STACK_SYS, INIT_32 (este código), __TSS_BASICA, TSS_1, TSS_2, TSS_3
   436                                  
   437                                    ;------__TECLADO_ISR_PHY-----------
   438                                    ; ->Cargo DPTE y PTE
   439 00000309 55                        push    ebp
   440 0000030A 89E5                      mov     ebp, esp
   441 0000030C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   442 0000030E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   443 00000310 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   444 00000312 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   445 00000314 68[00000000]              push    __TECLADO_ISR_PHY
   446 00000319 68[00000000]              push    __TECLADO_ISR_VMA 
   447 0000031E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   448 00000323 E8(00000000)              call    set_page_rom
   449 00000328 C9                        leave
   450                                  
   451                                  ;------__VGA_PHY-----------
   452                                  ; ->Cargo DPTE y PTE
   453 00000329 55                        push    ebp
   454 0000032A 89E5                      mov     ebp, esp 
   455 0000032C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   456 0000032E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   457 00000330 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   458 00000332 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   459 00000334 68[00000000]              push    __VGA_PHY
   460 00000339 68[00000000]              push    __VGA_VMA 
   461 0000033E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   462 00000343 E8(00000000)              call    set_page_rom
   463 00000348 C9                        leave
   464                                  
   465                                  ;------__SYS_TABLES_PHY-----------
   466                                    ; ->Cargo DPTE y PTE
   467 00000349 55                        push    ebp
   468 0000034A 89E5                      mov     ebp, esp 
   469 0000034C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   470 0000034E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   471 00000350 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   472 00000352 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   473 00000354 68[00000000]              push    __SYS_TABLES_PHY
   474 00000359 68[00000000]              push    __SYS_TABLES_VMA 
   475 0000035E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   476 00000363 E8(00000000)              call    set_page_rom
   477 00000368 C9                        leave
   478                                  
   479                                  ;------__KERNEL_32_PHY-----------
   480                                    ; ->Cargo DPTE y PTE
   481 00000369 55                        push    ebp
   482 0000036A 89E5                      mov     ebp, esp 
   483 0000036C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   484 0000036E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   485 00000370 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   486 00000372 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   487 00000374 68[00000000]              push    __KERNEL_32_PHY
   488 00000379 68[00000000]              push    __KERNEL_32_VMA 
   489 0000037E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   490 00000383 E8(00000000)              call    set_page_rom
   491 00000388 C9                        leave
   492                                  
   493                                  
   494                                  ;------__FUNCTIONS_PHY-----------
   495                                    ; ->Cargo DPTE y PTE
   496 00000389 55                        push    ebp
   497 0000038A 89E5                      mov     ebp, esp 
   498 0000038C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   499 0000038E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   500 00000390 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   501 00000392 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   502 00000394 68[00000000]              push    __FUNCTIONS_PHY
   503 00000399 68[00000000]              push    __FUNCTIONS_VMA 
   504 0000039E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   505 000003A3 E8(00000000)              call    set_page_rom
   506 000003A8 C9                        leave
   507                                  
   508                                  ;------__DIGITS_TABLE_PHY-----------
   509                                    ; ->Cargo DPTE y PTE
   510 000003A9 55                        push    ebp
   511 000003AA 89E5                      mov     ebp, esp 
   512 000003AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   513 000003AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   514 000003B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   515 000003B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   516 000003B4 68[00000000]              push    __DIGITS_TABLE_PHY
   517 000003B9 68[00000000]              push    __DIGITS_TABLE_VMA 
   518 000003BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   519 000003C3 E8(00000000)              call    set_page_rom
   520 000003C8 C9                        leave
   521                                  
   522                                  ;------__DATOS_SYS32_PHY-----------
   523                                    ; ->Cargo DPTE y PTE
   524 000003C9 55                        push    ebp
   525 000003CA 89E5                      mov     ebp, esp 
   526 000003CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   527 000003CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   528 000003D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   529 000003D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   530 000003D4 68[00000000]              push    __DATOS_SYS32_PHY
   531 000003D9 68[00000000]              push    __DATOS_SYS32_VMA 
   532 000003DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   533 000003E3 E8(00000000)              call    set_page_rom
   534 000003E8 C9                        leave
   535                                  
   536                                  
   537                                  ;------__STACK_KERNEL_VMA-----------
   538                                    ; ->Cargo DPTE y PTE
   539 000003E9 55                        push    ebp
   540 000003EA 89E5                      mov     ebp, esp 
   541 000003EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   542 000003EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   543 000003F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   544 000003F2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   545 000003F4 68[00000000]              push    __STACK_KERNEL_PHY
   546 000003F9 68[00000000]              push    __STACK_KERNEL_VMA 
   547 000003FE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   548 00000403 E8(00000000)              call    set_page_rom
   549 00000408 C9                        leave
   550                                  
   551                                  
   552                                  ;------__INIT_32_VMA-----------
   553                                    ; ->Cargo DPTE y PTE
   554 00000409 55                        push    ebp
   555 0000040A 89E5                      mov     ebp, esp 
   556 0000040C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   557 0000040E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   558 00000410 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   559 00000412 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   560 00000414 68[00000000]              push    __INIT_32_VMA     ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   561 00000419 68[00000000]              push    __INIT_32_VMA 
   562 0000041E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   563 00000423 E8(00000000)              call    set_page_rom
   564 00000428 C9                        leave
   565                                  
   566                                    ;------__INIT_32_VMA-----------
   567                                    ; ->Cargo DPTE y PTE
   568 00000429 55                        push    ebp
   569 0000042A 89E5                      mov     ebp, esp 
   570 0000042C 6A00                      push    PAG_RW_R                  ; Permisos R/W para el PTE
   571 0000042E 6A01                      push    PAG_RW_W                  ; Permisos R/W para el DPTE
   572 00000430 6A00                      push    PAG_US_SUP                ; Permisos de Supervisor/Usuario para el PTE
   573 00000432 6A00                      push    PAG_US_SUP                ; Permisos de Supervisor/Usuario para el DPTE
   574 00000434 68[00100000]              push    __INIT_32_VMA + 0x1000    ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   575 00000439 68[00100000]              push    __INIT_32_VMA + 0x1000 
   576 0000043E 68[00000000]              push    __CR3_KERNEL_PHY          ; Base del DPT del Kernel 
   577 00000443 E8(00000000)              call    set_page_rom
   578 00000448 C9                        leave
   579                                  
   580                                  ;------__TSS_BASICA-----------
   581                                    ; ->Cargo DPTE y PTE
   582 00000449 55                        push    ebp
   583 0000044A 89E5                      mov     ebp, esp 
   584 0000044C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   585 0000044E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   586 00000450 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   587 00000452 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   588 00000454 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   589 00000459 68[00000000]              push    __TSS_BASICA 
   590 0000045E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   591 00000463 E8(00000000)              call    set_page_rom
   592 00000468 C9                        leave
   593                                  
   594                                  ;------TSS_1-----------
   595                                    ; ->Cargo DPTE y PTE
   596 00000469 55                        push    ebp
   597 0000046A 89E5                      mov     ebp, esp 
   598 0000046C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   599 0000046E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   600 00000470 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   601 00000472 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   602 00000474 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   603 00000479 68[00000000]              push    __TSS1_VMA 
   604 0000047E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   605 00000483 E8(00000000)              call    set_page_rom
   606 00000488 C9                        leave
   607                                  
   608                                  ;------__TSS_2-----------
   609                                    ; ->Cargo DPTE y PTE
   610 00000489 55                        push    ebp
   611 0000048A 89E5                      mov     ebp, esp 
   612 0000048C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   613 0000048E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   614 00000490 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   615 00000492 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   616 00000494 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
   617 00000499 68[00000000]              push    __TSS2_VMA 
   618 0000049E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   619 000004A3 E8(00000000)              call    set_page_rom
   620 000004A8 C9                        leave
   621                                  
   622                                    ;------__TSS_3-----------
   623                                    ; ->Cargo DPTE y PTE
   624 000004A9 55                        push    ebp
   625 000004AA 89E5                      mov     ebp, esp 
   626 000004AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   627 000004AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   628 000004B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   629 000004B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   630 000004B4 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
   631 000004B9 68[00000000]              push    __TSS3_VMA 
   632 000004BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   633 000004C3 E8(00000000)              call    set_page_rom
   634 000004C8 C9                        leave
   635                                  
   636                                    ;------__TSS_4-----------
   637                                    ; ->Cargo DPTE y PTE
   638 000004C9 55                        push    ebp
   639 000004CA 89E5                      mov     ebp, esp 
   640 000004CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   641 000004CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   642 000004D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   643 000004D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   644 000004D4 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
   645 000004D9 68[00000000]              push    __TSS4_VMA 
   646 000004DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   647 000004E3 E8(00000000)              call    set_page_rom
   648 000004E8 C9                        leave
   649                                  
   650                                  
   651                                  
   652                                    ;--------------------------------------------
   653                                    ;-----------Mapeo de la Tarea 1 -------------
   654                                    ;--------------------------------------------
   655                                    ;------------__CR3_TAREA_1_PHY                            = Base del DTP de la Tarea 1
   656                                    ;------------__CR3_TAREA_1_PHY + 0x1000                   = Tamaño del DTP
   657                                    ;-----------(CR3 __CR3_TAREA_1_PHY + 0x1000)+0x1000*DPTE  = Bases de las TP
   658                                  
   659                                    ;------__TECLADO_ISR_PHY-----------
   660                                    ; ->Cargo DPTE y PTE
   661 000004E9 55                        push    ebp
   662 000004EA 89E5                      mov     ebp, esp 
   663 000004EC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   664 000004EE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   665 000004F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   666 000004F2 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   667 000004F4 68[00000000]              push    __TECLADO_ISR_PHY     
   668 000004F9 68[00000000]              push    __TECLADO_ISR_VMA 
   669 000004FE 68[00000000]              push    __CR3_TAREA_1_PHY   ; Base del DPT de la Tarea 1 
   670 00000503 E8(00000000)              call    set_page_rom
   671 00000508 C9                        leave
   672                                    ;------__VGA_PHY-----------
   673                                    ; ->Cargo DPTE y PTE
   674 00000509 55                        push    ebp
   675 0000050A 89E5                      mov     ebp, esp 
   676 0000050C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   677 0000050E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   678 00000510 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   679 00000512 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   680 00000514 68[00000000]              push    __VGA_PHY     
   681 00000519 68[00000000]              push    __VGA_VMA 
   682 0000051E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   683 00000523 E8(00000000)              call    set_page_rom
   684 00000528 C9                        leave
   685                                  
   686                                    ;------__FUNCTIONS_PHY-----------
   687                                    ; ->Cargo DPTE y PTE
   688 00000529 55                        push    ebp
   689 0000052A 89E5                      mov     ebp, esp 
   690 0000052C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   691 0000052E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   692 00000530 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   693 00000532 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   694 00000534 68[00000000]              push    __FUNCTIONS_PHY     
   695 00000539 68[00000000]              push    __FUNCTIONS_VMA 
   696 0000053E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   697 00000543 E8(00000000)              call    set_page_rom
   698 00000548 C9                        leave
   699                                  
   700                                    ;------__DATOS_SYS32_PHY-----------
   701                                    ; ->Cargo DPTE y PTE
   702 00000549 55                        push    ebp
   703 0000054A 89E5                      mov     ebp, esp 
   704 0000054C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   705 0000054E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   706 00000550 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   707 00000552 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   708 00000554 68[00000000]              push    __DATOS_SYS32_PHY     
   709 00000559 68[00000000]              push    __DATOS_SYS32_VMA 
   710 0000055E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   711 00000563 E8(00000000)              call    set_page_rom
   712 00000568 C9                        leave
   713                                  
   714                                    ;------__DIGITS_TABLE_PHY-----------
   715                                    ; ->Cargo DPTE y PTE
   716 00000569 55                        push    ebp
   717 0000056A 89E5                      mov     ebp, esp 
   718 0000056C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   719 0000056E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   720 00000570 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   721 00000572 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   722 00000574 68[00000000]              push    __DIGITS_TABLE_PHY     
   723 00000579 68[00000000]              push    __DIGITS_TABLE_VMA 
   724 0000057E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   725 00000583 E8(00000000)              call    set_page_rom
   726 00000588 C9                        leave
   727                                  
   728                                    ;------__SYS_TABLES_PHY-----------
   729                                    ; ->Cargo DPTE y PTE
   730 00000589 55                        push    ebp
   731 0000058A 89E5                      mov     ebp, esp 
   732 0000058C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   733 0000058E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   734 00000590 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   735 00000592 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   736 00000594 68[00000000]              push    __SYS_TABLES_PHY     
   737 00000599 68[00000000]              push    __SYS_TABLES_VMA 
   738 0000059E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   739 000005A3 E8(00000000)              call    set_page_rom
   740 000005A8 C9                        leave
   741                                  
   742                                    ;------__TAREA1_TEXT_PHY-----------
   743                                    ; ->Cargo DPTE y PTE
   744 000005A9 55                        push    ebp
   745 000005AA 89E5                      mov     ebp, esp 
   746 000005AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   747 000005AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   748 000005B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   749 000005B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   750 000005B4 68[00000000]              push    __TAREA1_TEXT_PHY     
   751 000005B9 68[00000000]              push    __TAREA1_TEXT_VMA 
   752 000005BE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   753 000005C3 E8(00000000)              call    set_page_rom
   754 000005C8 C9                        leave
   755                                  
   756                                    ;------__TAREA1_BSS_PHY-----------
   757                                    ; ->Cargo DPTE y PTE
   758 000005C9 55                        push    ebp
   759 000005CA 89E5                      mov     ebp, esp 
   760 000005CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   761 000005CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   762 000005D0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   763 000005D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   764 000005D4 68[00000000]              push    __TAREA1_BSS_PHY     
   765 000005D9 68[00000000]              push    __TAREA1_BSS_VMA 
   766 000005DE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   767 000005E3 E8(00000000)              call    set_page_rom
   768 000005E8 C9                        leave
   769                                  
   770                                    ;------__TAREA1_DATA_PHY-----------
   771                                    ; ->Cargo DPTE y PTE
   772 000005E9 55                        push    ebp
   773 000005EA 89E5                      mov     ebp, esp 
   774 000005EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   775 000005EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   776 000005F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   777 000005F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   778 000005F4 68[00000000]              push    __TAREA1_DATA_PHY     
   779 000005F9 68[00000000]              push    __TAREA1_DATA_VMA 
   780 000005FE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   781 00000603 E8(00000000)              call    set_page_rom
   782 00000608 C9                        leave
   783                                    
   784                                    ;------__TAREA1_STACK_START_PHY-----------
   785                                    ; ->Cargo DPTE y PTE
   786 00000609 55                        push    ebp
   787 0000060A 89E5                      mov     ebp, esp 
   788 0000060C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   789 0000060E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   790 00000610 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   791 00000612 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   792 00000614 68[00000000]              push    __TAREA1_STACK_START_PHY     
   793 00000619 68[00000000]              push    __TAREA1_STACK_START_VMA 
   794 0000061E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   795 00000623 E8(00000000)              call    set_page_rom
   796 00000628 C9                        leave
   797                                  
   798                                  
   799                                    ;------__STACK_KERNEL_TAREA1_PHY-----------
   800                                    ; ->Cargo DPTE y PTE
   801 00000629 55                        push    ebp
   802 0000062A 89E5                      mov     ebp, esp 
   803 0000062C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   804 0000062E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   805 00000630 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   806 00000632 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   807 00000634 68[00000000]              push    __STACK_KERNEL_TAREA1_PHY     
   808 00000639 68[00000000]              push    __STACK_KERNEL_TAREA1_VMA 
   809 0000063E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   810 00000643 E8(00000000)              call    set_page_rom
   811 00000648 C9                        leave
   812                                  
   813                                  
   814                                    ;------__STACK_KERNEL_PHY-----------
   815                                    ; ->Cargo DPTE y PTE
   816 00000649 55                        push    ebp
   817 0000064A 89E5                      mov     ebp, esp 
   818 0000064C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
   819 0000064E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
   820 00000650 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   821 00000652 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
   822 00000654 68[00000000]              push    __STACK_KERNEL_PHY     
   823 00000659 68[00000000]              push    __STACK_KERNEL_VMA 
   824 0000065E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   825 00000663 E8(00000000)              call    set_page_rom
   826 00000668 C9                        leave
   827                                  
   828                                    ;------__TSS_1-----------
   829                                    ; ->Cargo DPTE y PTE
   830 00000669 55                        push    ebp
   831 0000066A 89E5                      mov     ebp, esp 
   832 0000066C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   833 0000066E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   834 00000670 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   835 00000672 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   836 00000674 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   837 00000679 68[00000000]              push    __TSS1_VMA 
   838 0000067E 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   839 00000683 E8(00000000)              call    set_page_rom
   840 00000688 C9                        leave
   841                                    ;------____TSS_BASICA-----------
   842                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
   843                                    ; las pilas de nivel 0.
   844                                    ; ->Cargo DPTE y PTE
   845 00000689 55                        push    ebp
   846 0000068A 89E5                      mov     ebp, esp 
   847 0000068C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   848 0000068E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   849 00000690 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   850 00000692 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   851 00000694 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   852 00000699 68[00000000]              push    __TSS_BASICA 
   853 0000069E 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   854 000006A3 E8(00000000)              call    set_page_rom
   855 000006A8 C9                        leave
   856                                  
   857                                    ;--------------------------------------------
   858                                    ;-----------Mapeo de la Tarea 2 -------------
   859                                    ;--------------------------------------------
   860                                    ;------------__CR3_TAREA_2_PHY                            = Base del DTP de la Tarea 2
   861                                    ;------------__CR3_TAREA_2_PHY + 0x1000                   = Tamaño del DTP
   862                                    ;-----------(__CR3_TAREA_2_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
   863                                  
   864                                    ;------__TECLADO_ISR_PHY-----------
   865                                    ; ->Cargo DPTE y PTE
   866 000006A9 55                        push    ebp
   867 000006AA 89E5                      mov     ebp, esp 
   868 000006AC 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   869 000006AE 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   870 000006B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   871 000006B2 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   872 000006B4 68[00000000]              push    __TECLADO_ISR_PHY     
   873 000006B9 68[00000000]              push    __TECLADO_ISR_VMA 
   874 000006BE 68[00000000]              push    __CR3_TAREA_2_PHY   ; Base del DPT de la Tarea 1 
   875 000006C3 E8(00000000)              call    set_page_rom
   876 000006C8 C9                        leave
   877                                    ;------__VGA_PHY-----------
   878                                    ; ->Cargo DPTE y PTE
   879 000006C9 55                        push    ebp
   880 000006CA 89E5                      mov     ebp, esp 
   881 000006CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   882 000006CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   883 000006D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   884 000006D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   885 000006D4 68[00000000]              push    __VGA_PHY     
   886 000006D9 68[00000000]              push    __VGA_VMA 
   887 000006DE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   888 000006E3 E8(00000000)              call    set_page_rom
   889 000006E8 C9                        leave
   890                                  
   891                                    ;------__FUNCTIONS_PHY-----------
   892                                    ; ->Cargo DPTE y PTE
   893 000006E9 55                        push    ebp
   894 000006EA 89E5                      mov     ebp, esp 
   895 000006EC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   896 000006EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   897 000006F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   898 000006F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   899 000006F4 68[00000000]              push    __FUNCTIONS_PHY     
   900 000006F9 68[00000000]              push    __FUNCTIONS_VMA 
   901 000006FE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   902 00000703 E8(00000000)              call    set_page_rom
   903 00000708 C9                        leave
   904                                  
   905                                    ;------__DATOS_SYS32_PHY-----------
   906                                    ; ->Cargo DPTE y PTE
   907 00000709 55                        push    ebp
   908 0000070A 89E5                      mov     ebp, esp 
   909 0000070C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   910 0000070E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   911 00000710 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   912 00000712 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   913 00000714 68[00000000]              push    __DATOS_SYS32_PHY     
   914 00000719 68[00000000]              push    __DATOS_SYS32_VMA 
   915 0000071E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   916 00000723 E8(00000000)              call    set_page_rom
   917 00000728 C9                        leave
   918                                  
   919                                    ;------__DIGITS_TABLE_PHY-----------
   920                                    ; ->Cargo DPTE y PTE
   921 00000729 55                        push    ebp
   922 0000072A 89E5                      mov     ebp, esp 
   923 0000072C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   924 0000072E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   925 00000730 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   926 00000732 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   927 00000734 68[00000000]              push    __DIGITS_TABLE_PHY     
   928 00000739 68[00000000]              push    __DIGITS_TABLE_VMA 
   929 0000073E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   930 00000743 E8(00000000)              call    set_page_rom
   931 00000748 C9                        leave
   932                                  
   933                                    ;------__SYS_TABLES_PHY-----------
   934                                    ; ->Cargo DPTE y PTE
   935 00000749 55                        push    ebp
   936 0000074A 89E5                      mov     ebp, esp 
   937 0000074C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   938 0000074E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   939 00000750 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   940 00000752 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   941 00000754 68[00000000]              push    __SYS_TABLES_PHY     
   942 00000759 68[00000000]              push    __SYS_TABLES_VMA 
   943 0000075E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   944 00000763 E8(00000000)              call    set_page_rom
   945 00000768 C9                        leave
   946                                  
   947                                    ;------__TAREA2_TEXT_PHY-----------
   948                                    ; ->Cargo DPTE y PTE
   949 00000769 55                        push    ebp
   950 0000076A 89E5                      mov     ebp, esp 
   951 0000076C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   952 0000076E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   953 00000770 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   954 00000772 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   955 00000774 68[00000000]              push    __TAREA2_TEXT_PHY     
   956 00000779 68[00000000]              push    __TAREA2_TEXT_VMA 
   957 0000077E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   958 00000783 E8(00000000)              call    set_page_rom
   959 00000788 C9                        leave
   960                                  
   961                                    ;------__TAREA2_BSS_PHY-----------
   962                                    ; ->Cargo DPTE y PTE
   963 00000789 55                        push    ebp
   964 0000078A 89E5                      mov     ebp, esp 
   965 0000078C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   966 0000078E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   967 00000790 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   968 00000792 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   969 00000794 68[00000000]              push    __TAREA2_BSS_PHY     
   970 00000799 68[00000000]              push    __TAREA2_BSS_VMA 
   971 0000079E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   972 000007A3 E8(00000000)              call    set_page_rom
   973 000007A8 C9                        leave
   974                                  
   975                                    ;------__TAREA2_DATA_PHY-----------
   976                                    ; ->Cargo DPTE y PTE
   977 000007A9 55                        push    ebp
   978 000007AA 89E5                      mov     ebp, esp 
   979 000007AC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   980 000007AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   981 000007B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   982 000007B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   983 000007B4 68[00000000]              push    __TAREA2_DATA_PHY     
   984 000007B9 68[00000000]              push    __TAREA2_DATA_VMA 
   985 000007BE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   986 000007C3 E8(00000000)              call    set_page_rom
   987 000007C8 C9                        leave
   988                                    
   989                                    ;------__TAREA2_STACK_START_PHY-----------
   990                                    ; ->Cargo DPTE y PTE
   991 000007C9 55                        push    ebp
   992 000007CA 89E5                      mov     ebp, esp 
   993 000007CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   994 000007CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   995 000007D0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   996 000007D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   997 000007D4 68[00000000]              push    __TAREA2_STACK_START_PHY     
   998 000007D9 68[00000000]              push    __TAREA2_STACK_START_VMA 
   999 000007DE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1000 000007E3 E8(00000000)              call    set_page_rom
  1001 000007E8 C9                        leave
  1002                                  
  1003                                    ;------__STACK_KERNEL_TAREA2_PHY-----------
  1004                                    ; ->Cargo DPTE y PTE
  1005 000007E9 55                        push    ebp
  1006 000007EA 89E5                      mov     ebp, esp 
  1007 000007EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1008 000007EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1009 000007F0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1010 000007F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1011 000007F4 68[00000000]              push    __STACK_KERNEL_TAREA2_PHY     
  1012 000007F9 68[00000000]              push    __STACK_KERNEL_TAREA2_VMA 
  1013 000007FE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1014 00000803 E8(00000000)              call    set_page_rom
  1015 00000808 C9                        leave
  1016                                  
  1017                                  
  1018                                    ;------__STACK_KERNEL_PHY-----------
  1019                                    ; ->Cargo DPTE y PTE
  1020 00000809 55                        push    ebp
  1021 0000080A 89E5                      mov     ebp, esp 
  1022 0000080C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1023 0000080E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1024 00000810 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1025 00000812 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1026 00000814 68[00000000]              push    __STACK_KERNEL_PHY     
  1027 00000819 68[00000000]              push    __STACK_KERNEL_VMA 
  1028 0000081E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1029 00000823 E8(00000000)              call    set_page_rom
  1030 00000828 C9                        leave
  1031                                  
  1032                                    ;------TSS_2-----------
  1033                                    ; ->Cargo DPTE y PTE
  1034 00000829 55                        push    ebp
  1035 0000082A 89E5                      mov     ebp, esp 
  1036 0000082C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1037 0000082E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1038 00000830 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1039 00000832 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1040 00000834 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
  1041 00000839 68[00000000]              push    __TSS2_VMA 
  1042 0000083E 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1043 00000843 E8(00000000)              call    set_page_rom
  1044 00000848 C9                        leave
  1045                                    ;------____TSS_BASICA-----------
  1046                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1047                                    ; las pilas de nivel 0.
  1048                                    ; ->Cargo DPTE y PTE
  1049 00000849 55                        push    ebp
  1050 0000084A 89E5                      mov     ebp, esp 
  1051 0000084C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1052 0000084E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1053 00000850 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1054 00000852 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1055 00000854 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1056 00000859 68[00000000]              push    __TSS_BASICA 
  1057 0000085E 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1058 00000863 E8(00000000)              call    set_page_rom
  1059 00000868 C9                        leave
  1060                                  
  1061                                  
  1062                                    ;--------------------------------------------
  1063                                    ;-----------Mapeo de la Tarea 3 -------------
  1064                                    ;--------------------------------------------
  1065                                    ;------------__CR3_TAREA_3_PHY                            = Base del DTP de la Tarea 3
  1066                                    ;------------__CR3_TAREA_3_PHY + 0x1000                   = Tamaño del DTP
  1067                                    ;-----------(__CR3_TAREA_3_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1068                                  
  1069                                    ;------__TECLADO_ISR_PHY-----------
  1070                                    ; ->Cargo DPTE y PTE
  1071 00000869 55                        push    ebp
  1072 0000086A 89E5                      mov     ebp, esp 
  1073 0000086C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1074 0000086E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1075 00000870 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1076 00000872 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
  1077 00000874 68[00000000]              push    __TECLADO_ISR_PHY     
  1078 00000879 68[00000000]              push    __TECLADO_ISR_VMA 
  1079 0000087E 68[00000000]              push    __CR3_TAREA_3_PHY   ; Base del DPT de la Tarea 3 
  1080 00000883 E8(00000000)              call    set_page_rom
  1081 00000888 C9                        leave
  1082                                    ;------__VGA_PHY-----------
  1083                                    ; ->Cargo DPTE y PTE
  1084 00000889 55                        push    ebp
  1085 0000088A 89E5                      mov     ebp, esp 
  1086 0000088C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1087 0000088E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1088 00000890 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1089 00000892 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1090 00000894 68[00000000]              push    __VGA_PHY     
  1091 00000899 68[00000000]              push    __VGA_VMA 
  1092 0000089E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1093 000008A3 E8(00000000)              call    set_page_rom
  1094 000008A8 C9                        leave
  1095                                  
  1096                                    ;------__FUNCTIONS_PHY-----------
  1097                                    ; ->Cargo DPTE y PTE
  1098 000008A9 55                        push    ebp
  1099 000008AA 89E5                      mov     ebp, esp 
  1100 000008AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1101 000008AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1102 000008B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1103 000008B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1104 000008B4 68[00000000]              push    __FUNCTIONS_PHY     
  1105 000008B9 68[00000000]              push    __FUNCTIONS_VMA 
  1106 000008BE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1107 000008C3 E8(00000000)              call    set_page_rom
  1108 000008C8 C9                        leave
  1109                                  
  1110                                    ;------__DATOS_SYS32_PHY-----------
  1111                                    ; ->Cargo DPTE y PTE
  1112 000008C9 55                        push    ebp
  1113 000008CA 89E5                      mov     ebp, esp 
  1114 000008CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1115 000008CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1116 000008D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1117 000008D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1118 000008D4 68[00000000]              push    __DATOS_SYS32_PHY     
  1119 000008D9 68[00000000]              push    __DATOS_SYS32_VMA 
  1120 000008DE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1121 000008E3 E8(00000000)              call    set_page_rom
  1122 000008E8 C9                        leave
  1123                                  
  1124                                    ;------__DIGITS_TABLE_PHY-----------
  1125                                    ; ->Cargo DPTE y PTE
  1126 000008E9 55                        push    ebp
  1127 000008EA 89E5                      mov     ebp, esp 
  1128 000008EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1129 000008EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1130 000008F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1131 000008F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1132 000008F4 68[00000000]              push    __DIGITS_TABLE_PHY     
  1133 000008F9 68[00000000]              push    __DIGITS_TABLE_VMA 
  1134 000008FE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1135 00000903 E8(00000000)              call    set_page_rom
  1136 00000908 C9                        leave
  1137                                  
  1138                                    ;------__SYS_TABLES_PHY-----------
  1139                                    ; ->Cargo DPTE y PTE
  1140 00000909 55                        push    ebp
  1141 0000090A 89E5                      mov     ebp, esp 
  1142 0000090C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1143 0000090E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1144 00000910 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1145 00000912 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1146 00000914 68[00000000]              push    __SYS_TABLES_PHY     
  1147 00000919 68[00000000]              push    __SYS_TABLES_VMA 
  1148 0000091E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1149 00000923 E8(00000000)              call    set_page_rom
  1150 00000928 C9                        leave
  1151                                  
  1152                                    ;------__TAREA3_TEXT_PHY-----------
  1153                                    ; ->Cargo DPTE y PTE
  1154 00000929 55                        push    ebp
  1155 0000092A 89E5                      mov     ebp, esp 
  1156 0000092C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1157 0000092E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1158 00000930 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1159 00000932 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1160 00000934 68[00000000]              push    __TAREA3_TEXT_PHY     
  1161 00000939 68[00000000]              push    __TAREA3_TEXT_VMA 
  1162 0000093E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1163 00000943 E8(00000000)              call    set_page_rom
  1164 00000948 C9                        leave
  1165                                  
  1166                                    ;------__TAREA3_BSS_PHY-----------
  1167                                    ; ->Cargo DPTE y PTE
  1168 00000949 55                        push    ebp
  1169 0000094A 89E5                      mov     ebp, esp 
  1170 0000094C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1171 0000094E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1172 00000950 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1173 00000952 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1174 00000954 68[00000000]              push    __TAREA3_BSS_PHY     
  1175 00000959 68[00000000]              push    __TAREA3_BSS_VMA 
  1176 0000095E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1177 00000963 E8(00000000)              call    set_page_rom
  1178 00000968 C9                        leave
  1179                                  
  1180                                    ;------__TAREA3_DATA_PHY-----------
  1181                                    ; ->Cargo DPTE y PTE
  1182 00000969 55                        push    ebp
  1183 0000096A 89E5                      mov     ebp, esp 
  1184 0000096C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1185 0000096E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1186 00000970 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1187 00000972 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1188 00000974 68[00000000]              push    __TAREA3_DATA_PHY     
  1189 00000979 68[00000000]              push    __TAREA3_DATA_VMA 
  1190 0000097E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1191 00000983 E8(00000000)              call    set_page_rom
  1192 00000988 C9                        leave
  1193                                    
  1194                                    ;------__TAREA3_STACK_START_PHY-----------
  1195                                    ; ->Cargo DPTE y PTE
  1196 00000989 55                        push    ebp
  1197 0000098A 89E5                      mov     ebp, esp 
  1198 0000098C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1199 0000098E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1200 00000990 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1201 00000992 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1202 00000994 68[00000000]              push    __TAREA3_STACK_START_PHY     
  1203 00000999 68[00000000]              push    __TAREA3_STACK_START_VMA 
  1204 0000099E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1205 000009A3 E8(00000000)              call    set_page_rom
  1206 000009A8 C9                        leave
  1207                                  
  1208                                  
  1209                                  
  1210                                    ;------__STACK_KERNEL_TAREA3_PHY-----------
  1211                                    ; ->Cargo DPTE y PTE
  1212 000009A9 55                        push    ebp
  1213 000009AA 89E5                      mov     ebp, esp 
  1214 000009AC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1215 000009AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1216 000009B0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1217 000009B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1218 000009B4 68[00000000]              push    __STACK_KERNEL_TAREA3_PHY     
  1219 000009B9 68[00000000]              push    __STACK_KERNEL_TAREA3_VMA 
  1220 000009BE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 1 
  1221 000009C3 E8(00000000)              call    set_page_rom
  1222 000009C8 C9                        leave
  1223                                  
  1224                                  
  1225                                  
  1226                                    ;------__STACK_KERNEL_PHY-----------
  1227                                    ; ->Cargo DPTE y PTE
  1228 000009C9 55                        push    ebp
  1229 000009CA 89E5                      mov     ebp, esp 
  1230 000009CC 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1231 000009CE 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1232 000009D0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1233 000009D2 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1234 000009D4 68[00000000]              push    __STACK_KERNEL_PHY     
  1235 000009D9 68[00000000]              push    __STACK_KERNEL_VMA 
  1236 000009DE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1237 000009E3 E8(00000000)              call    set_page_rom
  1238 000009E8 C9                        leave
  1239                                  
  1240                                    ;------TSS_3-----------
  1241                                    ; ->Cargo DPTE y PTE
  1242 000009E9 55                        push    ebp
  1243 000009EA 89E5                      mov     ebp, esp 
  1244 000009EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1245 000009EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1246 000009F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1247 000009F2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1248 000009F4 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
  1249 000009F9 68[00000000]              push    __TSS3_VMA 
  1250 000009FE 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT de la Tarea 3 
  1251 00000A03 E8(00000000)              call    set_page_rom
  1252 00000A08 C9                        leave
  1253                                  
  1254                                    ;------__TSS_BASICA-----------
  1255                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1256                                    ; las pilas de nivel 0.
  1257                                    ; ->Cargo DPTE y PTE
  1258 00000A09 55                        push    ebp
  1259 00000A0A 89E5                      mov     ebp, esp 
  1260 00000A0C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1261 00000A0E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1262 00000A10 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1263 00000A12 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1264 00000A14 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1265 00000A19 68[00000000]              push    __TSS_BASICA 
  1266 00000A1E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT del Kernel 
  1267 00000A23 E8(00000000)              call    set_page_rom
  1268 00000A28 C9                        leave
  1269                                  
  1270                                  
  1271                                  
  1272                                    ;--------------------------------------------
  1273                                    ;-----------Mapeo de la Tarea 4 -------------
  1274                                    ;--------------------------------------------
  1275                                    ;------------__CR3_TAREA_4_PHY                            = Base del DTP de la Tarea 4
  1276                                    ;------------__CR3_TAREA_4_PHY + 0x1000                   = Tamaño del DTP
  1277                                    ;-----------(__CR3_TAREA_4_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1278                                  
  1279                                    ;------__TECLADO_ISR_PHY-----------
  1280                                    ; ->Cargo DPTE y PTE
  1281 00000A29 55                        push    ebp
  1282 00000A2A 89E5                      mov     ebp, esp 
  1283 00000A2C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1284 00000A2E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1285 00000A30 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1286 00000A32 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
  1287 00000A34 68[00000000]              push    __TECLADO_ISR_PHY     
  1288 00000A39 68[00000000]              push    __TECLADO_ISR_VMA 
  1289 00000A3E 68[00000000]              push    __CR3_TAREA_4_PHY   ; Base del DPT de la Tarea 4 
  1290 00000A43 E8(00000000)              call    set_page_rom
  1291 00000A48 C9                        leave
  1292                                    ;------__VGA_PHY-----------
  1293                                    ; ->Cargo DPTE y PTE
  1294 00000A49 55                        push    ebp
  1295 00000A4A 89E5                      mov     ebp, esp 
  1296 00000A4C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1297 00000A4E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1298 00000A50 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1299 00000A52 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1300 00000A54 68[00000000]              push    __VGA_PHY     
  1301 00000A59 68[00000000]              push    __VGA_VMA 
  1302 00000A5E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1303 00000A63 E8(00000000)              call    set_page_rom
  1304 00000A68 C9                        leave
  1305                                  
  1306                                    ;------__FUNCTIONS_PHY-----------
  1307                                    ; ->Cargo DPTE y PTE
  1308 00000A69 55                        push    ebp
  1309 00000A6A 89E5                      mov     ebp, esp 
  1310 00000A6C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1311 00000A6E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1312 00000A70 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1313 00000A72 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1314 00000A74 68[00000000]              push    __FUNCTIONS_PHY     
  1315 00000A79 68[00000000]              push    __FUNCTIONS_VMA 
  1316 00000A7E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1317 00000A83 E8(00000000)              call    set_page_rom
  1318 00000A88 C9                        leave
  1319                                  
  1320                                    ;------__DATOS_SYS32_PHY-----------
  1321                                    ; ->Cargo DPTE y PTE
  1322 00000A89 55                        push    ebp
  1323 00000A8A 89E5                      mov     ebp, esp 
  1324 00000A8C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1325 00000A8E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1326 00000A90 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1327 00000A92 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1328 00000A94 68[00000000]              push    __DATOS_SYS32_PHY     
  1329 00000A99 68[00000000]              push    __DATOS_SYS32_VMA 
  1330 00000A9E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1331 00000AA3 E8(00000000)              call    set_page_rom
  1332 00000AA8 C9                        leave
  1333                                  
  1334                                    ;------__DIGITS_TABLE_PHY-----------
  1335                                    ; ->Cargo DPTE y PTE
  1336 00000AA9 55                        push    ebp
  1337 00000AAA 89E5                      mov     ebp, esp 
  1338 00000AAC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1339 00000AAE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1340 00000AB0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1341 00000AB2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1342 00000AB4 68[00000000]              push    __DIGITS_TABLE_PHY     
  1343 00000AB9 68[00000000]              push    __DIGITS_TABLE_VMA 
  1344 00000ABE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1345 00000AC3 E8(00000000)              call    set_page_rom
  1346 00000AC8 C9                        leave
  1347                                  
  1348                                    ;------__SYS_TABLES_PHY-----------
  1349                                    ; ->Cargo DPTE y PTE
  1350 00000AC9 55                        push    ebp
  1351 00000ACA 89E5                      mov     ebp, esp 
  1352 00000ACC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1353 00000ACE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1354 00000AD0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1355 00000AD2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1356 00000AD4 68[00000000]              push    __SYS_TABLES_PHY     
  1357 00000AD9 68[00000000]              push    __SYS_TABLES_VMA 
  1358 00000ADE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1359 00000AE3 E8(00000000)              call    set_page_rom
  1360 00000AE8 C9                        leave
  1361                                  
  1362                                    ;------__TAREA4_TEXT_PHY-----------
  1363                                    ; ->Cargo DPTE y PTE
  1364 00000AE9 55                        push    ebp
  1365 00000AEA 89E5                      mov     ebp, esp 
  1366 00000AEC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1367 00000AEE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1368 00000AF0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1369 00000AF2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1370 00000AF4 68[00000000]              push    __TAREA4_TEXT_PHY     
  1371 00000AF9 68[00000000]              push    __TAREA4_TEXT_VMA 
  1372 00000AFE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1373 00000B03 E8(00000000)              call    set_page_rom
  1374 00000B08 C9                        leave
  1375                                  
  1376                                    ;------__TAREA4_BSS_PHY-----------
  1377                                    ; ->Cargo DPTE y PTE
  1378 00000B09 55                        push    ebp
  1379 00000B0A 89E5                      mov     ebp, esp 
  1380 00000B0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1381 00000B0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1382 00000B10 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1383 00000B12 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1384 00000B14 68[00000000]              push    __TAREA4_BSS_PHY     
  1385 00000B19 68[00000000]              push    __TAREA4_BSS_VMA 
  1386 00000B1E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1387 00000B23 E8(00000000)              call    set_page_rom
  1388 00000B28 C9                        leave
  1389                                  
  1390                                    ;------__TAREA4_DATA_PHY-----------
  1391                                    ; ->Cargo DPTE y PTE
  1392 00000B29 55                        push    ebp
  1393 00000B2A 89E5                      mov     ebp, esp 
  1394 00000B2C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1395 00000B2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1396 00000B30 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1397 00000B32 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1398 00000B34 68[00000000]              push    __TAREA4_DATA_PHY     
  1399 00000B39 68[00000000]              push    __TAREA4_DATA_VMA 
  1400 00000B3E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1401 00000B43 E8(00000000)              call    set_page_rom
  1402 00000B48 C9                        leave
  1403                                    
  1404                                    ;------__TAREA4_STACK_START_PHY-----------
  1405                                    ; ->Cargo DPTE y PTE
  1406 00000B49 55                        push    ebp
  1407 00000B4A 89E5                      mov     ebp, esp 
  1408 00000B4C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1409 00000B4E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1410 00000B50 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1411 00000B52 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1412 00000B54 68[00000000]              push    __TAREA4_STACK_START_PHY     
  1413 00000B59 68[00000000]              push    __TAREA4_STACK_START_VMA 
  1414 00000B5E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1415 00000B63 E8(00000000)              call    set_page_rom
  1416 00000B68 C9                        leave
  1417                                  
  1418                                  
  1419                                    ;------__STACK_KERNEL_TAREA4_PHY-----------
  1420                                    ; ->Cargo DPTE y PTE
  1421 00000B69 55                        push    ebp
  1422 00000B6A 89E5                      mov     ebp, esp 
  1423 00000B6C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1424 00000B6E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1425 00000B70 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1426 00000B72 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1427 00000B74 68[00000000]              push    __STACK_KERNEL_TAREA4_PHY     
  1428 00000B79 68[00000000]              push    __STACK_KERNEL_TAREA4_VMA 
  1429 00000B7E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 1 
  1430 00000B83 E8(00000000)              call    set_page_rom
  1431 00000B88 C9                        leave
  1432                                  
  1433                                  
  1434                                    ;------__STACK_KERNEL_PHY-----------
  1435                                    ; ->Cargo DPTE y PTE
  1436 00000B89 55                        push    ebp
  1437 00000B8A 89E5                      mov     ebp, esp 
  1438 00000B8C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1439 00000B8E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1440 00000B90 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1441 00000B92 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1442 00000B94 68[00000000]              push    __STACK_KERNEL_PHY     
  1443 00000B99 68[00000000]              push    __STACK_KERNEL_VMA 
  1444 00000B9E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 3 
  1445 00000BA3 E8(00000000)              call    set_page_rom
  1446 00000BA8 C9                        leave
  1447                                  
  1448                                    ;------TSS_4-----------
  1449                                    ; ->Cargo DPTE y PTE
  1450 00000BA9 55                        push    ebp
  1451 00000BAA 89E5                      mov     ebp, esp 
  1452 00000BAC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1453 00000BAE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1454 00000BB0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1455 00000BB2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1456 00000BB4 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
  1457 00000BB9 68[00000000]              push    __TSS4_VMA 
  1458 00000BBE 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT de la Tarea 4 
  1459 00000BC3 E8(00000000)              call    set_page_rom
  1460 00000BC8 C9                        leave
  1461                                    
  1462                                  
  1463                                    ;------____TSS_BASICA-----------
  1464                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1465                                    ; las pilas de nivel 0.
  1466                                    ; ->Cargo DPTE y PTE
  1467 00000BC9 55                        push    ebp
  1468 00000BCA 89E5                      mov     ebp, esp 
  1469 00000BCC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1470 00000BCE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1471 00000BD0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1472 00000BD2 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1473 00000BD4 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1474 00000BD9 68[00000000]              push    __TSS_BASICA 
  1475 00000BDE 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT del Kernel 
  1476 00000BE3 E8(00000000)              call    set_page_rom
  1477 00000BE8 C9                        leave
  1478                                  
  1479                                    ;--------------------------------------------
  1480                                    ;-----------FIN PAGINACIÓN-------------------
  1481                                    ;--------------------------------------------
  1482                                  
  1483                                  
  1484                                  
  1485                                    ; -> Habilito la paginación
  1486 00000BE9 0F20C0                    mov   eax, cr0 
  1487 00000BEC 0D00000080                or    eax, X86_CR0_PG
  1488 00000BF1 0F22C0                    mov   cr0, eax
  1489                                  
  1490                                    ; ------------- HASTA ACA ANDA, PAGINA BIEN. HUBO QUE CAMBIAR BASES DE LOS CR3 PORQUE SE PISABAN.--------------
  1491                                    ;-----------------------------------------------------------------------------------------------
  1492                                  
  1493                                    ;--------------------------------------------
  1494                                    ;-> Inicializo las TSS de las Tareas
  1495                                    ;--------------------------------------------
  1496                                    ; __TSS_BASICA                    = 0x40000000;
  1497                                    ; __TSS1_VMA                      = 0x40001000;
  1498                                    ; __TSS2_VMA                      = 0x40002000;
  1499                                    ; __TSS3_VMA                      = 0x40003000;
  1500                                    ; __TSS4_VMA                      = 0x40004000;
  1501                                  
  1502                                    ; -------------TSS_1--------------
  1503                                  
  1504 00000BF4 55                        push    ebp
  1505 00000BF5 89E5                      mov     ebp, esp
  1506 00000BF7 6A00                      push    flag_TSS_us
  1507 00000BF9 68[00000000]              push    __TSS1_VMA                      ; TSS de la tarea
  1508 00000BFE 68[00000000]              push    __CR3_TAREA_1_PHY               ; CR3 de la tarea
  1509 00000C03 68[00000000]              push    __TAREA1_STACK_END_VMA          ; STACK de la tarea
  1510 00000C08 68[00000000]              push    __STACK_KERNEL_TAREA1_END_VMA   ; STACK del Kernel
  1511 00000C0D 68[00000000]              push    ejecutar_tarea_1                ; Dir. de inicio de la tarea
  1512 00000C12 E8(00000000)              call init_tss
  1513 00000C17 C9                        leave
  1514                                  
  1515                                  
  1516                                    ; -------------TSS_2--------------
  1517 00000C18 55                        push    ebp
  1518 00000C19 89E5                      mov     ebp, esp 
  1519 00000C1B 6A00                      push    flag_TSS_us
  1520 00000C1D 68[00000000]              push     __TSS2_VMA                      ; TSS de la tarea
  1521 00000C22 68[00000000]              push     __CR3_TAREA_2_PHY               ; CR3 de la tarea
  1522 00000C27 68[00000000]              push     __TAREA2_STACK_END_VMA          ; STACK de la tarea
  1523 00000C2C 68[00000000]              push     __STACK_KERNEL_TAREA2_END_VMA   ; STACK del Kernel
  1524 00000C31 68[00000000]              push     ejecutar_tarea_2                ; Dir. de inicio de la tarea
  1525 00000C36 E8(00000000)              call init_tss
  1526 00000C3B C9                        leave
  1527                                  
  1528                                    ; -------------TSS_3--------------
  1529 00000C3C 55                        push    ebp
  1530 00000C3D 89E5                      mov     ebp, esp 
  1531 00000C3F 6A00                      push    flag_TSS_us
  1532 00000C41 68[00000000]              push     __TSS3_VMA                      ; TSS de la tarea
  1533 00000C46 68[00000000]              push     __CR3_TAREA_3_PHY               ; CR3 de la tarea
  1534 00000C4B 68[00000000]              push     __TAREA3_STACK_END_VMA          ; STACK de la tarea
  1535 00000C50 68[00000000]              push     __STACK_KERNEL_TAREA3_END_VMA   ; STACK del Kernel
  1536 00000C55 68[00000000]              push     ejecutar_tarea_3                ; Dir. de inicio de la tarea
  1537 00000C5A E8(00000000)              call init_tss
  1538 00000C5F C9                        leave
  1539                                  
  1540                                    ; -------------TSS_4--------------
  1541 00000C60 55                        push    ebp
  1542 00000C61 89E5                      mov     ebp, esp 
  1543 00000C63 6A01                      push    flag_TSS_sup
  1544 00000C65 68[00000000]              push    __TSS4_VMA                      ; TSS de la tarea
  1545 00000C6A 68[00000000]              push    __CR3_TAREA_4_PHY               ; CR3 de la tarea
  1546 00000C6F 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea
  1547 00000C74 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1548 00000C79 68[00000000]              push    ejecutar_tarea_4                ; Dir. de inicio de la tarea
  1549 00000C7E E8(00000000)              call init_tss
  1550 00000C83 C9                        leave
  1551                                  
  1552                                  
  1553                                  
  1554                                    ; -------------TSS_BASICA para el CPU--------------
  1555 00000C84 55                        push    ebp
  1556 00000C85 89E5                      mov     ebp, esp 
  1557 00000C87 6A01                      push    flag_TSS_sup
  1558 00000C89 68[00000000]              push    __TSS_BASICA                    ; TSS para el CPU
  1559 00000C8E 68[00000000]              push    __CR3_KERNEL_PHY                ; CR3 del Kernel
  1560 00000C93 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea que primero corre. (la TAREA 4 - HALT)
  1561 00000C98 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1562 00000C9D 68[00000000]              push    kernel32_init                   ; Dir. de inicio del Kernel
  1563 00000CA2 E8(00000000)              call    init_tss
  1564 00000CA7 C9                        leave
  1565                                  
  1566                                    ;xchg bx, bx
  1567                                  
  1568                                   ;-> Cargo Selector de la TSS_BASICA
  1569 00000CA8 66B8[0000]                mov     ax, TSS_SEL
  1570 00000CAC 0F00D8                    ltr     ax
  1571                                  
  1572                                    ; -> Habilito interrupciones
  1573 00000CAF FB                        sti                                   
  1574 00000CB0 EA[00000000][0000]        jmp CS_SEL_00:kernel32_init             ; Salto en memoria a la sección del Kernel
  1575                                  
  1576                                  .guard:
  1577 00000CB7 F4                        hlt
  1578 00000CB8 EBFD                      jmp .guard
  1579                                  
  1580                                  
