     1                                  USE32
     2                                  
     3                                  SECTION .kernel32
     4                                  
     5                                  EXTERN __DATA_VMA
     6                                  EXTERN limpiar_buffer
     7                                  EXTERN msg_bienvenida_VGA
     8                                  EXTERN __VGA_VMA
     9                                  EXTERN __VGA_PHY
    10                                  EXTERN limpiar_VGA
    11                                  ;--------------GLOBAL----------------------
    12                                  GLOBAL kernel32_code_size
    13                                  GLOBAL kernel32_init
    14                                  GLOBAL memoria_buffer_reservada
    15                                  GLOBAL contador_timer
    16                                  GLOBAL resultado_promedio
    17                                  GLOBAL dir_lineal_page_fault
    18                                  GLOBAL error_code_PF
    19                                  GLOBAL dir_phy_dinamica
    20                                  GLOBAL page_fault_msg
    21                                  GLOBAL page_fault_msg_2
    22                                  GLOBAL page_fault_msg_3
    23                                  GLOBAL page_fault_msg_4
    24                                  GLOBAL page_fault_msg_5
    25                                  GLOBAL page_fault_msg_6
    26                                  GLOBAL paginas_creadas
    27                                  GLOBAL Stack_aux
    28                                  GLOBAL TSS_aux
    29                                  GLOBAL CR3_aux
    30                                  GLOBAL POINTER_VMA_DIGITS_TABLE
    31                                  ;--------------CODE SIZE----------------
    32                                  kernel21_code_size EQU kernel32_end-kernel32_init
    33                                  ;---------EQU-----------------------------
    34                                  CANTIDAD_DATOS  EQU 10
    35                                  LONG_BUFFER     EQU 16
    36                                  
    37                                  kernel32_init:
    38                                      ;xchg bx,bx              ; Llegue al kernel
    39 00000000 31C0                        xor eax,eax
    40 00000002 31DB                        xor ebx,ebx
    41 00000004 31C9                        xor ecx,ecx
    42 00000006 31D2                        xor edx,edx
    43                                      ; -> Inicializo el buffer del teclado.
    44 00000008 55                          push    ebp
    45 00000009 89E5                        mov     ebp, esp
    46 0000000B 68[00000000]                push dword memoria_buffer_reservada
    47 00000010 E8(00000000)                call limpiar_buffer                     
    48 00000015 C9                          leave
    49                                      ; -> Escribo la pantalla con mensaje fijo.
    50 00000016 55                          push    ebp
    51 00000017 89E5                        mov     ebp, esp
    52 00000019 68[00000000]                push    __VGA_VMA
    53 0000001E E8(00000000)                call msg_bienvenida_VGA                     
    54 00000023 C9                          leave
    55                                  
    56                                      ;xchg bx,bx              
    57                                  
    58                                  main:
    59 00000024 F4                          hlt                     ; CPU en HALT aguardando por interrupciones
    60                                      
    61 00000025 EBFD                        jmp main 
    62                                  
    63                                  guard:
    64 00000027 F4                          hlt                                     
    65 00000028 EBFD                        jmp guard
    66                                  
    67                                  kernel32_end:
    68                                      
    69                                  
    70                                  ;-------- VARIABLES DE DATOS PARA PROPOSITO GENERAL--------------------------
    71                                  SECTION .data_kernel
    72                                  variables_globales:
    73 00000000 <res 00000013>              memoria_buffer_reservada    resb 19             ; Reservo para buffer[0-16] + head[17] + tail[18] + cantidad[19] 
    73          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    74                                  
    75 00000013 <res 00000001>              contador_timer              resb 1              ; Contador del timer
    75          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    76                                  
    77                                      ;resultado_promedio          resq 1              ; Resultado del promedio cada 500ms de los dígitos en tabla.
    78                                  
    79 00000014 <res 00000004>              dir_lineal_page_fault       resd 1              ; Dir. Lineal que produjo una Page Fault Exception.
    79          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    80                                  
    81 00000018 <res 00000004>              error_code_PF               resd 1              ; Código de error del #PF
    81          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    82                                  
    83 0000001C 0000000A                    dir_phy_dinamica            dd 0x0A000000       ; Dir. Phy. dinámica para salvar el #PF
    84                                  
    85 00000020 <res 00000004>              paginas_creadas             resd  1              ; Cantidad de páginas creadas en el #PF .
    85          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    86                                  
    87 00000024 <res 00000004>              TSS_aux                     resd  1            ; TSS auxiliar para guardar o leer contextos en memoria
    87          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    88                                  
    89 00000028 <res 00000004>              CR3_aux                     resd  1               ; CR3 auxiliar para guardar o leer contextos de memoria
    89          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    90                                  
    91 0000002C <res 00000030>              Stack_aux                   resb 48             ; Stack para leer contexto de memoria 
    91          ******************       warning: uninitialized space declared in non-BSS section `.data_kernel': zeroing
    92                                  mensajes_error:
    93 0000005C 2D2D2D2D2D50414745-         page_fault_msg              db "-----PAGE FAULT-----",0
    93 00000065 204641554C542D2D2D-
    93 0000006E 2D2D00             
    94 00000071 4469722E20564D4120-         page_fault_msg_2            db "Dir. VMA = 0x",0
    94 0000007A 3D20307800         
    95 0000007F 4572726F7220436F64-         page_fault_msg_3            db "Error Code: ",0
    95 00000088 653A2000           
    96 0000008C 506167696E6163696F-         page_fault_msg_4            db "Paginacion OFF. Se puede paginar con VMA del CR2",0
    96 00000095 6E204F46462E205365-
    96 0000009E 207075656465207061-
    96 000000A7 67696E617220636F6E-
    96 000000B0 20564D412064656C20-
    96 000000B9 43523200           
    97 000000BD 506167696E6163696F-         page_fault_msg_5            db "Paginacion exitosa.",0
    97 000000C6 6E20657869746F7361-
    97 000000CF 2E00               
    98 000000D1 2350462048616E646C-         page_fault_msg_6            db "#PF Handler - Paginas de 4K creadas: ",0
    98 000000DA 6572202D2050616769-
    98 000000E3 6E617320646520344B-
    98 000000EC 20637265616461733A-
    98 000000F5 2000               
    99                                  
   100                                  
   101                                  SECTION .table_digits_64
   102                                  
   103 00000000 <res 000000A0>          POINTER_VMA_DIGITS_TABLE        resb 8*20    ; Guardo 20 digitos de 8 bytes (64 bits) cada uno 
   103          ******************       warning: uninitialized space declared in non-BSS section `.table_digits_64': zeroing
