     1                                  USE32
     2                                  
     3                                  SECTION .start32
     4                                  
     5                                  %include "inc/processor-flags.h" 
     1                              <1> %define X86_CR0_PE      0x00000001 ; /* Protectede mode enable*/
     2                              <1> %define X86_CR0_MP      0x00000002 ; /* Monitor coProcessor*/
     3                              <1> %define X86_CR0_EM      0x00000004 ; /* Emulation*/
     4                              <1> %define X86_CR0_TS      0x00000008 ; /* Task Switched*/
     5                              <1> %define X86_CR0_ET      0x00000010 ; /* Extension Type*/
     6                              <1> %define X86_CR0_NE      0x00000020 ; /* Numeric Error*/
     7                              <1> %define X86_CR0_WP      0x00010000 ; /* Write Protect*/
     8                              <1> %define X86_CR0_AM      0x00040000 ; /* Alignment Mask*/
     9                              <1> %define X86_CR0_NW      0x20000000 ; /* Not Write-through*/
    10                              <1> %define X86_CR0_CD      0x40000000 ; /* Cache Disable*/
    11                              <1> %define X86_CR0_PG      0x80000000 ; /* PaGine*/
    12                              <1> %define flag_TSS_sup    1
    13                              <1> %define flag_TSS_us     0
    14                              <1> 
    15                              <1> ;------------DTP y TP(Descriptor de Tablas de Páginas y Tabla de Páginas) flags--------------------------
    16                              <1> PAG_PCD_YES  equ 1       ; cachable                          
    17                              <1> PAG_PCD_NO   equ 0       ; no cachable
    18                              <1> PAG_PWT_YES  equ 1       ; 1 se escribe en cache y ram       
    19                              <1> PAG_PWT_NO   equ 0       ; 0 
    20                              <1> PAG_P_YES    equ 1       ; 1 presente
    21                              <1> PAG_P_NO     equ 0       ; 0 no presente
    22                              <1> PAG_RW_W     equ 1       ; 1 lectura y escritura
    23                              <1> PAG_RW_R     equ 0       ; 0 solo lectura
    24                              <1> PAG_US_SUP   equ 0       ; 0 supervisor
    25                              <1> PAG_US_US    equ 1       ; 1 usuario  
    26                              <1> PAG_D        equ 0       ; modificacion en la pagina
    27                              <1> PAG_PAT      equ 0       ; PAT                   
    28                              <1> PAG_G_YES    equ 0       ; Global                 
    29                              <1> PAG_A        equ 0       ; accedida
    30                              <1> PAG_PS_4K    equ 0       ; tamaño de pagina de 4KB
    31                              <1> 
    32                              <1> ; ------------ EQU Generales-----------------
    33                              <1> SYS_HALT                EQU     0
    34                              <1> SYS_READ                EQU     1
    35                              <1> SYS_PRINT               EQU     2
    36                              <1> SYS_PRINT_VGA           EQU     3
    37                              <1> ASCII_TRUE              EQU     1
    38                              <1> ASCII_FALSE             EQU     0
     6                                  
     7                                  ; Selectores de segmento
     8                                  EXTERN CS_SEL_00
     9                                  EXTERN DS_SEL_32_prim
    10                                  EXTERN TSS_SEL
    11                                  ; Stack 32 bits
    12                                  EXTERN __STACK_END_32_VMA
    13                                  EXTERN __STACK_KERNEL_END_VMA
    14                                  EXTERN __STACK_SIZE_32
    15                                  ; Etiquetas externas
    16                                  EXTERN kernel32_init
    17                                  EXTERN __fast_memcpy
    18                                  EXTERN __fast_memcpy_rom
    19                                  EXTERN init_pic
    20                                  EXTERN _idtr_32
    21                                  EXTERN _gdtr_32
    22                                  EXTERN init_timer
    23                                  EXTERN init_teclado
    24                                  EXTERN set_cr3_rom
    25                                  EXTERN tarea_1_asm
    26                                  EXTERN tarea_2_asm
    27                                  EXTERN tarea_3_asm
    28                                  EXTERN tarea_4_asm
    29                                  EXTERN ejecutar_tarea_4
    30                                  EXTERN set_page_rom
    31                                  EXTERN init_tss
    32                                  exter
    32          ******************       warning: label alone on a line without a colon might be in error [-w+orphan-labels]
    33                                  ; Direcciones LMA
    34                                  EXTERN __KERNEL_32_LMA
    35                                  EXTERN __TECLADO_ISR_LMA
    36                                  EXTERN __FUNCTIONS_LMA
    37                                  EXTERN __SYS_TABLES_LMA
    38                                  EXTERN __DATOS_SYS32_LMA
    39                                  EXTERN __TAREA1_BSS_LMA
    40                                  EXTERN __TAREA1_DATA_LMA
    41                                  EXTERN __TAREA1_TEXT_LMA
    42                                  EXTERN __TAREA1_RODATA_LMA
    43                                  EXTERN __TAREA2_BSS_LMA
    44                                  EXTERN __TAREA2_DATA_LMA
    45                                  EXTERN __TAREA2_TEXT_LMA
    46                                  EXTERN __TAREA2_RODATA_LMA
    47                                  EXTERN __TAREA3_BSS_LMA
    48                                  EXTERN __TAREA3_DATA_LMA
    49                                  EXTERN __TAREA3_TEXT_LMA
    50                                  EXTERN __TAREA3_RODATA_LMA
    51                                  EXTERN __TAREA4_BSS_LMA
    52                                  EXTERN __TAREA4_DATA_LMA
    53                                  EXTERN __TAREA4_TEXT_LMA
    54                                  EXTERN __TAREA4_RODATA_LMA
    55                                  ; Direcciones VMA
    56                                  EXTERN __DIGITS_TABLE_VMA
    57                                  EXTERN __TAREA1_BSS_VMA
    58                                  EXTERN __TAREA1_DATA_VMA
    59                                  EXTERN __TAREA1_TEXT_VMA
    60                                  EXTERN __TAREA1_RODATA_VMA
    61                                  EXTERN __TAREA2_BSS_VMA
    62                                  EXTERN __TAREA2_DATA_VMA
    63                                  EXTERN __TAREA2_TEXT_VMA
    64                                  EXTERN __TAREA2_RODATA_VMA
    65                                  EXTERN __TAREA3_BSS_VMA
    66                                  EXTERN __TAREA3_DATA_VMA
    67                                  EXTERN __TAREA3_TEXT_VMA
    68                                  EXTERN __TAREA3_RODATA_VMA
    69                                  EXTERN __TAREA4_BSS_VMA
    70                                  EXTERN __TAREA4_DATA_VMA
    71                                  EXTERN __TAREA4_TEXT_VMA
    72                                  EXTERN __TAREA4_RODATA_VMA
    73                                  EXTERN __STACK_KERNEL_VMA
    74                                  EXTERN __TAREA1_STACK_START_VMA
    75                                  EXTERN __TAREA2_STACK_START_VMA
    76                                  EXTERN __TAREA3_STACK_START_VMA
    77                                  EXTERN __TAREA4_STACK_START_VMA
    78                                  EXTERN __TAREA1_STACK_END_VMA
    79                                  EXTERN __TAREA2_STACK_END_VMA
    80                                  EXTERN __TAREA3_STACK_END_VMA
    81                                  EXTERN __TAREA4_STACK_END_VMA
    82                                  EXTERN __STACK_KERNEL_TAREA1_END_VMA
    83                                  EXTERN __STACK_KERNEL_TAREA2_END_VMA
    84                                  EXTERN __STACK_KERNEL_TAREA3_END_VMA
    85                                  EXTERN __STACK_KERNEL_TAREA4_END_VMA
    86                                  EXTERN __INIT_32_VMA
    87                                  EXTERN __KERNEL_32_VMA
    88                                  EXTERN __FUNCTIONS_VMA
    89                                  EXTERN __TECLADO_ISR_VMA
    90                                  EXTERN __SYS_TABLES_VMA
    91                                  EXTERN __DATOS_SYS32_VMA
    92                                  EXTERN __TAREA_1_VMA
    93                                  EXTERN __PAGE_TABLES_VMA
    94                                  EXTERN __VGA_VMA
    95                                  EXTERN __TAREA1_STACK_START_VMA
    96                                  EXTERN __INIT_16_VMA
    97                                  EXTERN __PAG_DINAMICA_INIT_VMA
    98                                  EXTERN __TSS4_VMA
    99                                  EXTERN __TSS3_VMA
   100                                  EXTERN __TSS2_VMA
   101                                  EXTERN __TSS1_VMA
   102                                  EXTERN __TSS_BASICA
   103                                  EXTERN __STACK_KERNEL_TAREA1_VMA
   104                                  EXTERN __STACK_KERNEL_TAREA2_VMA
   105                                  EXTERN __STACK_KERNEL_TAREA3_VMA
   106                                  EXTERN __STACK_KERNEL_TAREA4_VMA
   107                                  EXTERN __MMX2_VMA
   108                                  EXTERN __MMX3_VMA
   109                                  ; Direcciones físicas
   110                                  EXTERN __SYS_TABLES_PHY        
   111                                  EXTERN __PAGE_TABLES_PHY       
   112                                  EXTERN __FUNCTIONS_PHY         
   113                                  EXTERN __VGA_PHY               
   114                                  EXTERN __TECLADO_ISR_PHY       
   115                                  EXTERN __DATOS_SYS32_PHY       
   116                                  EXTERN __DIGITS_TABLE_PHY      
   117                                  EXTERN __KERNEL_32_PHY         
   118                                  EXTERN __TAREA1_TEXT_PHY       
   119                                  EXTERN __TAREA1_BSS_PHY        
   120                                  EXTERN __TAREA1_DATA_PHY       
   121                                  EXTERN __TAREA1_RODATA_PHY
   122                                  EXTERN __TAREA2_TEXT_PHY  
   123                                  EXTERN __TAREA2_BSS_PHY   
   124                                  EXTERN __TAREA2_DATA_PHY  
   125                                  EXTERN __TAREA2_RODATA_PHY
   126                                  EXTERN __TAREA3_TEXT_PHY  
   127                                  EXTERN __TAREA3_BSS_PHY   
   128                                  EXTERN __TAREA3_DATA_PHY  
   129                                  EXTERN __TAREA3_RODATA_PHY
   130                                  EXTERN __TAREA4_TEXT_PHY  
   131                                  EXTERN __TAREA4_BSS_PHY   
   132                                  EXTERN __TAREA4_DATA_PHY  
   133                                  EXTERN __TAREA4_RODATA_PHY
   134                                  EXTERN __STACK_KERNEL_PHY    
   135                                  EXTERN __TAREA1_STACK_START_PHY
   136                                  EXTERN __TAREA2_STACK_START_PHY
   137                                  EXTERN __TAREA3_STACK_START_PHY
   138                                  EXTERN __TAREA4_STACK_START_PHY
   139                                  EXTERN __INIT_ROM_PHY          
   140                                  EXTERN __RESET_PHY             
   141                                  EXTERN __STACK_KERNEL_END_PHY
   142                                  EXTERN __PAG_DINAMICA_INIT_PHY
   143                                  EXTERN __CR3_KERNEL_PHY
   144                                  EXTERN __CR3_TAREA_1_PHY
   145                                  EXTERN __CR3_TAREA_2_PHY
   146                                  EXTERN __CR3_TAREA_3_PHY
   147                                  EXTERN __CR3_TAREA_4_PHY
   148                                  EXTERN __STACK_KERNEL_TAREA1_PHY
   149                                  EXTERN __STACK_KERNEL_TAREA2_PHY
   150                                  EXTERN __STACK_KERNEL_TAREA3_PHY
   151                                  EXTERN __STACK_KERNEL_TAREA4_PHY
   152                                  
   153                                  ; Tamaños de códigos
   154                                  EXTERN __codigo_kernel32_size
   155                                  EXTERN __functions_size
   156                                  EXTERN __handlers_32_size
   157                                  EXTERN __sys_tables_size
   158                                  EXTERN __data_size
   159                                  EXTERN __tarea_01_size
   160                                  EXTERN __tarea_1_bss_size
   161                                  EXTERN __tarea_1_data_size
   162                                  EXTERN __tarea_1_rodata_size
   163                                  EXTERN __tarea_02_size
   164                                  EXTERN __tarea_2_bss_size
   165                                  EXTERN __tarea_2_data_size
   166                                  EXTERN __tarea_2_rodata_size
   167                                  EXTERN __tarea_03_size
   168                                  EXTERN __tarea_3_bss_size
   169                                  EXTERN __tarea_3_data_size
   170                                  EXTERN __tarea_3_rodata_size
   171                                  EXTERN __tarea_04_size
   172                                  EXTERN __tarea_4_bss_size
   173                                  EXTERN __tarea_4_data_size
   174                                  EXTERN __tarea_4_rodata_size
   175                                  ; Etiquetas globales
   176                                  GLOBAL start32_launcher
   177                                  
   178                                  start32_launcher:
   179                                    ;xchg    bx, bx ; Breakpoint. Estoy en 32 bits
   180                                    ; -> Inicializar los selectores de datos
   181 00000000 66B8[0000]                mov     ax, DS_SEL_32_prim ; Selector de la GDT de datos de 32 bits FLAT. Ahora puedo acceder a todos los datos de toda la memoria.
   182 00000004 8ED8                      mov     ds, ax
   183 00000006 8EC0                      mov     es, ax
   184 00000008 8EE8                      mov     gs, ax
   185 0000000A 8EE0                      mov     fs, ax
   186                                    ; -> Inicializar la pila en 32 bits
   187 0000000C 8ED0                      mov     ss, ax
   188 0000000E BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY
   189 00000013 31C0                      xor     eax, eax
   190                                    ; -> Limpio la pila
   191 00000015 B9[00000000]              mov     ecx, __STACK_SIZE_32 ; Cargo el tamaño del stack en el registro counter.
   192                                  .stack_init:
   193 0000001A 50                        push    eax ; Pusheo ceros en el stack.
   194 0000001B E2FD                      loop    .stack_init
   195 0000001D BC[00000000]              mov     esp, __STACK_KERNEL_END_PHY ; Lo apunto al final
   196                                  
   197                                    ; -> Desempaquetamiento de la ROM (copia de las funciones a RAM)
   198 00000022 55                        push    ebp
   199 00000023 89E5                      mov     ebp, esp ; Genero el STACK FRAME
   200                                    ; -> Paso argumentos y llamo memcopy 
   201 00000025 68[00000000]              push    __functions_size
   202 0000002A 68[00000000]              push    __FUNCTIONS_PHY
   203 0000002F 68[00000000]              push    __FUNCTIONS_LMA
   204 00000034 E8(00000000)              call    __fast_memcpy_rom
   205 00000039 C9                        leave
   206 0000003A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   207 0000003D 0F85140E0000              jne     .guard
   208                                  
   209                                    ; -> Desempaquetamiento de la ROM (copia del kernel a RAM)
   210 00000043 55                        push    ebp
   211 00000044 89E5                      mov     ebp, esp 
   212 00000046 68[00000000]              push    __codigo_kernel32_size
   213 0000004B 68[00000000]              push    __KERNEL_32_PHY
   214 00000050 68[00000000]              push    __KERNEL_32_LMA
   215 00000055 E8(00000000)              call    __fast_memcpy
   216 0000005A C9                        leave
   217 0000005B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   218 0000005E 0F85F30D0000              jne     .guard
   219                                    ; -> Desempaquetamiento de la ROM (copia de los handlers Teclado + ISR a RAM)
   220 00000064 55                        push    ebp
   221 00000065 89E5                      mov     ebp, esp 
   222 00000067 68[00000000]              push    __handlers_32_size
   223 0000006C 68[00000000]              push    __TECLADO_ISR_PHY
   224 00000071 68[00000000]              push    __TECLADO_ISR_LMA
   225 00000076 E8(00000000)              call    __fast_memcpy
   226 0000007B C9                        leave
   227 0000007C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   228 0000007F 0F85D20D0000              jne     .guard
   229                                    ; -> Desempaquetamiento de la ROM (copia de datos de ROM a RAM)
   230 00000085 55                        push    ebp
   231 00000086 89E5                      mov     ebp, esp 
   232 00000088 68[00000000]              push    __data_size
   233 0000008D 68[00000000]              push    __DATOS_SYS32_PHY
   234 00000092 68[00000000]              push    __DATOS_SYS32_LMA
   235 00000097 E8(00000000)              call    __fast_memcpy
   236 0000009C C9                        leave
   237 0000009D 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   238 000000A0 0F85B10D0000              jne     .guard
   239                                    ; -> Desempaquetamiento de la ROM (copia de las tablas de sistema (GDT e IDT) a RAM)
   240 000000A6 55                        push    ebp
   241 000000A7 89E5                      mov     ebp, esp 
   242 000000A9 68[00000000]              push    __sys_tables_size
   243 000000AE 68[00000000]              push    __SYS_TABLES_PHY
   244 000000B3 68[00000000]              push    __SYS_TABLES_LMA
   245 000000B8 E8(00000000)              call    __fast_memcpy
   246 000000BD C9                        leave
   247 000000BE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   248 000000C1 0F85900D0000              jne     .guard
   249                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_1 a RAM)
   250 000000C7 55                        push    ebp
   251 000000C8 89E5                      mov     ebp, esp 
   252 000000CA 68[00000000]              push    __tarea_01_size
   253 000000CF 68[00000000]              push    __TAREA1_TEXT_PHY
   254 000000D4 68[00000000]              push    __TAREA1_TEXT_LMA
   255 000000D9 E8(00000000)              call    __fast_memcpy
   256 000000DE C9                        leave
   257 000000DF 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   258 000000E2 0F856F0D0000              jne     .guard
   259                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _1 a RAM)
   260 000000E8 55                        push    ebp
   261 000000E9 89E5                      mov     ebp, esp 
   262 000000EB 68[00000000]              push    __tarea_1_bss_size
   263 000000F0 68[00000000]              push    __TAREA1_BSS_PHY
   264 000000F5 68[00000000]              push    __TAREA1_BSS_LMA
   265 000000FA E8(00000000)              call    __fast_memcpy
   266 000000FF C9                        leave
   267 00000100 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   268 00000103 0F854E0D0000              jne     .guard
   269                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _1 a RAM)
   270 00000109 55                        push    ebp
   271 0000010A 89E5                      mov     ebp, esp 
   272 0000010C 68[00000000]              push    __tarea_1_data_size
   273 00000111 68[00000000]              push    __TAREA1_DATA_PHY
   274 00000116 68[00000000]              push    __TAREA1_DATA_LMA
   275 0000011B E8(00000000)              call    __fast_memcpy
   276 00000120 C9                        leave
   277 00000121 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   278 00000124 0F852D0D0000              jne     .guard
   279                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _1 a RAM)
   280 0000012A 55                        push    ebp
   281 0000012B 89E5                      mov     ebp, esp 
   282 0000012D 68[00000000]              push    __tarea_1_rodata_size
   283 00000132 68[00000000]              push    __TAREA1_RODATA_PHY
   284 00000137 68[00000000]              push    __TAREA1_RODATA_LMA
   285 0000013C E8(00000000)              call    __fast_memcpy
   286 00000141 C9                        leave
   287 00000142 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   288 00000145 0F850C0D0000              jne     .guard
   289                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_2 a RAM)
   290 0000014B 55                        push    ebp
   291 0000014C 89E5                      mov     ebp, esp 
   292 0000014E 68[00000000]              push    __tarea_02_size
   293 00000153 68[00000000]              push    __TAREA2_TEXT_PHY
   294 00000158 68[00000000]              push    __TAREA2_TEXT_LMA
   295 0000015D E8(00000000)              call    __fast_memcpy
   296 00000162 C9                        leave
   297 00000163 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   298 00000166 0F85EB0C0000              jne     .guard
   299                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _2 a RAM)
   300 0000016C 55                        push    ebp
   301 0000016D 89E5                      mov     ebp, esp 
   302 0000016F 68[00000000]              push    __tarea_2_bss_size
   303 00000174 68[00000000]              push    __TAREA2_BSS_PHY
   304 00000179 68[00000000]              push    __TAREA2_BSS_LMA
   305 0000017E E8(00000000)              call    __fast_memcpy
   306 00000183 C9                        leave
   307 00000184 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   308 00000187 0F85CA0C0000              jne     .guard
   309                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA _2 a RAM)
   310 0000018D 55                        push    ebp
   311 0000018E 89E5                      mov     ebp, esp 
   312 00000190 68[00000000]              push    __tarea_2_data_size
   313 00000195 68[00000000]              push    __TAREA2_DATA_PHY
   314 0000019A 68[00000000]              push    __TAREA2_DATA_LMA
   315 0000019F E8(00000000)              call    __fast_memcpy
   316 000001A4 C9                        leave
   317 000001A5 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   318 000001A8 0F85A90C0000              jne     .guard
   319                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _2 a RAM)
   320 000001AE 55                        push    ebp
   321 000001AF 89E5                      mov     ebp, esp 
   322 000001B1 68[00000000]              push    __tarea_2_rodata_size
   323 000001B6 68[00000000]              push    __TAREA2_RODATA_PHY
   324 000001BB 68[00000000]              push    __TAREA2_RODATA_LMA
   325 000001C0 E8(00000000)              call    __fast_memcpy
   326 000001C5 C9                        leave
   327 000001C6 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   328 000001C9 0F85880C0000              jne     .guard
   329                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_3 a RAM)
   330 000001CF 55                        push    ebp
   331 000001D0 89E5                      mov     ebp, esp 
   332 000001D2 68[00000000]              push    __tarea_03_size
   333 000001D7 68[00000000]              push    __TAREA3_TEXT_PHY
   334 000001DC 68[00000000]              push    __TAREA3_TEXT_LMA
   335 000001E1 E8(00000000)              call    __fast_memcpy
   336 000001E6 C9                        leave
   337 000001E7 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   338 000001EA 0F85670C0000              jne     .guard
   339                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA _3 a RAM)
   340 000001F0 55                        push    ebp
   341 000001F1 89E5                      mov     ebp, esp 
   342 000001F3 68[00000000]              push    __tarea_3_bss_size
   343 000001F8 68[00000000]              push    __TAREA3_BSS_PHY
   344 000001FD 68[00000000]              push    __TAREA3_BSS_LMA
   345 00000202 E8(00000000)              call    __fast_memcpy
   346 00000207 C9                        leave
   347 00000208 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   348 0000020B 0F85460C0000              jne     .guard
   349                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_3 a RAM)
   350 00000211 55                        push    ebp
   351 00000212 89E5                      mov     ebp, esp 
   352 00000214 68[00000000]              push    __tarea_3_data_size
   353 00000219 68[00000000]              push    __TAREA3_DATA_PHY
   354 0000021E 68[00000000]              push    __TAREA3_DATA_LMA
   355 00000223 E8(00000000)              call    __fast_memcpy
   356 00000228 C9                        leave
   357 00000229 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   358 0000022C 0F85250C0000              jne     .guard
   359                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA _3 a RAM)
   360 00000232 55                        push    ebp
   361 00000233 89E5                      mov     ebp, esp 
   362 00000235 68[00000000]              push    __tarea_3_rodata_size
   363 0000023A 68[00000000]              push    __TAREA3_RODATA_PHY
   364 0000023F 68[00000000]              push    __TAREA3_RODATA_LMA
   365 00000244 E8(00000000)              call    __fast_memcpy
   366 00000249 C9                        leave
   367 0000024A 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   368 0000024D 0F85040C0000              jne     .guard
   369                                    ; -> Desempaquetamiento de la ROM (copia del .text de la TAREA_4 a RAM)
   370 00000253 55                        push    ebp
   371 00000254 89E5                      mov     ebp, esp 
   372 00000256 68[00000000]              push    __tarea_04_size
   373 0000025B 68[00000000]              push    __TAREA4_TEXT_PHY
   374 00000260 68[00000000]              push    __TAREA4_TEXT_LMA
   375 00000265 E8(00000000)              call    __fast_memcpy
   376 0000026A C9                        leave
   377 0000026B 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   378 0000026E 0F85E30B0000              jne     .guard
   379                                    ; -> Desempaquetamiento de la ROM (copia del .bss de la TAREA_4 a RAM)
   380 00000274 55                        push    ebp
   381 00000275 89E5                      mov     ebp, esp 
   382 00000277 68[00000000]              push    __tarea_4_bss_size
   383 0000027C 68[00000000]              push    __TAREA4_BSS_PHY
   384 00000281 68[00000000]              push    __TAREA4_BSS_LMA
   385 00000286 E8(00000000)              call    __fast_memcpy
   386 0000028B C9                        leave
   387 0000028C 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   388 0000028F 0F85C20B0000              jne     .guard
   389                                    ; -> Desempaquetamiento de la ROM (copia del .data de la TAREA_4 a RAM)
   390 00000295 55                        push    ebp
   391 00000296 89E5                      mov     ebp, esp 
   392 00000298 68[00000000]              push    __tarea_4_data_size
   393 0000029D 68[00000000]              push    __TAREA4_DATA_PHY
   394 000002A2 68[00000000]              push    __TAREA4_DATA_LMA
   395 000002A7 E8(00000000)              call    __fast_memcpy
   396 000002AC C9                        leave
   397 000002AD 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   398 000002B0 0F85A10B0000              jne     .guard
   399                                    ; -> Desempaquetamiento de la ROM (copia del .rodata de la TAREA_4 a RAM)
   400 000002B6 55                        push    ebp
   401 000002B7 89E5                      mov     ebp, esp 
   402 000002B9 68[00000000]              push    __tarea_4_rodata_size
   403 000002BE 68[00000000]              push    __TAREA4_RODATA_PHY
   404 000002C3 68[00000000]              push    __TAREA4_RODATA_LMA
   405 000002C8 E8(00000000)              call    __fast_memcpy
   406 000002CD C9                        leave
   407 000002CE 83F801                    cmp     eax, 1 ; Analizo el valor de retorno de memcopy (1 Exito , 0 Fallo)
   408 000002D1 0F85800B0000              jne     .guard
   409                                  
   410                                    ;-> Cargo la IDT y la GDT ya copiada en RAM
   411 000002D7 0F0115[00000000]          lgdt [_gdtr_32]
   412 000002DE 0F011D[00000000]          lidt [_idtr_32]  
   413                                  
   414                                    ; -> Init PIC , IRQ y config. Timer y teclado
   415 000002E5 E8(00000000)              call init_teclado       ; Inicializo controlador de teclado
   416 000002EA E8(00000000)              call init_timer         ; Configuro Timer tick para 100ms
   417 000002EF E8(00000000)              call init_pic           ; Inicializo los PICs e interrupciones de Timer y Teclado
   418                                  
   419                                    ;----------------------------------------------
   420                                    ;-----------------PAGINACIÓN-------------------
   421                                    ;----------------------------------------------
   422                                  
   423                                    ; -> Inicializo CR3 con la dirección base del DPT correspondiente al Kernel.
   424 000002F4 55                        push    ebp
   425 000002F5 89E5                      mov     ebp, esp
   426 000002F7 6A01                      push    PAG_PWT_YES
   427 000002F9 6A01                      push    PAG_PCD_YES
   428 000002FB 68[00000000]              push    dword __CR3_KERNEL_PHY
   429 00000300 E8(00000000)              call    set_cr3_rom
   430 00000305 0F22D8                    mov     cr3, eax
   431 00000308 C9                        leave
   432                                  
   433                                    ;--------------------------------------------
   434                                    ;-----------Mapeo del Kernel-----------------
   435                                    ;--------------------------------------------
   436                                    ;------------CR3_KERNEL                       = Base del DTP del Kernel
   437                                    ;------------CR3_KERNEL + 0x1000              = Tamaño del DTP
   438                                    ;-----------(CR3 KERNEL + 0x1000)+0x1000*DPTE = Bases de las TP
   439                                  
   440                                    ; HANDLERS, VGA, SYS_TABLES, KERNEL_32, DIGITS_TABLE, DATA_SYS, STACK_SYS, INIT_32 (este código), __TSS_BASICA, TSS_1, TSS_2, TSS_3
   441                                  
   442                                    ;------__TECLADO_ISR_PHY-----------
   443                                    ; ->Cargo DPTE y PTE
   444 00000309 55                        push    ebp
   445 0000030A 89E5                      mov     ebp, esp
   446 0000030C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   447 0000030E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   448 00000310 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   449 00000312 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   450 00000314 68[00000000]              push    __TECLADO_ISR_PHY
   451 00000319 68[00000000]              push    __TECLADO_ISR_VMA 
   452 0000031E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   453 00000323 E8(00000000)              call    set_page_rom
   454 00000328 C9                        leave
   455                                  
   456                                  ;------__VGA_PHY-----------
   457                                  ; ->Cargo DPTE y PTE
   458 00000329 55                        push    ebp
   459 0000032A 89E5                      mov     ebp, esp 
   460 0000032C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   461 0000032E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   462 00000330 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   463 00000332 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   464 00000334 68[00000000]              push    __VGA_PHY
   465 00000339 68[00000000]              push    __VGA_VMA 
   466 0000033E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   467 00000343 E8(00000000)              call    set_page_rom
   468 00000348 C9                        leave
   469                                  
   470                                  ;------__SYS_TABLES_PHY-----------
   471                                    ; ->Cargo DPTE y PTE
   472 00000349 55                        push    ebp
   473 0000034A 89E5                      mov     ebp, esp 
   474 0000034C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   475 0000034E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   476 00000350 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   477 00000352 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   478 00000354 68[00000000]              push    __SYS_TABLES_PHY
   479 00000359 68[00000000]              push    __SYS_TABLES_VMA 
   480 0000035E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   481 00000363 E8(00000000)              call    set_page_rom
   482 00000368 C9                        leave
   483                                  
   484                                  ;------__KERNEL_32_PHY-----------
   485                                    ; ->Cargo DPTE y PTE
   486 00000369 55                        push    ebp
   487 0000036A 89E5                      mov     ebp, esp 
   488 0000036C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   489 0000036E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   490 00000370 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   491 00000372 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   492 00000374 68[00000000]              push    __KERNEL_32_PHY
   493 00000379 68[00000000]              push    __KERNEL_32_VMA 
   494 0000037E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   495 00000383 E8(00000000)              call    set_page_rom
   496 00000388 C9                        leave
   497                                  
   498                                  
   499                                  ;------1era pag de__FUNCTIONS_PHY-----------
   500                                    ; ->Cargo DPTE y PTE
   501 00000389 55                        push    ebp
   502 0000038A 89E5                      mov     ebp, esp 
   503 0000038C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   504 0000038E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   505 00000390 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   506 00000392 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   507 00000394 68[00000000]              push    __FUNCTIONS_PHY
   508 00000399 68[00000000]              push    __FUNCTIONS_VMA 
   509 0000039E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   510 000003A3 E8(00000000)              call    set_page_rom
   511 000003A8 C9                        leave
   512                                  
   513                                  
   514                                  ;------2da pag de__FUNCTIONS_PHY-----------
   515                                    ; ->Cargo DPTE y PTE
   516 000003A9 55                        push    ebp
   517 000003AA 89E5                      mov     ebp, esp 
   518 000003AC 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   519 000003AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   520 000003B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   521 000003B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   522 000003B4 68[00100000]              push    __FUNCTIONS_PHY + 0x1000
   523 000003B9 68[00100000]              push    __FUNCTIONS_VMA + 0x1000 
   524 000003BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   525 000003C3 E8(00000000)              call    set_page_rom
   526 000003C8 C9                        leave
   527                                  
   528                                  
   529                                  ;------__DIGITS_TABLE_PHY-----------
   530                                    ; ->Cargo DPTE y PTE
   531 000003C9 55                        push    ebp
   532 000003CA 89E5                      mov     ebp, esp 
   533 000003CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   534 000003CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   535 000003D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   536 000003D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   537 000003D4 68[00000000]              push    __DIGITS_TABLE_PHY
   538 000003D9 68[00000000]              push    __DIGITS_TABLE_VMA 
   539 000003DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   540 000003E3 E8(00000000)              call    set_page_rom
   541 000003E8 C9                        leave
   542                                  
   543                                  ;------__DATOS_SYS32_PHY-----------
   544                                    ; ->Cargo DPTE y PTE
   545 000003E9 55                        push    ebp
   546 000003EA 89E5                      mov     ebp, esp 
   547 000003EC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   548 000003EE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   549 000003F0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   550 000003F2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   551 000003F4 68[00000000]              push    __DATOS_SYS32_PHY
   552 000003F9 68[00000000]              push    __DATOS_SYS32_VMA 
   553 000003FE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   554 00000403 E8(00000000)              call    set_page_rom
   555 00000408 C9                        leave
   556                                  
   557                                  
   558                                  ;------__STACK_KERNEL_VMA-----------
   559                                    ; ->Cargo DPTE y PTE
   560 00000409 55                        push    ebp
   561 0000040A 89E5                      mov     ebp, esp 
   562 0000040C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   563 0000040E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   564 00000410 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   565 00000412 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   566 00000414 68[00000000]              push    __STACK_KERNEL_PHY
   567 00000419 68[00000000]              push    __STACK_KERNEL_VMA 
   568 0000041E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   569 00000423 E8(00000000)              call    set_page_rom
   570 00000428 C9                        leave
   571                                  
   572                                  
   573                                  ;------__INIT_32_VMA-----------
   574                                    ; ->Cargo DPTE y PTE
   575 00000429 55                        push    ebp
   576 0000042A 89E5                      mov     ebp, esp 
   577 0000042C 6A00                      push    PAG_RW_R          ; Permisos R/W para el PTE
   578 0000042E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   579 00000430 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   580 00000432 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   581 00000434 68[00000000]              push    __INIT_32_VMA     ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   582 00000439 68[00000000]              push    __INIT_32_VMA 
   583 0000043E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   584 00000443 E8(00000000)              call    set_page_rom
   585 00000448 C9                        leave
   586                                  
   587                                    ;------__INIT_32_VMA-----------
   588                                    ; ->Cargo DPTE y PTE
   589 00000449 55                        push    ebp
   590 0000044A 89E5                      mov     ebp, esp 
   591 0000044C 6A00                      push    PAG_RW_R                  ; Permisos R/W para el PTE
   592 0000044E 6A01                      push    PAG_RW_W                  ; Permisos R/W para el DPTE
   593 00000450 6A00                      push    PAG_US_SUP                ; Permisos de Supervisor/Usuario para el PTE
   594 00000452 6A00                      push    PAG_US_SUP                ; Permisos de Supervisor/Usuario para el DPTE
   595 00000454 68[00100000]              push    __INIT_32_VMA + 0x1000    ; Identitty Mapping para que pueda funcionar este código luego de prender paginación.
   596 00000459 68[00100000]              push    __INIT_32_VMA + 0x1000 
   597 0000045E 68[00000000]              push    __CR3_KERNEL_PHY          ; Base del DPT del Kernel 
   598 00000463 E8(00000000)              call    set_page_rom
   599 00000468 C9                        leave
   600                                  
   601                                  ;------__TSS_BASICA-----------
   602                                    ; ->Cargo DPTE y PTE
   603 00000469 55                        push    ebp
   604 0000046A 89E5                      mov     ebp, esp 
   605 0000046C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   606 0000046E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   607 00000470 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   608 00000472 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   609 00000474 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   610 00000479 68[00000000]              push    __TSS_BASICA 
   611 0000047E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   612 00000483 E8(00000000)              call    set_page_rom
   613 00000488 C9                        leave
   614                                  
   615                                  ;------TSS_1-----------
   616                                    ; ->Cargo DPTE y PTE
   617 00000489 55                        push    ebp
   618 0000048A 89E5                      mov     ebp, esp 
   619 0000048C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   620 0000048E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   621 00000490 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   622 00000492 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   623 00000494 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   624 00000499 68[00000000]              push    __TSS1_VMA 
   625 0000049E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   626 000004A3 E8(00000000)              call    set_page_rom
   627 000004A8 C9                        leave
   628                                  
   629                                  ;------__TSS_2-----------
   630                                    ; ->Cargo DPTE y PTE
   631 000004A9 55                        push    ebp
   632 000004AA 89E5                      mov     ebp, esp 
   633 000004AC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   634 000004AE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   635 000004B0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   636 000004B2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   637 000004B4 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
   638 000004B9 68[00000000]              push    __TSS2_VMA 
   639 000004BE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   640 000004C3 E8(00000000)              call    set_page_rom
   641 000004C8 C9                        leave
   642                                  
   643                                    ;------__TSS_3-----------
   644                                    ; ->Cargo DPTE y PTE
   645 000004C9 55                        push    ebp
   646 000004CA 89E5                      mov     ebp, esp 
   647 000004CC 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   648 000004CE 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   649 000004D0 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   650 000004D2 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   651 000004D4 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
   652 000004D9 68[00000000]              push    __TSS3_VMA 
   653 000004DE 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   654 000004E3 E8(00000000)              call    set_page_rom
   655 000004E8 C9                        leave
   656                                  
   657                                    ;------__TSS_4-----------
   658                                    ; ->Cargo DPTE y PTE
   659 000004E9 55                        push    ebp
   660 000004EA 89E5                      mov     ebp, esp 
   661 000004EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   662 000004EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   663 000004F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   664 000004F2 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el DPTE
   665 000004F4 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
   666 000004F9 68[00000000]              push    __TSS4_VMA 
   667 000004FE 68[00000000]              push    __CR3_KERNEL_PHY    ; Base del DPT del Kernel 
   668 00000503 E8(00000000)              call    set_page_rom
   669 00000508 C9                        leave
   670                                  
   671                                    ;------MMX2_VMA-----------
   672                                    ; ->Cargo DPTE y PTE
   673 00000509 55                        push    ebp
   674 0000050A 89E5                      mov     ebp, esp 
   675 0000050C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   676 0000050E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   677 00000510 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   678 00000512 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el DPTE
   679 00000514 68[00000000]              push    __MMX2_VMA          ; Identitty Mapping
   680 00000519 68[00000000]              push    __MMX2_VMA 
   681 0000051E 68[00000000]              push    __CR3_KERNEL_PHY  ; Base del DPT del Kernel 
   682 00000523 E8(00000000)              call    set_page_rom
   683 00000528 C9                        leave
   684                                  
   685                                      ;------MMX3_VMA-----------
   686                                    ; ->Cargo DPTE y PTE
   687 00000529 55                        push    ebp
   688 0000052A 89E5                      mov     ebp, esp 
   689 0000052C 6A01                      push    PAG_RW_W           ; Permisos R/W para el PTE
   690 0000052E 6A01                      push    PAG_RW_W           ; Permisos R/W para el DPTE
   691 00000530 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el PTE
   692 00000532 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el DPTE
   693 00000534 68[00000000]              push    __MMX3_VMA         ; Identitty Mapping
   694 00000539 68[00000000]              push    __MMX3_VMA 
   695 0000053E 68[00000000]              push    __CR3_KERNEL_PHY   ; Base del DPT del Kernel 
   696 00000543 E8(00000000)              call    set_page_rom
   697 00000548 C9                        leave
   698                                  
   699                                  
   700                                  
   701                                    ;--------------------------------------------
   702                                    ;-----------Mapeo de la Tarea 1 -------------
   703                                    ;--------------------------------------------
   704                                    ;------------__CR3_TAREA_1_PHY                            = Base del DTP de la Tarea 1
   705                                    ;------------__CR3_TAREA_1_PHY + 0x1000                   = Tamaño del DTP
   706                                    ;-----------(CR3 __CR3_TAREA_1_PHY + 0x1000)+0x1000*DPTE  = Bases de las TP
   707                                  
   708                                    ;------__TECLADO_ISR_PHY-----------
   709                                    ; ->Cargo DPTE y PTE
   710 00000549 55                        push    ebp
   711 0000054A 89E5                      mov     ebp, esp 
   712 0000054C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   713 0000054E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   714 00000550 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   715 00000552 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   716 00000554 68[00000000]              push    __TECLADO_ISR_PHY     
   717 00000559 68[00000000]              push    __TECLADO_ISR_VMA 
   718 0000055E 68[00000000]              push    __CR3_TAREA_1_PHY   ; Base del DPT de la Tarea 1 
   719 00000563 E8(00000000)              call    set_page_rom
   720 00000568 C9                        leave
   721                                    ;------__VGA_PHY-----------
   722                                    ; ->Cargo DPTE y PTE
   723 00000569 55                        push    ebp
   724 0000056A 89E5                      mov     ebp, esp 
   725 0000056C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   726 0000056E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   727 00000570 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   728 00000572 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   729 00000574 68[00000000]              push    __VGA_PHY     
   730 00000579 68[00000000]              push    __VGA_VMA 
   731 0000057E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   732 00000583 E8(00000000)              call    set_page_rom
   733 00000588 C9                        leave
   734                                  
   735                                    ;------__FUNCTIONS_PHY-----------
   736                                    ; ->Cargo DPTE y PTE
   737 00000589 55                        push    ebp
   738 0000058A 89E5                      mov     ebp, esp 
   739 0000058C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   740 0000058E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   741 00000590 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   742 00000592 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   743 00000594 68[00000000]              push    __FUNCTIONS_PHY     
   744 00000599 68[00000000]              push    __FUNCTIONS_VMA 
   745 0000059E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   746 000005A3 E8(00000000)              call    set_page_rom
   747 000005A8 C9                        leave
   748                                  
   749                                      ;------2da __FUNCTIONS_PHY-----------
   750                                    ; ->Cargo DPTE y PTE
   751 000005A9 55                        push    ebp
   752 000005AA 89E5                      mov     ebp, esp 
   753 000005AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   754 000005AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   755 000005B0 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
   756 000005B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   757 000005B4 68[00100000]              push    __FUNCTIONS_PHY + 0x1000     
   758 000005B9 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
   759 000005BE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   760 000005C3 E8(00000000)              call    set_page_rom
   761 000005C8 C9                        leave
   762                                  
   763                                  
   764                                    ;------__DATOS_SYS32_PHY-----------
   765                                    ; ->Cargo DPTE y PTE
   766 000005C9 55                        push    ebp
   767 000005CA 89E5                      mov     ebp, esp 
   768 000005CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   769 000005CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   770 000005D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   771 000005D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   772 000005D4 68[00000000]              push    __DATOS_SYS32_PHY     
   773 000005D9 68[00000000]              push    __DATOS_SYS32_VMA 
   774 000005DE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   775 000005E3 E8(00000000)              call    set_page_rom
   776 000005E8 C9                        leave
   777                                  
   778                                    ;------__DIGITS_TABLE_PHY-----------
   779                                    ; ->Cargo DPTE y PTE
   780 000005E9 55                        push    ebp
   781 000005EA 89E5                      mov     ebp, esp 
   782 000005EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   783 000005EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   784 000005F0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   785 000005F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   786 000005F4 68[00000000]              push    __DIGITS_TABLE_PHY     
   787 000005F9 68[00000000]              push    __DIGITS_TABLE_VMA 
   788 000005FE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   789 00000603 E8(00000000)              call    set_page_rom
   790 00000608 C9                        leave
   791                                  
   792                                    ;------__SYS_TABLES_PHY-----------
   793                                    ; ->Cargo DPTE y PTE
   794 00000609 55                        push    ebp
   795 0000060A 89E5                      mov     ebp, esp 
   796 0000060C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   797 0000060E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   798 00000610 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   799 00000612 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   800 00000614 68[00000000]              push    __SYS_TABLES_PHY     
   801 00000619 68[00000000]              push    __SYS_TABLES_VMA 
   802 0000061E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   803 00000623 E8(00000000)              call    set_page_rom
   804 00000628 C9                        leave
   805                                  
   806                                    ;------__TAREA1_TEXT_PHY-----------
   807                                    ; ->Cargo DPTE y PTE
   808 00000629 55                        push    ebp
   809 0000062A 89E5                      mov     ebp, esp 
   810 0000062C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   811 0000062E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   812 00000630 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   813 00000632 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   814 00000634 68[00000000]              push    __TAREA1_TEXT_PHY     
   815 00000639 68[00000000]              push    __TAREA1_TEXT_VMA 
   816 0000063E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   817 00000643 E8(00000000)              call    set_page_rom
   818 00000648 C9                        leave
   819                                  
   820                                    ;------__TAREA1_BSS_PHY-----------
   821                                    ; ->Cargo DPTE y PTE
   822 00000649 55                        push    ebp
   823 0000064A 89E5                      mov     ebp, esp 
   824 0000064C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   825 0000064E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   826 00000650 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   827 00000652 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   828 00000654 68[00000000]              push    __TAREA1_BSS_PHY     
   829 00000659 68[00000000]              push    __TAREA1_BSS_VMA 
   830 0000065E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   831 00000663 E8(00000000)              call    set_page_rom
   832 00000668 C9                        leave
   833                                  
   834                                    ;------__TAREA1_RODATA_PHY-----------
   835                                    ; ->Cargo DPTE y PTE
   836 00000669 55                        push    ebp
   837 0000066A 89E5                      mov     ebp, esp 
   838 0000066C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   839 0000066E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   840 00000670 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   841 00000672 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   842 00000674 68[00000000]              push    __TAREA1_RODATA_PHY     
   843 00000679 68[00000000]              push    __TAREA1_RODATA_VMA 
   844 0000067E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   845 00000683 E8(00000000)              call    set_page_rom
   846 00000688 C9                        leave
   847                                  
   848                                  
   849                                    ;------__TAREA1_DATA_PHY-----------
   850                                    ; ->Cargo DPTE y PTE
   851 00000689 55                        push    ebp
   852 0000068A 89E5                      mov     ebp, esp 
   853 0000068C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   854 0000068E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   855 00000690 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   856 00000692 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   857 00000694 68[00000000]              push    __TAREA1_DATA_PHY     
   858 00000699 68[00000000]              push    __TAREA1_DATA_VMA 
   859 0000069E 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   860 000006A3 E8(00000000)              call    set_page_rom
   861 000006A8 C9                        leave
   862                                    
   863                                    ;------__TAREA1_STACK_START_PHY-----------
   864                                    ; ->Cargo DPTE y PTE
   865 000006A9 55                        push    ebp
   866 000006AA 89E5                      mov     ebp, esp 
   867 000006AC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   868 000006AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   869 000006B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
   870 000006B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   871 000006B4 68[00000000]              push    __TAREA1_STACK_START_PHY     
   872 000006B9 68[00000000]              push    __TAREA1_STACK_START_VMA 
   873 000006BE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   874 000006C3 E8(00000000)              call    set_page_rom
   875 000006C8 C9                        leave
   876                                  
   877                                  
   878                                    ;------__STACK_KERNEL_TAREA1_PHY-----------
   879                                    ; ->Cargo DPTE y PTE
   880 000006C9 55                        push    ebp
   881 000006CA 89E5                      mov     ebp, esp 
   882 000006CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   883 000006CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   884 000006D0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   885 000006D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   886 000006D4 68[00000000]              push    __STACK_KERNEL_TAREA1_PHY     
   887 000006D9 68[00000000]              push    __STACK_KERNEL_TAREA1_VMA 
   888 000006DE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   889 000006E3 E8(00000000)              call    set_page_rom
   890 000006E8 C9                        leave
   891                                  
   892                                  
   893                                    ;------__STACK_KERNEL_PHY-----------
   894                                    ; ->Cargo DPTE y PTE
   895 000006E9 55                        push    ebp
   896 000006EA 89E5                      mov     ebp, esp 
   897 000006EC 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
   898 000006EE 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
   899 000006F0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
   900 000006F2 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
   901 000006F4 68[00000000]              push    __STACK_KERNEL_PHY     
   902 000006F9 68[00000000]              push    __STACK_KERNEL_VMA 
   903 000006FE 68[00000000]              push    __CR3_TAREA_1_PHY    ; Base del DPT de la Tarea 1 
   904 00000703 E8(00000000)              call    set_page_rom
   905 00000708 C9                        leave
   906                                  
   907                                    ;------__TSS_1-----------
   908                                    ; ->Cargo DPTE y PTE
   909 00000709 55                        push    ebp
   910 0000070A 89E5                      mov     ebp, esp 
   911 0000070C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   912 0000070E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   913 00000710 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   914 00000712 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   915 00000714 68[00000000]              push    __TSS1_VMA          ; Identitty Mapping
   916 00000719 68[00000000]              push    __TSS1_VMA 
   917 0000071E 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   918 00000723 E8(00000000)              call    set_page_rom
   919 00000728 C9                        leave
   920                                    ;------____TSS_BASICA-----------
   921                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
   922                                    ; las pilas de nivel 0.
   923                                    ; ->Cargo DPTE y PTE
   924 00000729 55                        push    ebp
   925 0000072A 89E5                      mov     ebp, esp 
   926 0000072C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
   927 0000072E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
   928 00000730 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
   929 00000732 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
   930 00000734 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
   931 00000739 68[00000000]              push    __TSS_BASICA 
   932 0000073E 68[00000000]              push    __CR3_TAREA_1_PHY  ; Base del DPT del Kernel 
   933 00000743 E8(00000000)              call    set_page_rom
   934 00000748 C9                        leave
   935                                  
   936                                    ;--------------------------------------------
   937                                    ;-----------Mapeo de la Tarea 2 -------------
   938                                    ;--------------------------------------------
   939                                    ;------------__CR3_TAREA_2_PHY                            = Base del DTP de la Tarea 2
   940                                    ;------------__CR3_TAREA_2_PHY + 0x1000                   = Tamaño del DTP
   941                                    ;-----------(__CR3_TAREA_2_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
   942                                  
   943                                    ;------__TECLADO_ISR_PHY-----------
   944                                    ; ->Cargo DPTE y PTE
   945 00000749 55                        push    ebp
   946 0000074A 89E5                      mov     ebp, esp 
   947 0000074C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
   948 0000074E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
   949 00000750 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
   950 00000752 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
   951 00000754 68[00000000]              push    __TECLADO_ISR_PHY     
   952 00000759 68[00000000]              push    __TECLADO_ISR_VMA 
   953 0000075E 68[00000000]              push    __CR3_TAREA_2_PHY   ; Base del DPT de la Tarea 1 
   954 00000763 E8(00000000)              call    set_page_rom
   955 00000768 C9                        leave
   956                                    ;------__VGA_PHY-----------
   957                                    ; ->Cargo DPTE y PTE
   958 00000769 55                        push    ebp
   959 0000076A 89E5                      mov     ebp, esp 
   960 0000076C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
   961 0000076E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   962 00000770 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   963 00000772 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   964 00000774 68[00000000]              push    __VGA_PHY     
   965 00000779 68[00000000]              push    __VGA_VMA 
   966 0000077E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   967 00000783 E8(00000000)              call    set_page_rom
   968 00000788 C9                        leave
   969                                  
   970                                    ;------__FUNCTIONS_PHY-----------
   971                                    ; ->Cargo DPTE y PTE
   972 00000789 55                        push    ebp
   973 0000078A 89E5                      mov     ebp, esp 
   974 0000078C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   975 0000078E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   976 00000790 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   977 00000792 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   978 00000794 68[00000000]              push    __FUNCTIONS_PHY     
   979 00000799 68[00000000]              push    __FUNCTIONS_VMA 
   980 0000079E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   981 000007A3 E8(00000000)              call    set_page_rom
   982 000007A8 C9                        leave
   983                                  
   984                                      ;------2da __FUNCTIONS_PHY-----------
   985                                    ; ->Cargo DPTE y PTE
   986 000007A9 55                        push    ebp
   987 000007AA 89E5                      mov     ebp, esp 
   988 000007AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
   989 000007AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
   990 000007B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
   991 000007B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
   992 000007B4 68[00100000]              push    __FUNCTIONS_PHY + 0x1000    
   993 000007B9 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
   994 000007BE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
   995 000007C3 E8(00000000)              call    set_page_rom
   996 000007C8 C9                        leave
   997                                  
   998                                    ;------__DATOS_SYS32_PHY-----------
   999                                    ; ->Cargo DPTE y PTE
  1000 000007C9 55                        push    ebp
  1001 000007CA 89E5                      mov     ebp, esp 
  1002 000007CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1003 000007CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1004 000007D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1005 000007D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1006 000007D4 68[00000000]              push    __DATOS_SYS32_PHY     
  1007 000007D9 68[00000000]              push    __DATOS_SYS32_VMA 
  1008 000007DE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1009 000007E3 E8(00000000)              call    set_page_rom
  1010 000007E8 C9                        leave
  1011                                  
  1012                                    ;------__DIGITS_TABLE_PHY-----------
  1013                                    ; ->Cargo DPTE y PTE
  1014 000007E9 55                        push    ebp
  1015 000007EA 89E5                      mov     ebp, esp 
  1016 000007EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1017 000007EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1018 000007F0 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
  1019 000007F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1020 000007F4 68[00000000]              push    __DIGITS_TABLE_PHY     
  1021 000007F9 68[00000000]              push    __DIGITS_TABLE_VMA 
  1022 000007FE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1023 00000803 E8(00000000)              call    set_page_rom
  1024 00000808 C9                        leave
  1025                                  
  1026                                    ;------__SYS_TABLES_PHY-----------
  1027                                    ; ->Cargo DPTE y PTE
  1028 00000809 55                        push    ebp
  1029 0000080A 89E5                      mov     ebp, esp 
  1030 0000080C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1031 0000080E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1032 00000810 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1033 00000812 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1034 00000814 68[00000000]              push    __SYS_TABLES_PHY     
  1035 00000819 68[00000000]              push    __SYS_TABLES_VMA 
  1036 0000081E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1037 00000823 E8(00000000)              call    set_page_rom
  1038 00000828 C9                        leave
  1039                                  
  1040                                    ;------__TAREA2_TEXT_PHY-----------
  1041                                    ; ->Cargo DPTE y PTE
  1042 00000829 55                        push    ebp
  1043 0000082A 89E5                      mov     ebp, esp 
  1044 0000082C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1045 0000082E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1046 00000830 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1047 00000832 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1048 00000834 68[00000000]              push    __TAREA2_TEXT_PHY     
  1049 00000839 68[00000000]              push    __TAREA2_TEXT_VMA 
  1050 0000083E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1051 00000843 E8(00000000)              call    set_page_rom
  1052 00000848 C9                        leave
  1053                                  
  1054                                    ;------__TAREA2_BSS_PHY-----------
  1055                                    ; ->Cargo DPTE y PTE
  1056 00000849 55                        push    ebp
  1057 0000084A 89E5                      mov     ebp, esp 
  1058 0000084C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1059 0000084E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1060 00000850 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1061 00000852 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1062 00000854 68[00000000]              push    __TAREA2_BSS_PHY     
  1063 00000859 68[00000000]              push    __TAREA2_BSS_VMA 
  1064 0000085E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1065 00000863 E8(00000000)              call    set_page_rom
  1066 00000868 C9                        leave
  1067                                  
  1068                                    ;------__TAREA2_DATA_PHY-----------
  1069                                    ; ->Cargo DPTE y PTE
  1070 00000869 55                        push    ebp
  1071 0000086A 89E5                      mov     ebp, esp 
  1072 0000086C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1073 0000086E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1074 00000870 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1075 00000872 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1076 00000874 68[00000000]              push    __TAREA2_DATA_PHY     
  1077 00000879 68[00000000]              push    __TAREA2_DATA_VMA 
  1078 0000087E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1079 00000883 E8(00000000)              call    set_page_rom
  1080 00000888 C9                        leave
  1081                                    
  1082                                    ;------__TAREA2_RODATA_PHY-----------
  1083                                    ; ->Cargo DPTE y PTE
  1084 00000889 55                        push    ebp
  1085 0000088A 89E5                      mov     ebp, esp 
  1086 0000088C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1087 0000088E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1088 00000890 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1089 00000892 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1090 00000894 68[00000000]              push    __TAREA2_RODATA_PHY     
  1091 00000899 68[00000000]              push    __TAREA2_RODATA_VMA 
  1092 0000089E 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1093 000008A3 E8(00000000)              call    set_page_rom
  1094 000008A8 C9                        leave
  1095                                  
  1096                                    ;------__TAREA2_STACK_START_PHY-----------
  1097                                    ; ->Cargo DPTE y PTE
  1098 000008A9 55                        push    ebp
  1099 000008AA 89E5                      mov     ebp, esp 
  1100 000008AC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1101 000008AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1102 000008B0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1103 000008B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1104 000008B4 68[00000000]              push    __TAREA2_STACK_START_PHY     
  1105 000008B9 68[00000000]              push    __TAREA2_STACK_START_VMA 
  1106 000008BE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1107 000008C3 E8(00000000)              call    set_page_rom
  1108 000008C8 C9                        leave
  1109                                  
  1110                                    ;------__STACK_KERNEL_TAREA2_PHY-----------
  1111                                    ; ->Cargo DPTE y PTE
  1112 000008C9 55                        push    ebp
  1113 000008CA 89E5                      mov     ebp, esp 
  1114 000008CC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1115 000008CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1116 000008D0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1117 000008D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1118 000008D4 68[00000000]              push    __STACK_KERNEL_TAREA2_PHY     
  1119 000008D9 68[00000000]              push    __STACK_KERNEL_TAREA2_VMA 
  1120 000008DE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1121 000008E3 E8(00000000)              call    set_page_rom
  1122 000008E8 C9                        leave
  1123                                  
  1124                                  
  1125                                    ;------__STACK_KERNEL_PHY-----------
  1126                                    ; ->Cargo DPTE y PTE
  1127 000008E9 55                        push    ebp
  1128 000008EA 89E5                      mov     ebp, esp 
  1129 000008EC 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1130 000008EE 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1131 000008F0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1132 000008F2 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1133 000008F4 68[00000000]              push    __STACK_KERNEL_PHY     
  1134 000008F9 68[00000000]              push    __STACK_KERNEL_VMA 
  1135 000008FE 68[00000000]              push    __CR3_TAREA_2_PHY    ; Base del DPT de la Tarea 1 
  1136 00000903 E8(00000000)              call    set_page_rom
  1137 00000908 C9                        leave
  1138                                  
  1139                                    ;------TSS_2-----------
  1140                                    ; ->Cargo DPTE y PTE
  1141 00000909 55                        push    ebp
  1142 0000090A 89E5                      mov     ebp, esp 
  1143 0000090C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1144 0000090E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1145 00000910 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1146 00000912 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1147 00000914 68[00000000]              push    __TSS2_VMA          ; Identitty Mapping
  1148 00000919 68[00000000]              push    __TSS2_VMA 
  1149 0000091E 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1150 00000923 E8(00000000)              call    set_page_rom
  1151 00000928 C9                        leave
  1152                                  
  1153                                    ;------__MMX2_VMA-----------
  1154                                    ; ->Cargo DPTE y PTE
  1155 00000929 55                        push    ebp
  1156 0000092A 89E5                      mov     ebp, esp 
  1157 0000092C 6A01                      push    PAG_RW_W           ; Permisos R/W para el PTE
  1158 0000092E 6A01                      push    PAG_RW_W           ; Permisos R/W para el DPTE
  1159 00000930 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el PTE
  1160 00000932 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el DPTE
  1161 00000934 68[00000000]              push    __MMX2_VMA         ; Identitty Mapping
  1162 00000939 68[00000000]              push    __MMX2_VMA 
  1163 0000093E 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1164 00000943 E8(00000000)              call    set_page_rom
  1165 00000948 C9                        leave
  1166                                  
  1167                                    ;------____TSS_BASICA-----------
  1168                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1169                                    ; las pilas de nivel 0.
  1170                                    ; ->Cargo DPTE y PTE
  1171 00000949 55                        push    ebp
  1172 0000094A 89E5                      mov     ebp, esp 
  1173 0000094C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1174 0000094E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1175 00000950 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1176 00000952 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1177 00000954 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1178 00000959 68[00000000]              push    __TSS_BASICA 
  1179 0000095E 68[00000000]              push    __CR3_TAREA_2_PHY  ; Base del DPT del Kernel 
  1180 00000963 E8(00000000)              call    set_page_rom
  1181 00000968 C9                        leave
  1182                                  
  1183                                  
  1184                                    ;--------------------------------------------
  1185                                    ;-----------Mapeo de la Tarea 3 -------------
  1186                                    ;--------------------------------------------
  1187                                    ;------------__CR3_TAREA_3_PHY                            = Base del DTP de la Tarea 3
  1188                                    ;------------__CR3_TAREA_3_PHY + 0x1000                   = Tamaño del DTP
  1189                                    ;-----------(__CR3_TAREA_3_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1190                                  
  1191                                    ;------__TECLADO_ISR_PHY-----------
  1192                                    ; ->Cargo DPTE y PTE
  1193 00000969 55                        push    ebp
  1194 0000096A 89E5                      mov     ebp, esp 
  1195 0000096C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1196 0000096E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1197 00000970 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1198 00000972 6A01                      push    PAG_US_US           ; Permisos de Usuario para el DPTE
  1199 00000974 68[00000000]              push    __TECLADO_ISR_PHY     
  1200 00000979 68[00000000]              push    __TECLADO_ISR_VMA 
  1201 0000097E 68[00000000]              push    __CR3_TAREA_3_PHY   ; Base del DPT de la Tarea 3 
  1202 00000983 E8(00000000)              call    set_page_rom
  1203 00000988 C9                        leave
  1204                                    ;------__VGA_PHY-----------
  1205                                    ; ->Cargo DPTE y PTE
  1206 00000989 55                        push    ebp
  1207 0000098A 89E5                      mov     ebp, esp 
  1208 0000098C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1209 0000098E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1210 00000990 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1211 00000992 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1212 00000994 68[00000000]              push    __VGA_PHY     
  1213 00000999 68[00000000]              push    __VGA_VMA 
  1214 0000099E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1215 000009A3 E8(00000000)              call    set_page_rom
  1216 000009A8 C9                        leave
  1217                                  
  1218                                    ;------__FUNCTIONS_PHY-----------
  1219                                    ; ->Cargo DPTE y PTE
  1220 000009A9 55                        push    ebp
  1221 000009AA 89E5                      mov     ebp, esp 
  1222 000009AC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1223 000009AE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1224 000009B0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1225 000009B2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1226 000009B4 68[00000000]              push    __FUNCTIONS_PHY     
  1227 000009B9 68[00000000]              push    __FUNCTIONS_VMA 
  1228 000009BE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1229 000009C3 E8(00000000)              call    set_page_rom
  1230 000009C8 C9                        leave
  1231                                  
  1232                                     ;------2da __FUNCTIONS_PHY-----------
  1233                                    ; ->Cargo DPTE y PTE
  1234 000009C9 55                        push    ebp
  1235 000009CA 89E5                      mov     ebp, esp 
  1236 000009CC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1237 000009CE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1238 000009D0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1239 000009D2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1240 000009D4 68[00100000]              push    __FUNCTIONS_PHY + 0x1000    
  1241 000009D9 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
  1242 000009DE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1243 000009E3 E8(00000000)              call    set_page_rom
  1244 000009E8 C9                        leave
  1245                                  
  1246                                    ;------__DATOS_SYS32_PHY-----------
  1247                                    ; ->Cargo DPTE y PTE
  1248 000009E9 55                        push    ebp
  1249 000009EA 89E5                      mov     ebp, esp 
  1250 000009EC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1251 000009EE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1252 000009F0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1253 000009F2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1254 000009F4 68[00000000]              push    __DATOS_SYS32_PHY     
  1255 000009F9 68[00000000]              push    __DATOS_SYS32_VMA 
  1256 000009FE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1257 00000A03 E8(00000000)              call    set_page_rom
  1258 00000A08 C9                        leave
  1259                                  
  1260                                    ;------__DIGITS_TABLE_PHY-----------
  1261                                    ; ->Cargo DPTE y PTE
  1262 00000A09 55                        push    ebp
  1263 00000A0A 89E5                      mov     ebp, esp 
  1264 00000A0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1265 00000A0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1266 00000A10 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
  1267 00000A12 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1268 00000A14 68[00000000]              push    __DIGITS_TABLE_PHY     
  1269 00000A19 68[00000000]              push    __DIGITS_TABLE_VMA 
  1270 00000A1E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1271 00000A23 E8(00000000)              call    set_page_rom
  1272 00000A28 C9                        leave
  1273                                  
  1274                                    ;------__SYS_TABLES_PHY-----------
  1275                                    ; ->Cargo DPTE y PTE
  1276 00000A29 55                        push    ebp
  1277 00000A2A 89E5                      mov     ebp, esp 
  1278 00000A2C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1279 00000A2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1280 00000A30 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1281 00000A32 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1282 00000A34 68[00000000]              push    __SYS_TABLES_PHY     
  1283 00000A39 68[00000000]              push    __SYS_TABLES_VMA 
  1284 00000A3E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1285 00000A43 E8(00000000)              call    set_page_rom
  1286 00000A48 C9                        leave
  1287                                  
  1288                                    ;------__TAREA3_TEXT_PHY-----------
  1289                                    ; ->Cargo DPTE y PTE
  1290 00000A49 55                        push    ebp
  1291 00000A4A 89E5                      mov     ebp, esp 
  1292 00000A4C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1293 00000A4E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1294 00000A50 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1295 00000A52 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1296 00000A54 68[00000000]              push    __TAREA3_TEXT_PHY     
  1297 00000A59 68[00000000]              push    __TAREA3_TEXT_VMA 
  1298 00000A5E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1299 00000A63 E8(00000000)              call    set_page_rom
  1300 00000A68 C9                        leave
  1301                                  
  1302                                    ;------__TAREA3_BSS_PHY-----------
  1303                                    ; ->Cargo DPTE y PTE
  1304 00000A69 55                        push    ebp
  1305 00000A6A 89E5                      mov     ebp, esp 
  1306 00000A6C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1307 00000A6E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1308 00000A70 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1309 00000A72 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1310 00000A74 68[00000000]              push    __TAREA3_BSS_PHY     
  1311 00000A79 68[00000000]              push    __TAREA3_BSS_VMA 
  1312 00000A7E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1313 00000A83 E8(00000000)              call    set_page_rom
  1314 00000A88 C9                        leave
  1315                                  
  1316                                    ;------__TAREA3_DATA_PHY-----------
  1317                                    ; ->Cargo DPTE y PTE
  1318 00000A89 55                        push    ebp
  1319 00000A8A 89E5                      mov     ebp, esp 
  1320 00000A8C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1321 00000A8E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1322 00000A90 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1323 00000A92 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1324 00000A94 68[00000000]              push    __TAREA3_DATA_PHY     
  1325 00000A99 68[00000000]              push    __TAREA3_DATA_VMA 
  1326 00000A9E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1327 00000AA3 E8(00000000)              call    set_page_rom
  1328 00000AA8 C9                        leave
  1329                                    
  1330                                    ;------__TAREA3_RODATA_PHY-----------
  1331                                    ; ->Cargo DPTE y PTE
  1332 00000AA9 55                        push    ebp
  1333 00000AAA 89E5                      mov     ebp, esp 
  1334 00000AAC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1335 00000AAE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1336 00000AB0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1337 00000AB2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1338 00000AB4 68[00000000]              push    __TAREA3_RODATA_PHY     
  1339 00000AB9 68[00000000]              push    __TAREA3_RODATA_VMA 
  1340 00000ABE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1341 00000AC3 E8(00000000)              call    set_page_rom
  1342 00000AC8 C9                        leave
  1343                                  
  1344                                  
  1345                                    ;------__TAREA3_STACK_START_PHY-----------
  1346                                    ; ->Cargo DPTE y PTE
  1347 00000AC9 55                        push    ebp
  1348 00000ACA 89E5                      mov     ebp, esp 
  1349 00000ACC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1350 00000ACE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1351 00000AD0 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el PTE
  1352 00000AD2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1353 00000AD4 68[00000000]              push    __TAREA3_STACK_START_PHY     
  1354 00000AD9 68[00000000]              push    __TAREA3_STACK_START_VMA 
  1355 00000ADE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1356 00000AE3 E8(00000000)              call    set_page_rom
  1357 00000AE8 C9                        leave
  1358                                  
  1359                                  
  1360                                  
  1361                                    ;------__STACK_KERNEL_TAREA3_PHY-----------
  1362                                    ; ->Cargo DPTE y PTE
  1363 00000AE9 55                        push    ebp
  1364 00000AEA 89E5                      mov     ebp, esp 
  1365 00000AEC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1366 00000AEE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1367 00000AF0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1368 00000AF2 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1369 00000AF4 68[00000000]              push    __STACK_KERNEL_TAREA3_PHY     
  1370 00000AF9 68[00000000]              push    __STACK_KERNEL_TAREA3_VMA 
  1371 00000AFE 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 1 
  1372 00000B03 E8(00000000)              call    set_page_rom
  1373 00000B08 C9                        leave
  1374                                  
  1375                                  
  1376                                  
  1377                                    ;------__STACK_KERNEL_PHY-----------
  1378                                    ; ->Cargo DPTE y PTE
  1379 00000B09 55                        push    ebp
  1380 00000B0A 89E5                      mov     ebp, esp 
  1381 00000B0C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1382 00000B0E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1383 00000B10 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1384 00000B12 6A01                      push    PAG_US_US            ; Permisos de Supervisor/Usuario para el DPTE
  1385 00000B14 68[00000000]              push    __STACK_KERNEL_PHY     
  1386 00000B19 68[00000000]              push    __STACK_KERNEL_VMA 
  1387 00000B1E 68[00000000]              push    __CR3_TAREA_3_PHY    ; Base del DPT de la Tarea 3 
  1388 00000B23 E8(00000000)              call    set_page_rom
  1389 00000B28 C9                        leave
  1390                                  
  1391                                    ;------TSS_3-----------
  1392                                    ; ->Cargo DPTE y PTE
  1393 00000B29 55                        push    ebp
  1394 00000B2A 89E5                      mov     ebp, esp 
  1395 00000B2C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1396 00000B2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1397 00000B30 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1398 00000B32 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1399 00000B34 68[00000000]              push    __TSS3_VMA          ; Identitty Mapping
  1400 00000B39 68[00000000]              push    __TSS3_VMA 
  1401 00000B3E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT de la Tarea 3 
  1402 00000B43 E8(00000000)              call    set_page_rom
  1403 00000B48 C9                        leave
  1404                                  
  1405                                    ;------__MMX3_VMA-----------
  1406                                    ; ->Cargo DPTE y PTE
  1407 00000B49 55                        push    ebp
  1408 00000B4A 89E5                      mov     ebp, esp 
  1409 00000B4C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1410 00000B4E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1411 00000B50 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1412 00000B52 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1413 00000B54 68[00000000]              push    __MMX3_VMA        ; Identitty Mapping
  1414 00000B59 68[00000000]              push    __MMX3_VMA 
  1415 00000B5E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT del Kernel 
  1416 00000B63 E8(00000000)              call    set_page_rom
  1417 00000B68 C9                        leave
  1418                                  
  1419                                    ;------__TSS_BASICA-----------
  1420                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1421                                    ; las pilas de nivel 0.
  1422                                    ; ->Cargo DPTE y PTE
  1423 00000B69 55                        push    ebp
  1424 00000B6A 89E5                      mov     ebp, esp 
  1425 00000B6C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1426 00000B6E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1427 00000B70 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1428 00000B72 6A01                      push    PAG_US_US         ; Permisos de Supervisor/Usuario para el DPTE
  1429 00000B74 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1430 00000B79 68[00000000]              push    __TSS_BASICA 
  1431 00000B7E 68[00000000]              push    __CR3_TAREA_3_PHY  ; Base del DPT del Kernel 
  1432 00000B83 E8(00000000)              call    set_page_rom
  1433 00000B88 C9                        leave
  1434                                  
  1435                                  
  1436                                  
  1437                                    ;--------------------------------------------
  1438                                    ;-----------Mapeo de la Tarea 4 -------------
  1439                                    ;--------------------------------------------
  1440                                    ;------------__CR3_TAREA_4_PHY                            = Base del DTP de la Tarea 4
  1441                                    ;------------__CR3_TAREA_4_PHY + 0x1000                   = Tamaño del DTP
  1442                                    ;-----------(__CR3_TAREA_4_PHY + 0x1000)+0x1000*DPTE      = Bases de las TP
  1443                                  
  1444                                    ;------__TECLADO_ISR_PHY-----------
  1445                                    ; ->Cargo DPTE y PTE
  1446 00000B89 55                        push    ebp
  1447 00000B8A 89E5                      mov     ebp, esp 
  1448 00000B8C 6A00                      push    PAG_RW_R            ; Permiso ReadOnly para el PTE del código de los Handlers EXCEP. e IRQ
  1449 00000B8E 6A01                      push    PAG_RW_W            ; Permiso de Write para el DPTE que apunta a la TP
  1450 00000B90 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor para el PTE
  1451 00000B92 6A00                      push    PAG_US_SUP           ; Permisos de Usuario para el DPTE
  1452 00000B94 68[00000000]              push    __TECLADO_ISR_PHY     
  1453 00000B99 68[00000000]              push    __TECLADO_ISR_VMA 
  1454 00000B9E 68[00000000]              push    __CR3_TAREA_4_PHY   ; Base del DPT de la Tarea 4 
  1455 00000BA3 E8(00000000)              call    set_page_rom
  1456 00000BA8 C9                        leave
  1457                                    ;------__VGA_PHY-----------
  1458                                    ; ->Cargo DPTE y PTE
  1459 00000BA9 55                        push    ebp
  1460 00000BAA 89E5                      mov     ebp, esp 
  1461 00000BAC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1462 00000BAE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1463 00000BB0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1464 00000BB2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1465 00000BB4 68[00000000]              push    __VGA_PHY     
  1466 00000BB9 68[00000000]              push    __VGA_VMA 
  1467 00000BBE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1468 00000BC3 E8(00000000)              call    set_page_rom
  1469 00000BC8 C9                        leave
  1470                                  
  1471                                    ;------__FUNCTIONS_PHY-----------
  1472                                    ; ->Cargo DPTE y PTE
  1473 00000BC9 55                        push    ebp
  1474 00000BCA 89E5                      mov     ebp, esp 
  1475 00000BCC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1476 00000BCE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1477 00000BD0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1478 00000BD2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1479 00000BD4 68[00000000]              push    __FUNCTIONS_PHY     
  1480 00000BD9 68[00000000]              push    __FUNCTIONS_VMA 
  1481 00000BDE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1482 00000BE3 E8(00000000)              call    set_page_rom
  1483 00000BE8 C9                        leave
  1484                                  
  1485                                      ;------2da __FUNCTIONS_PHY-----------
  1486                                    ; ->Cargo DPTE y PTE
  1487 00000BE9 55                        push    ebp
  1488 00000BEA 89E5                      mov     ebp, esp 
  1489 00000BEC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1490 00000BEE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1491 00000BF0 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1492 00000BF2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1493 00000BF4 68[00100000]              push    __FUNCTIONS_PHY + 0x1000     
  1494 00000BF9 68[00100000]              push    __FUNCTIONS_VMA + 0x1000
  1495 00000BFE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1496 00000C03 E8(00000000)              call    set_page_rom
  1497 00000C08 C9                        leave
  1498                                  
  1499                                    ;------__DATOS_SYS32_PHY-----------
  1500                                    ; ->Cargo DPTE y PTE
  1501 00000C09 55                        push    ebp
  1502 00000C0A 89E5                      mov     ebp, esp 
  1503 00000C0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1504 00000C0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1505 00000C10 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1506 00000C12 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1507 00000C14 68[00000000]              push    __DATOS_SYS32_PHY     
  1508 00000C19 68[00000000]              push    __DATOS_SYS32_VMA 
  1509 00000C1E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1510 00000C23 E8(00000000)              call    set_page_rom
  1511 00000C28 C9                        leave
  1512                                  
  1513                                    ;------__DIGITS_TABLE_PHY-----------
  1514                                    ; ->Cargo DPTE y PTE
  1515 00000C29 55                        push    ebp
  1516 00000C2A 89E5                      mov     ebp, esp 
  1517 00000C2C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1518 00000C2E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1519 00000C30 6A01                      push    PAG_US_US          ; Permisos de Supervisor/Usuario para el PTE
  1520 00000C32 6A01                      push    PAG_US_US           ; Permisos de Supervisor/Usuario para el DPTE
  1521 00000C34 68[00000000]              push    __DIGITS_TABLE_PHY     
  1522 00000C39 68[00000000]              push    __DIGITS_TABLE_VMA 
  1523 00000C3E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1524 00000C43 E8(00000000)              call    set_page_rom
  1525 00000C48 C9                        leave
  1526                                  
  1527                                    ;------__SYS_TABLES_PHY-----------
  1528                                    ; ->Cargo DPTE y PTE
  1529 00000C49 55                        push    ebp
  1530 00000C4A 89E5                      mov     ebp, esp 
  1531 00000C4C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1532 00000C4E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1533 00000C50 6A00                      push    PAG_US_SUP          ; Permisos de Supervisor/Usuario para el PTE
  1534 00000C52 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1535 00000C54 68[00000000]              push    __SYS_TABLES_PHY     
  1536 00000C59 68[00000000]              push    __SYS_TABLES_VMA 
  1537 00000C5E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1538 00000C63 E8(00000000)              call    set_page_rom
  1539 00000C68 C9                        leave
  1540                                  
  1541                                    ;------__TAREA4_TEXT_PHY-----------
  1542                                    ; ->Cargo DPTE y PTE
  1543 00000C69 55                        push    ebp
  1544 00000C6A 89E5                      mov     ebp, esp 
  1545 00000C6C 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1546 00000C6E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1547 00000C70 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1548 00000C72 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1549 00000C74 68[00000000]              push    __TAREA4_TEXT_PHY     
  1550 00000C79 68[00000000]              push    __TAREA4_TEXT_VMA 
  1551 00000C7E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1552 00000C83 E8(00000000)              call    set_page_rom
  1553 00000C88 C9                        leave
  1554                                  
  1555                                    ;------__TAREA4_BSS_PHY-----------
  1556                                    ; ->Cargo DPTE y PTE
  1557 00000C89 55                        push    ebp
  1558 00000C8A 89E5                      mov     ebp, esp 
  1559 00000C8C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1560 00000C8E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1561 00000C90 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1562 00000C92 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1563 00000C94 68[00000000]              push    __TAREA4_BSS_PHY     
  1564 00000C99 68[00000000]              push    __TAREA4_BSS_VMA 
  1565 00000C9E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1566 00000CA3 E8(00000000)              call    set_page_rom
  1567 00000CA8 C9                        leave
  1568                                  
  1569                                    ;------__TAREA4_DATA_PHY-----------
  1570                                    ; ->Cargo DPTE y PTE
  1571 00000CA9 55                        push    ebp
  1572 00000CAA 89E5                      mov     ebp, esp 
  1573 00000CAC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1574 00000CAE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1575 00000CB0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1576 00000CB2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1577 00000CB4 68[00000000]              push    __TAREA4_DATA_PHY     
  1578 00000CB9 68[00000000]              push    __TAREA4_DATA_VMA 
  1579 00000CBE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1580 00000CC3 E8(00000000)              call    set_page_rom
  1581 00000CC8 C9                        leave
  1582                                    
  1583                                    ;------__TAREA4_RODATA_PHY-----------
  1584                                    ; ->Cargo DPTE y PTE
  1585 00000CC9 55                        push    ebp
  1586 00000CCA 89E5                      mov     ebp, esp 
  1587 00000CCC 6A00                      push    PAG_RW_R            ; Permisos R/W para el PTE
  1588 00000CCE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1589 00000CD0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1590 00000CD2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1591 00000CD4 68[00000000]              push    __TAREA4_RODATA_PHY     
  1592 00000CD9 68[00000000]              push    __TAREA4_RODATA_VMA 
  1593 00000CDE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1594 00000CE3 E8(00000000)              call    set_page_rom
  1595 00000CE8 C9                        leave
  1596                                  
  1597                                    ;------__TAREA4_STACK_START_PHY-----------
  1598                                    ; ->Cargo DPTE y PTE
  1599 00000CE9 55                        push    ebp
  1600 00000CEA 89E5                      mov     ebp, esp 
  1601 00000CEC 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1602 00000CEE 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1603 00000CF0 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1604 00000CF2 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1605 00000CF4 68[00000000]              push    __TAREA4_STACK_START_PHY     
  1606 00000CF9 68[00000000]              push    __TAREA4_STACK_START_VMA 
  1607 00000CFE 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 4 
  1608 00000D03 E8(00000000)              call    set_page_rom
  1609 00000D08 C9                        leave
  1610                                  
  1611                                  
  1612                                    ;------__STACK_KERNEL_TAREA4_PHY-----------
  1613                                    ; ->Cargo DPTE y PTE
  1614 00000D09 55                        push    ebp
  1615 00000D0A 89E5                      mov     ebp, esp 
  1616 00000D0C 6A01                      push    PAG_RW_W            ; Permisos R/W para el PTE
  1617 00000D0E 6A01                      push    PAG_RW_W            ; Permisos R/W para el DPTE
  1618 00000D10 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1619 00000D12 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el DPTE
  1620 00000D14 68[00000000]              push    __STACK_KERNEL_TAREA4_PHY     
  1621 00000D19 68[00000000]              push    __STACK_KERNEL_TAREA4_VMA 
  1622 00000D1E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 1 
  1623 00000D23 E8(00000000)              call    set_page_rom
  1624 00000D28 C9                        leave
  1625                                  
  1626                                  
  1627                                    ;------__STACK_KERNEL_PHY-----------
  1628                                    ; ->Cargo DPTE y PTE
  1629 00000D29 55                        push    ebp
  1630 00000D2A 89E5                      mov     ebp, esp 
  1631 00000D2C 6A01                      push    PAG_RW_W             ; Permisos R/W para el PTE
  1632 00000D2E 6A01                      push    PAG_RW_W             ; Permisos R/W para el DPTE
  1633 00000D30 6A00                      push    PAG_US_SUP           ; Permisos de Supervisor/Usuario para el PTE
  1634 00000D32 6A00                      push    PAG_US_SUP            ; Permisos de Supervisor/Usuario para el DPTE
  1635 00000D34 68[00000000]              push    __STACK_KERNEL_PHY     
  1636 00000D39 68[00000000]              push    __STACK_KERNEL_VMA 
  1637 00000D3E 68[00000000]              push    __CR3_TAREA_4_PHY    ; Base del DPT de la Tarea 3 
  1638 00000D43 E8(00000000)              call    set_page_rom
  1639 00000D48 C9                        leave
  1640                                  
  1641                                    ;------TSS_4-----------
  1642                                    ; ->Cargo DPTE y PTE
  1643 00000D49 55                        push    ebp
  1644 00000D4A 89E5                      mov     ebp, esp 
  1645 00000D4C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1646 00000D4E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1647 00000D50 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1648 00000D52 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el DPTE
  1649 00000D54 68[00000000]              push    __TSS4_VMA          ; Identitty Mapping
  1650 00000D59 68[00000000]              push    __TSS4_VMA 
  1651 00000D5E 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT de la Tarea 4 
  1652 00000D63 E8(00000000)              call    set_page_rom
  1653 00000D68 C9                        leave
  1654                                    
  1655                                  
  1656                                    ;------____TSS_BASICA-----------
  1657                                    ; Se mapea en todas las DTP de las Tareas para que el CPU puedas ir a buscar
  1658                                    ; las pilas de nivel 0.
  1659                                    ; ->Cargo DPTE y PTE
  1660 00000D69 55                        push    ebp
  1661 00000D6A 89E5                      mov     ebp, esp 
  1662 00000D6C 6A01                      push    PAG_RW_W          ; Permisos R/W para el PTE
  1663 00000D6E 6A01                      push    PAG_RW_W          ; Permisos R/W para el DPTE
  1664 00000D70 6A00                      push    PAG_US_SUP        ; Permisos de Supervisor/Usuario para el PTE
  1665 00000D72 6A00                      push    PAG_US_SUP         ; Permisos de Supervisor/Usuario para el DPTE
  1666 00000D74 68[00000000]              push    __TSS_BASICA        ; Identitty Mapping
  1667 00000D79 68[00000000]              push    __TSS_BASICA 
  1668 00000D7E 68[00000000]              push    __CR3_TAREA_4_PHY  ; Base del DPT del Kernel 
  1669 00000D83 E8(00000000)              call    set_page_rom
  1670 00000D88 C9                        leave
  1671                                  
  1672                                    ;--------------------------------------------
  1673                                    ;-----------FIN PAGINACIÓN-------------------
  1674                                    ;--------------------------------------------
  1675                                  
  1676                                    ; -> Habilito la paginación
  1677 00000D89 0F20C0                    mov   eax, cr0 
  1678 00000D8C 0D00000080                or    eax, X86_CR0_PG
  1679 00000D91 0F22C0                    mov   cr0, eax
  1680                                  
  1681                                    ; ------------- HASTA ACA ANDA, PAGINA BIEN. HUBO QUE CAMBIAR BASES DE LOS CR3 PORQUE SE PISABAN.--------------
  1682                                    ;-----------------------------------------------------------------------------------------------
  1683                                  
  1684                                    ;--------------------------------------------
  1685                                    ;-> Inicializo las TSS de las Tareas
  1686                                    ;--------------------------------------------
  1687                                    ; __TSS_BASICA                    = 0x40000000;
  1688                                    ; __TSS1_VMA                      = 0x40001000;
  1689                                    ; __TSS2_VMA                      = 0x40002000;
  1690                                    ; __TSS3_VMA                      = 0x40003000;
  1691                                    ; __TSS4_VMA                      = 0x40004000;
  1692                                  
  1693                                    ; -------------TSS_1--------------
  1694                                  
  1695 00000D94 55                        push    ebp
  1696 00000D95 89E5                      mov     ebp, esp
  1697 00000D97 6A00                      push    flag_TSS_us
  1698 00000D99 68[00000000]              push    __TSS1_VMA                      ; TSS de la tarea
  1699 00000D9E 68[00000000]              push    __CR3_TAREA_1_PHY               ; CR3 de la tarea
  1700 00000DA3 68[00000000]              push    __TAREA1_STACK_END_VMA          ; STACK de la tarea
  1701 00000DA8 68[00000000]              push    __STACK_KERNEL_TAREA1_END_VMA   ; STACK del Kernel
  1702 00000DAD 68[00000000]              push    tarea_1_asm                ; Dir. de inicio de la tarea
  1703 00000DB2 E8(00000000)              call init_tss
  1704 00000DB7 C9                        leave
  1705                                  
  1706                                  
  1707                                    ; -------------TSS_2--------------
  1708 00000DB8 55                        push    ebp
  1709 00000DB9 89E5                      mov     ebp, esp 
  1710 00000DBB 6A00                      push    flag_TSS_us
  1711 00000DBD 68[00000000]              push     __TSS2_VMA                      ; TSS de la tarea
  1712 00000DC2 68[00000000]              push     __CR3_TAREA_2_PHY               ; CR3 de la tarea
  1713 00000DC7 68[00000000]              push     __TAREA2_STACK_END_VMA          ; STACK de la tarea
  1714 00000DCC 68[00000000]              push     __STACK_KERNEL_TAREA2_END_VMA   ; STACK del Kernel
  1715 00000DD1 68[00000000]              push     tarea_2_asm                ; Dir. de inicio de la tarea
  1716 00000DD6 E8(00000000)              call     init_tss
  1717 00000DDB C9                        leave
  1718                                  
  1719                                    ; -------------TSS_3--------------
  1720 00000DDC 55                        push    ebp
  1721 00000DDD 89E5                      mov     ebp, esp 
  1722 00000DDF 6A00                      push    flag_TSS_us
  1723 00000DE1 68[00000000]              push     __TSS3_VMA                      ; TSS de la tarea
  1724 00000DE6 68[00000000]              push     __CR3_TAREA_3_PHY               ; CR3 de la tarea
  1725 00000DEB 68[00000000]              push     __TAREA3_STACK_END_VMA          ; STACK de la tarea
  1726 00000DF0 68[00000000]              push     __STACK_KERNEL_TAREA3_END_VMA   ; STACK del Kernel
  1727 00000DF5 68[00000000]              push     tarea_3_asm                ; Dir. de inicio de la tarea
  1728 00000DFA E8(00000000)              call     init_tss
  1729 00000DFF C9                        leave
  1730                                  
  1731                                    ; -------------TSS_4--------------
  1732 00000E00 55                        push    ebp
  1733 00000E01 89E5                      mov     ebp, esp 
  1734 00000E03 6A01                      push    flag_TSS_sup
  1735 00000E05 68[00000000]              push    __TSS4_VMA                      ; TSS de la tarea
  1736 00000E0A 68[00000000]              push    __CR3_TAREA_4_PHY               ; CR3 de la tarea
  1737 00000E0F 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea
  1738 00000E14 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1739 00000E19 68[00000000]              push    tarea_4_asm                ; Dir. de inicio de la tarea
  1740 00000E1E E8(00000000)              call    init_tss
  1741 00000E23 C9                        leave
  1742                                  
  1743                                    ; -------------TSS_BASICA para el CPU--------------
  1744 00000E24 55                        push    ebp
  1745 00000E25 89E5                      mov     ebp, esp 
  1746 00000E27 6A01                      push    flag_TSS_sup
  1747 00000E29 68[00000000]              push    __TSS_BASICA                    ; TSS para el CPU
  1748 00000E2E 68[00000000]              push    __CR3_KERNEL_PHY                ; CR3 del Kernel
  1749 00000E33 68[00000000]              push    __TAREA4_STACK_END_VMA          ; STACK de la tarea que primero corre. (la TAREA 4 - HALT)
  1750 00000E38 68[00000000]              push    __STACK_KERNEL_TAREA4_END_VMA   ; STACK del Kernel
  1751 00000E3D 68[00000000]              push    kernel32_init                   ; Dir. de inicio del Kernel
  1752 00000E42 E8(00000000)              call    init_tss
  1753 00000E47 C9                        leave
  1754                                  
  1755                                    ;xchg bx, bx
  1756                                  
  1757                                   ;-> Cargo Selector de la TSS_BASICA
  1758 00000E48 66B8[0000]                mov     ax, TSS_SEL
  1759 00000E4C 0F00D8                    ltr     ax
  1760                                  
  1761                                    ; -> Habilito interrupciones
  1762 00000E4F FB                        sti                                   
  1763 00000E50 EA[00000000][0000]        jmp CS_SEL_00:kernel32_init             ; Salto en memoria a la sección del Kernel
  1764                                  
  1765                                  .guard:
  1766 00000E57 F4                        hlt
  1767 00000E58 EBFD                      jmp .guard
  1768                                  
  1769                                  
